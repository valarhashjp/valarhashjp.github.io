import{i as ze,a as ae,r as $e,b as se,w as Gt,t as Qe,c as Ze,d as it,e as Je,f as tr,g as Fe,h as er,j as yt,u as Me,k as vt,l as j,s as rr,o as zt,n as pe,m as ir,p as nr,q,v as z,x as U,y as qt,z as bt,A as ut,B as ct,C as ht,D as Yt,E as Q,F as ar,G as Se,T as te,H as lt,I as sr,J as me,K as wt,L as pt,M as St,N as $,_ as Ne,O as or,P as lr,Q as Ft,R as ye,S as Be,U as ur,V as cr,W as dr,X as Ee,Y as _t,Z as Ct,$ as Ot,a0 as hr,a1 as Ue,a2 as Zt,a3 as Te,a4 as Ge,a5 as fr}from"./index.6ae8537b.js";import{H as re}from"./HomeTitle.730c9a58.js";import{G as gr,a as vr}from"./apis.b4430c47.js";var pr=/\s/;function mr(F){for(var R=F.length;R--&&pr.test(F.charAt(R)););return R}var yr=/^\s+/;function Er(F){return F&&F.slice(0,mr(F)+1).replace(yr,"")}var be=0/0,Tr=/^[-+]0x[0-9a-f]+$/i,Sr=/^0b[01]+$/i,br=/^0o[0-7]+$/i,_r=parseInt;function _e(F){if(typeof F=="number")return F;if(ze(F))return be;if(ae(F)){var R=typeof F.valueOf=="function"?F.valueOf():F;F=ae(R)?R+"":R}if(typeof F!="string")return F===0?F:+F;F=Er(F);var d=Sr.test(F);return d||br.test(F)?_r(F.slice(2),d?2:8):Tr.test(F)?be:+F}var Lr=function(){return $e.Date.now()};const le=Lr;var Ar="Expected a function",kr=Math.max,Dr=Math.min;function Ir(F,R,d){var A,y,L,k,w,D,o=0,S=!1,m=!1,f=!0;if(typeof F!="function")throw new TypeError(Ar);R=_e(R)||0,ae(d)&&(S=!!d.leading,m="maxWait"in d,L=m?kr(_e(d.maxWait)||0,R):L,f="trailing"in d?!!d.trailing:f);function T(s){var v=A,g=y;return A=y=void 0,o=s,k=F.apply(g,v),k}function E(s){return o=s,w=setTimeout(a,R),S?T(s):k}function c(s){var v=s-D,g=s-o,p=R-v;return m?Dr(p,L-g):p}function t(s){var v=s-D,g=s-o;return D===void 0||v>=R||v<0||m&&g>=L}function a(){var s=le();if(t(s))return e(s);w=setTimeout(a,c(s))}function e(s){return w=void 0,f&&A?T(s):(A=y=void 0,k)}function l(){w!==void 0&&clearTimeout(w),o=0,A=D=y=w=void 0}function u(){return w===void 0?k:e(le())}function i(){var s=le(),v=t(s);if(A=arguments,y=this,D=s,v){if(w===void 0)return E(D);if(m)return clearTimeout(w),w=setTimeout(a,R),T(D)}return w===void 0&&(w=setTimeout(a,R)),k}return i.cancel=l,i.flush=u,i}var Rr="Expected a function";function Le(F,R,d){var A=!0,y=!0;if(typeof F!="function")throw new TypeError(Rr);return ae(d)&&(A="leading"in d?!!d.leading:A,y="trailing"in d?!!d.trailing:y),Ir(F,R,{leading:A,maxWait:R,trailing:y})}function wr(F){var R;const d=Ze(F);return(R=d==null?void 0:d.$el)!=null?R:d}const Cr=se?window:void 0;se&&window.document;se&&window.navigator;se&&window.location;function Or(F,R=!1){const d=it(),A=()=>d.value=Boolean(F());return A(),Je(A,R),d}const he=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},fe="__vueuse_ssr_handlers__";he[fe]=he[fe]||{};he[fe];var Ae=Object.getOwnPropertySymbols,xr=Object.prototype.hasOwnProperty,Pr=Object.prototype.propertyIsEnumerable,Fr=(F,R)=>{var d={};for(var A in F)xr.call(F,A)&&R.indexOf(A)<0&&(d[A]=F[A]);if(F!=null&&Ae)for(var A of Ae(F))R.indexOf(A)<0&&Pr.call(F,A)&&(d[A]=F[A]);return d};function Mr(F,R,d={}){const A=d,{window:y=Cr}=A,L=Fr(A,["window"]);let k;const w=Or(()=>y&&"ResizeObserver"in y),D=()=>{k&&(k.disconnect(),k=void 0)},o=Gt(()=>wr(F),m=>{D(),w.value&&y&&m&&(k=new ResizeObserver(R),k.observe(m,L))},{immediate:!0,flush:"post"}),S=()=>{D(),o()};return Qe(S),{isSupported:w,stop:S}}var ke;(function(F){F.UP="UP",F.RIGHT="RIGHT",F.DOWN="DOWN",F.LEFT="LEFT",F.NONE="NONE"})(ke||(ke={}));var Nr=Object.defineProperty,De=Object.getOwnPropertySymbols,Br=Object.prototype.hasOwnProperty,Ur=Object.prototype.propertyIsEnumerable,Ie=(F,R,d)=>R in F?Nr(F,R,{enumerable:!0,configurable:!0,writable:!0,value:d}):F[R]=d,Gr=(F,R)=>{for(var d in R||(R={}))Br.call(R,d)&&Ie(F,d,R[d]);if(De)for(var d of De(R))Ur.call(R,d)&&Ie(F,d,R[d]);return F};const jr={easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]};Gr({linear:tr},jr);const je=Symbol("carouselContextKey"),Kr=Fe({initialIndex:{type:Number,default:0},height:{type:String,default:""},trigger:{type:String,values:["hover","click"],default:"hover"},autoplay:{type:Boolean,default:!0},interval:{type:Number,default:3e3},indicatorPosition:{type:String,values:["","none","outside"],default:""},indicator:{type:Boolean,default:!0},arrow:{type:String,values:["always","hover","never"],default:"hover"},type:{type:String,values:["","card"],default:""},loop:{type:Boolean,default:!0},direction:{type:String,values:["horizontal","vertical"],default:"horizontal"},pauseOnHover:{type:Boolean,default:!0}}),Vr={change:(F,R)=>[F,R].every(er)},Hr=["onMouseenter","onMouseleave"],Wr=["onMouseenter","onClick"],Yr={key:0},qr={name:"ElCarousel"},Xr=yt({...qr,props:Kr,emits:Vr,setup(F,{expose:R,emit:d}){const A=F,y=Me("carousel"),L=300,k=it(-1),w=it(null),D=it(!1),o=it(),S=it([]),m=vt(()=>A.arrow!=="never"&&!j(t)),f=vt(()=>S.value.some(M=>M.props.label.toString().length>0)),T=vt(()=>{const M=[y.b(),y.m(A.direction)];return j(c)&&M.push(y.m("card")),M}),E=vt(()=>{const M=[y.e("indicators"),y.em("indicators",A.direction)];return f.value&&M.push(y.em("indicators","labels")),(A.indicatorPosition==="outside"||j(c))&&M.push(y.em("indicators","outside")),M}),c=vt(()=>A.type==="card"),t=vt(()=>A.direction==="vertical"),a=Le(M=>{s(M)},L,{trailing:!0}),e=Le(M=>{O(M)},L);function l(){w.value&&(clearInterval(w.value),w.value=null)}function u(){A.interval<=0||!A.autoplay||w.value||(w.value=setInterval(()=>i(),A.interval))}const i=()=>{k.value<S.value.length-1?k.value=k.value+1:A.loop&&(k.value=0)};function s(M){if(or(M)){const K=S.value.filter(V=>V.props.name===M);K.length>0&&(M=S.value.indexOf(K[0]))}if(M=Number(M),Number.isNaN(M)||M!==Math.floor(M))return;const B=S.value.length,G=k.value;M<0?k.value=A.loop?B-1:0:M>=B?k.value=A.loop?0:B-1:k.value=M,G===k.value&&v(G),P()}function v(M){S.value.forEach((B,G)=>{B.translateItem(G,k.value,M)})}function g(M){S.value.push(M)}function p(M){const B=S.value.findIndex(G=>G.uid===M);B!==-1&&(S.value.splice(B,1),k.value===B&&x())}function r(M,B){var G,K,V,H;const W=j(S),Y=W.length;if(Y===0||!M.states.inStage)return!1;const X=B+1,tt=B-1,et=Y-1,nt=W[et].states.active,J=W[0].states.active,st=(K=(G=W[X])==null?void 0:G.states)==null?void 0:K.active,Z=(H=(V=W[tt])==null?void 0:V.states)==null?void 0:H.active;return B===et&&J||st?"left":B===0&&nt||Z?"right":!1}function n(){D.value=!0,A.pauseOnHover&&l()}function h(){D.value=!1,u()}function b(M){j(t)||S.value.forEach((B,G)=>{M===r(B,G)&&(B.states.hover=!0)})}function _(){j(t)||S.value.forEach(M=>{M.states.hover=!1})}function I(M){k.value=M}function O(M){A.trigger==="hover"&&M!==k.value&&(k.value=M)}function C(){s(k.value-1)}function x(){s(k.value+1)}function P(){l(),u()}Gt(()=>k.value,(M,B)=>{v(B),B>-1&&d("change",M,B)}),Gt(()=>A.autoplay,M=>{M?u():l()}),Gt(()=>A.loop,()=>{s(k.value)}),Gt(()=>A.interval,()=>{P()});const N=rr();return zt(async()=>{await pe(),N.value=Mr(o.value,()=>{v()}),A.initialIndex<S.value.length&&A.initialIndex>=0&&(k.value=A.initialIndex),u()}),ir(()=>{l(),o.value&&N.value&&N.value.stop()}),nr(je,{root:o,isCardType:c,isVertical:t,items:S,loop:A.loop,addItem:g,removeItem:p,setActiveItem:s}),R({setActiveItem:s,prev:C,next:x}),(M,B)=>(q(),z("div",{ref_key:"root",ref:o,class:ht(j(T)),onMouseenter:Yt(n,["stop"]),onMouseleave:Yt(h,["stop"])},[U("div",{class:ht(j(y).e("container")),style:wt({height:M.height})},[j(m)?(q(),qt(te,{key:0,name:"carousel-arrow-left",persisted:""},{default:bt(()=>[ut(U("button",{type:"button",class:ht([j(y).e("arrow"),j(y).em("arrow","left")]),onMouseenter:B[0]||(B[0]=G=>b("left")),onMouseleave:_,onClick:B[1]||(B[1]=Yt(G=>j(a)(k.value-1),["stop"]))},[Q(j(Se),null,{default:bt(()=>[Q(j(ar))]),_:1})],34),[[ct,(M.arrow==="always"||D.value)&&(A.loop||k.value>0)]])]),_:1})):lt("v-if",!0),j(m)?(q(),qt(te,{key:1,name:"carousel-arrow-right",persisted:""},{default:bt(()=>[ut(U("button",{type:"button",class:ht([j(y).e("arrow"),j(y).em("arrow","right")]),onMouseenter:B[2]||(B[2]=G=>b("right")),onMouseleave:_,onClick:B[3]||(B[3]=Yt(G=>j(a)(k.value+1),["stop"]))},[Q(j(Se),null,{default:bt(()=>[Q(j(sr))]),_:1})],34),[[ct,(M.arrow==="always"||D.value)&&(A.loop||k.value<S.value.length-1)]])]),_:1})):lt("v-if",!0),me(M.$slots,"default")],6),M.indicatorPosition!=="none"?(q(),z("ul",{key:0,class:ht(j(E))},[(q(!0),z(pt,null,St(S.value,(G,K)=>(q(),z("li",{key:K,class:ht([j(y).e("indicator"),j(y).em("indicator",M.direction),j(y).is("active",K===k.value)]),onMouseenter:V=>j(e)(K),onClick:Yt(V=>I(K),["stop"])},[U("button",{class:ht(j(y).e("button"))},[j(f)?(q(),z("span",Yr,$(G.props.label),1)):lt("v-if",!0)],2)],42,Wr))),128))],2)):lt("v-if",!0)],42,Hr))}});var zr=Ne(Xr,[["__file","/home/runner/work/element-plus/element-plus/packages/components/carousel/src/carousel.vue"]]);const $r=Fe({name:{type:String,default:""},label:{type:[String,Number],default:""}}),Qr={name:"ElCarouselItem"},Zr=yt({...Qr,props:$r,setup(F){const R=F,d=Me("carousel"),A=lr(je),y=Be(),L=.83,k=it(!1),w=it(0),D=it(1),o=it(!1),S=it(!1),m=it(!1),f=it(!1),{isCardType:T,isVertical:E}=A,c=vt(()=>{const s=`${`translate${j(E)?"Y":"X"}`}(${j(w)}px)`,v=`scale(${j(D)})`;return{transform:[s,v].join(" ")}});function t(i,s,v){const g=v-1,p=s-1,r=s+1,n=v/2;return s===0&&i===g?-1:s===g&&i===0?v:i<p&&s-i>=n?v+1:i>r&&i-s>=n?-2:i}function a(i,s){var v;const g=((v=A.root.value)==null?void 0:v.offsetWidth)||0;return m.value?g*((2-L)*(i-s)+1)/4:i<s?-(1+L)*g/4:(3+L)*g/4}function e(i,s,v){const g=A.root.value;return g?((v?g.offsetHeight:g.offsetWidth)||0)*(i-s):0}const l=(i,s,v)=>{var g;const p=j(T),r=(g=A.items.value.length)!=null?g:Number.NaN,n=i===s;!p&&!ur(v)&&(f.value=n||i===v),!n&&r>2&&A.loop&&(i=t(i,s,r));const h=j(E);o.value=n,p?(m.value=Math.round(Math.abs(i-s))<=1,w.value=a(i,s),D.value=j(o)?1:L):w.value=e(i,s,h),S.value=!0};function u(){if(A&&j(T)){const i=A.items.value.findIndex(({uid:s})=>s===y.uid);A.setActiveItem(i)}}return zt(()=>{A.addItem({props:R,states:Ft({hover:k,translate:w,scale:D,active:o,ready:S,inStage:m,animating:f}),uid:y.uid,translateItem:l})}),ye(()=>{A.removeItem(y.uid)}),(i,s)=>ut((q(),z("div",{class:ht([j(d).e("item"),j(d).is("active",o.value),j(d).is("in-stage",m.value),j(d).is("hover",k.value),j(d).is("animating",f.value),{[j(d).em("item","card")]:j(T)}]),style:wt(j(c)),onClick:u},[j(T)?ut((q(),z("div",{key:0,class:ht(j(d).e("mask"))},null,2)),[[ct,!o.value]]):lt("v-if",!0),me(i.$slots,"default")],6)),[[ct,S.value]])}});var Ke=Ne(Zr,[["__file","/home/runner/work/element-plus/element-plus/packages/components/carousel/src/carousel-item.vue"]]);const Jr=cr(zr,{CarouselItem:Ke}),ti=dr(Ke);const ei="/image/banner_arrow_left.png",ri="/image/banner_arrow_right.png",ii="/image/btn_arrow.png",ni="/image/btn_arrow_yellow.png",ai={class:"tips-item flex"},si={class:"tips-content"},oi=yt({__name:"MyTips",props:{content:{type:String,required:!0,default:0}},setup(F){return(R,d)=>(q(),z("div",ai,[me(R.$slots,"default",{},void 0,!0),U("span",si,$(F.content),1)]))}});const Re=Ee(oi,[["__scopeId","data-v-8b09b597"]]),li={class:"box flex"},ui={class:"main-img w50 h100"},ci=["src"],di={class:"productpictureInfoTextBox"},hi={class:"productpictureInfoText"},fi={class:"thumbnail w50 h100"},gi={class:"thumbnail-top w100 h50"},vi=["src"],pi={class:"productpictureInfoTextBox"},mi={class:"productpictureInfoText"},yi={class:"thumbnail-bottom w100 h50 flex"},Ei={class:"thumbnail-bottom-left w50 h100"},Ti=["src"],Si={class:"productpictureInfoTextBox"},bi={class:"productpictureInfoText"},_i={class:"thumbnail-bottom-right w50 h100"},Li=["src"],Ai={class:"productpictureInfoTextBox"},ki={class:"productpictureInfoText"},Di=yt({__name:"Productpicture",props:{productpictureInfo:{type:Object,required:!0}},setup(F){return Ft({activeProductpicture:1}),(R,d)=>(q(),z("div",li,[U("div",ui,[U("img",{src:F.productpictureInfo.mainImg,alt:""},null,8,ci),U("div",di,[U("div",hi,$(F.productpictureInfo.Introduction),1)])]),U("div",fi,[U("div",gi,[U("img",{src:F.productpictureInfo.thumbnailTop,alt:""},null,8,vi),U("div",pi,[U("div",mi,$(F.productpictureInfo.Introduction),1)])]),U("div",yi,[U("div",Ei,[U("img",{src:F.productpictureInfo.thumbnailBottomLetf,alt:""},null,8,Ti),U("div",Si,[U("div",bi,$(F.productpictureInfo.Introduction),1)])]),U("div",_i,[U("img",{src:F.productpictureInfo.thumbnailBottomRight,alt:""},null,8,Li),U("div",Ai,[U("div",ki,$(F.productpictureInfo.Introduction),1)])])])])]))}});var Ii=Object.defineProperty,Ri=Object.defineProperties,wi=Object.getOwnPropertyDescriptors,we=Object.getOwnPropertySymbols,Ci=Object.prototype.hasOwnProperty,Oi=Object.prototype.propertyIsEnumerable,Ce=(F,R,d)=>R in F?Ii(F,R,{enumerable:!0,configurable:!0,writable:!0,value:d}):F[R]=d,ge=(F,R)=>{for(var d in R||(R={}))Ci.call(R,d)&&Ce(F,d,R[d]);if(we)for(var d of we(R))Oi.call(R,d)&&Ce(F,d,R[d]);return F},ve=(F,R)=>Ri(F,wi(R));function Oe(F,R,d,A){var y,L=!1,k=0;function w(){y&&clearTimeout(y)}function D(){for(var o=arguments.length,S=new Array(o),m=0;m<o;m++)S[m]=arguments[m];var f=this,T=Date.now()-k;function E(){k=Date.now(),d.apply(f,S)}function c(){y=void 0}L||(A&&!y&&E(),w(),A===void 0&&T>F?E():R!==!0&&(y=setTimeout(A?c:E,A===void 0?F-T:F)))}return typeof R!="boolean"&&(A=d,d=R,R=void 0),D.cancel=function(){w(),L=!0},D}function xe(F,R,d){return d===void 0?Oe(F,R,!1):Oe(F,d,R!==!1)}function xi(F){return F&&F.__esModule&&Object.prototype.hasOwnProperty.call(F,"default")?F.default:F}var Ve={exports:{}};typeof window<"u"&&(Ve.exports=function(F){var R={};function d(A){if(R[A])return R[A].exports;var y=R[A]={i:A,l:!1,exports:{}};return F[A].call(y.exports,y,y.exports,d),y.l=!0,y.exports}return d.m=F,d.c=R,d.d=function(A,y,L){d.o(A,y)||Object.defineProperty(A,y,{enumerable:!0,get:L})},d.r=function(A){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(A,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(A,"__esModule",{value:!0})},d.t=function(A,y){if(1&y&&(A=d(A)),8&y||4&y&&typeof A=="object"&&A&&A.__esModule)return A;var L=Object.create(null);if(d.r(L),Object.defineProperty(L,"default",{enumerable:!0,value:A}),2&y&&typeof A!="string")for(var k in A)d.d(L,k,function(w){return A[w]}.bind(null,k));return L},d.n=function(A){var y=A&&A.__esModule?function(){return A.default}:function(){return A};return d.d(y,"a",y),y},d.o=function(A,y){return Object.prototype.hasOwnProperty.call(A,y)},d.p="/dist/",d(d.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(F,R,d){var A=Object.prototype.hasOwnProperty,y="~";function L(){}function k(S,m,f){this.fn=S,this.context=m,this.once=f||!1}function w(S,m,f,T,E){if(typeof f!="function")throw new TypeError("The listener must be a function");var c=new k(f,T||S,E),t=y?y+m:m;return S._events[t]?S._events[t].fn?S._events[t]=[S._events[t],c]:S._events[t].push(c):(S._events[t]=c,S._eventsCount++),S}function D(S,m){--S._eventsCount==0?S._events=new L:delete S._events[m]}function o(){this._events=new L,this._eventsCount=0}Object.create&&(L.prototype=Object.create(null),new L().__proto__||(y=!1)),o.prototype.eventNames=function(){var S,m,f=[];if(this._eventsCount===0)return f;for(m in S=this._events)A.call(S,m)&&f.push(y?m.slice(1):m);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(S)):f},o.prototype.listeners=function(S){var m=y?y+S:S,f=this._events[m];if(!f)return[];if(f.fn)return[f.fn];for(var T=0,E=f.length,c=new Array(E);T<E;T++)c[T]=f[T].fn;return c},o.prototype.listenerCount=function(S){var m=y?y+S:S,f=this._events[m];return f?f.fn?1:f.length:0},o.prototype.emit=function(S,m,f,T,E,c){var t=y?y+S:S;if(!this._events[t])return!1;var a,e,l=this._events[t],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(S,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,m),!0;case 3:return l.fn.call(l.context,m,f),!0;case 4:return l.fn.call(l.context,m,f,T),!0;case 5:return l.fn.call(l.context,m,f,T,E),!0;case 6:return l.fn.call(l.context,m,f,T,E,c),!0}for(e=1,a=new Array(u-1);e<u;e++)a[e-1]=arguments[e];l.fn.apply(l.context,a)}else{var i,s=l.length;for(e=0;e<s;e++)switch(l[e].once&&this.removeListener(S,l[e].fn,void 0,!0),u){case 1:l[e].fn.call(l[e].context);break;case 2:l[e].fn.call(l[e].context,m);break;case 3:l[e].fn.call(l[e].context,m,f);break;case 4:l[e].fn.call(l[e].context,m,f,T);break;default:if(!a)for(i=1,a=new Array(u-1);i<u;i++)a[i-1]=arguments[i];l[e].fn.apply(l[e].context,a)}}return!0},o.prototype.on=function(S,m,f){return w(this,S,m,f,!1)},o.prototype.once=function(S,m,f){return w(this,S,m,f,!0)},o.prototype.removeListener=function(S,m,f,T){var E=y?y+S:S;if(!this._events[E])return this;if(!m)return D(this,E),this;var c=this._events[E];if(c.fn)c.fn!==m||T&&!c.once||f&&c.context!==f||D(this,E);else{for(var t=0,a=[],e=c.length;t<e;t++)(c[t].fn!==m||T&&!c[t].once||f&&c[t].context!==f)&&a.push(c[t]);a.length?this._events[E]=a.length===1?a[0]:a:D(this,E)}return this},o.prototype.removeAllListeners=function(S){var m;return S?(m=y?y+S:S,this._events[m]&&D(this,m)):(this._events=new L,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=y,o.EventEmitter=o,F.exports=o},"./node_modules/url-toolkit/src/url-toolkit.js":function(F,R,d){var A,y,L,k,w;A=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,y=/^([^\/?#]*)([^]*)$/,L=/(?:\/|^)\.(?=\/)/g,k=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,w={buildAbsoluteURL:function(D,o,S){if(S=S||{},D=D.trim(),!(o=o.trim())){if(!S.alwaysNormalize)return D;var m=w.parseURL(D);if(!m)throw new Error("Error trying to parse base URL.");return m.path=w.normalizePath(m.path),w.buildURLFromParts(m)}var f=w.parseURL(o);if(!f)throw new Error("Error trying to parse relative URL.");if(f.scheme)return S.alwaysNormalize?(f.path=w.normalizePath(f.path),w.buildURLFromParts(f)):o;var T=w.parseURL(D);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var E=y.exec(T.path);T.netLoc=E[1],T.path=E[2]}T.netLoc&&!T.path&&(T.path="/");var c={scheme:T.scheme,netLoc:f.netLoc,path:null,params:f.params,query:f.query,fragment:f.fragment};if(!f.netLoc&&(c.netLoc=T.netLoc,f.path[0]!=="/"))if(f.path){var t=T.path,a=t.substring(0,t.lastIndexOf("/")+1)+f.path;c.path=w.normalizePath(a)}else c.path=T.path,f.params||(c.params=T.params,f.query||(c.query=T.query));return c.path===null&&(c.path=S.alwaysNormalize?w.normalizePath(f.path):f.path),w.buildURLFromParts(c)},parseURL:function(D){var o=A.exec(D);return o?{scheme:o[1]||"",netLoc:o[2]||"",path:o[3]||"",params:o[4]||"",query:o[5]||"",fragment:o[6]||""}:null},normalizePath:function(D){for(D=D.split("").reverse().join("").replace(L,"");D.length!==(D=D.replace(k,"")).length;);return D.split("").reverse().join("")},buildURLFromParts:function(D){return D.scheme+D.netLoc+D.path+D.params+D.query+D.fragment}},F.exports=w},"./node_modules/webworkify-webpack/index.js":function(F,R,d){function A(o){var S={};function m(T){if(S[T])return S[T].exports;var E=S[T]={i:T,l:!1,exports:{}};return o[T].call(E.exports,E,E.exports,m),E.l=!0,E.exports}m.m=o,m.c=S,m.i=function(T){return T},m.d=function(T,E,c){m.o(T,E)||Object.defineProperty(T,E,{configurable:!1,enumerable:!0,get:c})},m.r=function(T){Object.defineProperty(T,"__esModule",{value:!0})},m.n=function(T){var E=T&&T.__esModule?function(){return T.default}:function(){return T};return m.d(E,"a",E),E},m.o=function(T,E){return Object.prototype.hasOwnProperty.call(T,E)},m.p="/",m.oe=function(T){throw console.error(T),T};var f=m(m.s=ENTRY_MODULE);return f.default||f}var y="[\\.|\\-|\\+|\\w|/|@]+",L="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function k(o){return(o+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function w(o,S,m){var f={};f[m]=[];var T=S.toString(),E=T.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!E)return f;for(var c,t=E[1],a=new RegExp("(\\\\n|\\W)"+k(t)+L,"g");c=a.exec(T);)c[3]!=="dll-reference"&&f[m].push(c[3]);for(a=new RegExp("\\("+k(t)+'\\("(dll-reference\\s('+y+'))"\\)\\)'+L,"g");c=a.exec(T);)o[c[2]]||(f[m].push(c[1]),o[c[2]]=d(c[1]).m),f[c[2]]=f[c[2]]||[],f[c[2]].push(c[4]);for(var e,l=Object.keys(f),u=0;u<l.length;u++)for(var i=0;i<f[l[u]].length;i++)e=f[l[u]][i],isNaN(1*e)||(f[l[u]][i]=1*f[l[u]][i]);return f}function D(o){return Object.keys(o).reduce(function(S,m){return S||o[m].length>0},!1)}F.exports=function(o,S){S=S||{};var m={main:d.m},f=S.all?{main:Object.keys(m.main)}:function(a,e){for(var l={main:[e]},u={main:[]},i={main:{}};D(l);)for(var s=Object.keys(l),v=0;v<s.length;v++){var g=s[v],p=l[g].pop();if(i[g]=i[g]||{},!i[g][p]&&a[g][p]){i[g][p]=!0,u[g]=u[g]||[],u[g].push(p);for(var r=w(a,a[g][p],g),n=Object.keys(r),h=0;h<n.length;h++)l[n[h]]=l[n[h]]||[],l[n[h]]=l[n[h]].concat(r[n[h]])}}return u}(m,o),T="";Object.keys(f).filter(function(a){return a!=="main"}).forEach(function(a){for(var e=0;f[a][e];)e++;f[a].push(e),m[a][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",T=T+"var "+a+" = ("+A.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+f[a].map(function(l){return JSON.stringify(l)+": "+m[a][l].toString()}).join(",")+`});
`}),T=T+"new (("+A.toString().replace("ENTRY_MODULE",JSON.stringify(o))+")({"+f.main.map(function(a){return JSON.stringify(a)+": "+m.main[a].toString()}).join(",")+"}))(self);";var E=new window.Blob([T],{type:"text/javascript"});if(S.bare)return E;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(E),t=new window.Worker(c);return t.objectURL=c,t}},"./src/config.ts":function(F,R,d){d.r(R),d.d(R,"hlsDefaultConfig",function(){return s}),d.d(R,"mergeConfig",function(){return v}),d.d(R,"enableStreamingMode",function(){return g});var A=d("./src/controller/abr-controller.ts"),y=d("./src/controller/audio-stream-controller.ts"),L=d("./src/controller/audio-track-controller.ts"),k=d("./src/controller/subtitle-stream-controller.ts"),w=d("./src/controller/subtitle-track-controller.ts"),D=d("./src/controller/buffer-controller.ts"),o=d("./src/controller/timeline-controller.ts"),S=d("./src/controller/cap-level-controller.ts"),m=d("./src/controller/fps-controller.ts"),f=d("./src/controller/eme-controller.ts"),T=d("./src/utils/xhr-loader.ts"),E=d("./src/utils/fetch-loader.ts"),c=d("./src/utils/cues.ts"),t=d("./src/utils/mediakeys-helper.ts"),a=d("./src/utils/logger.ts");function e(){return(e=Object.assign||function(p){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var h in n)Object.prototype.hasOwnProperty.call(n,h)&&(p[h]=n[h])}return p}).apply(this,arguments)}function l(p,r){var n=Object.keys(p);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(p);r&&(h=h.filter(function(b){return Object.getOwnPropertyDescriptor(p,b).enumerable})),n.push.apply(n,h)}return n}function u(p){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?l(Object(n),!0).forEach(function(h){i(p,h,n[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(p,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(h){Object.defineProperty(p,h,Object.getOwnPropertyDescriptor(n,h))})}return p}function i(p,r,n){return r in p?Object.defineProperty(p,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):p[r]=n,p}var s=u(u({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:T.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:A.default,bufferController:D.default,capLevelController:S.default,fpsController:m.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:t.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:c.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:k.SubtitleStreamController,subtitleTrackController:w.default,timelineController:o.TimelineController,audioStreamController:y.default,audioTrackController:L.default,emeController:f.default});function v(p,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return e({},p,r)}function g(p){var r=p.loader;r!==E.default&&r!==T.default?(a.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),p.progressive=!1):Object(E.fetchSupported)()&&(p.loader=E.default,p.progressive=!0,p.enableSoftwareAES=!0,a.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(F,R,d){d.r(R);var A=d("./src/polyfills/number.ts"),y=d("./src/utils/ewma-bandwidth-estimator.ts"),L=d("./src/events.ts"),k=d("./src/utils/buffer-helper.ts"),w=d("./src/errors.ts"),D=d("./src/types/loader.ts"),o=d("./src/utils/logger.ts");function S(f,T){for(var E=0;E<T.length;E++){var c=T[E];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(f,c.key,c)}}var m=function(){function f(t){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;var a=t.config;this.bwEstimator=new y.default(a.abrEwmaSlowVoD,a.abrEwmaFastVoD,a.abrEwmaDefaultEstimate),this.registerListeners()}var T,E,c=f.prototype;return c.registerListeners=function(){var t=this.hls;t.on(L.Events.FRAG_LOADING,this.onFragLoading,this),t.on(L.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(L.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var t=this.hls;t.off(L.Events.FRAG_LOADING,this.onFragLoading,this),t.off(L.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(L.Events.ERROR,this.onError,this)},c.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},c.onFragLoading=function(t,a){var e,l=a.frag;l.type===D.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=l,this.partCurrent=(e=a.part)!=null?e:null,this.timer=self.setInterval(this.onCheck,100)))},c.onLevelLoaded=function(t,a){var e=this.hls.config;a.details.live?this.bwEstimator.update(e.abrEwmaSlowLive,e.abrEwmaFastLive):this.bwEstimator.update(e.abrEwmaSlowVoD,e.abrEwmaFastVoD)},c._abandonRulesCheck=function(){var t=this.fragCurrent,a=this.partCurrent,e=this.hls,l=e.autoLevelEnabled,u=e.config,i=e.media;if(t&&i){var s=a?a.stats:t.stats,v=a?a.duration:t.duration;if(s.aborted)return o.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(l&&!i.paused&&i.playbackRate&&i.readyState){var g=performance.now()-s.loading.start,p=Math.abs(i.playbackRate);if(!(g<=500*v/p)){var r=e.levels,n=e.minAutoLevel,h=r[t.level],b=s.total||Math.max(s.loaded,Math.round(v*h.maxBitrate/8)),_=Math.max(1,s.bwEstimate?s.bwEstimate/8:1e3*s.loaded/g),I=(b-s.loaded)/_,O=i.currentTime,C=(k.BufferHelper.bufferInfo(i,O,u.maxBufferHole).end-O)/p;if(!(C>=2*v/p||I<=C)){var x,P=Number.POSITIVE_INFINITY;for(x=t.level-1;x>n&&!((P=v*r[x].maxBitrate/(6.4*_))<C);x--);if(!(P>=I)){var N=this.bwEstimator.getEstimate();o.logger.warn("Fragment "+t.sn+(a?" part "+a.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+x+`
      Current BW estimate: `+(Object(A.isFiniteNumber)(N)?(N/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+I.toFixed(3)+` s
      Estimated load time for the next fragment: `+P.toFixed(3)+` s
      Time to underbuffer: `+C.toFixed(3)+" s"),e.nextLoadLevel=x,this.bwEstimator.sample(g,s.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),e.trigger(L.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:a,stats:s})}}}}}},c.onFragLoaded=function(t,a){var e=a.frag,l=a.part;if(e.type===D.PlaylistLevelType.MAIN&&Object(A.isFiniteNumber)(e.sn)){var u=l?l.stats:e.stats,i=l?l.duration:e.duration;if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var s=this.hls.levels[e.level],v=(s.loaded?s.loaded.bytes:0)+u.loaded,g=(s.loaded?s.loaded.duration:0)+i;s.loaded={bytes:v,duration:g},s.realBitrate=Math.round(8*v/g)}if(e.bitrateTest){var p={stats:u,frag:e,part:l,id:e.type};this.onFragBuffered(L.Events.FRAG_BUFFERED,p),e.bitrateTest=!1}}},c.onFragBuffered=function(t,a){var e=a.frag,l=a.part,u=l?l.stats:e.stats;if(!u.aborted&&e.type===D.PlaylistLevelType.MAIN&&e.sn!=="initSegment"){var i=u.parsing.end-u.loading.start;this.bwEstimator.sample(i,u.loaded),u.bwEstimate=this.bwEstimator.getEstimate(),e.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}},c.onError=function(t,a){switch(a.details){case w.ErrorDetails.FRAG_LOAD_ERROR:case w.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},c.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},c.getNextABRAutoLevel=function(){var t=this.fragCurrent,a=this.partCurrent,e=this.hls,l=e.maxAutoLevel,u=e.config,i=e.minAutoLevel,s=e.media,v=a?a.duration:t?t.duration:0,g=s?s.currentTime:0,p=s&&s.playbackRate!==0?Math.abs(s.playbackRate):1,r=this.bwEstimator?this.bwEstimator.getEstimate():u.abrEwmaDefaultEstimate,n=(k.BufferHelper.bufferInfo(s,g,u.maxBufferHole).end-g)/p,h=this.findBestLevel(r,i,l,n,u.abrBandWidthFactor,u.abrBandWidthUpFactor);if(h>=0)return h;o.logger.trace((n?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var b=v?Math.min(v,u.maxStarvationDelay):u.maxStarvationDelay,_=u.abrBandWidthFactor,I=u.abrBandWidthUpFactor;if(!n){var O=this.bitrateTestDelay;O&&(b=(v?Math.min(v,u.maxLoadingDelay):u.maxLoadingDelay)-O,o.logger.trace("bitrate test took "+Math.round(1e3*O)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*b)+" ms"),_=I=1)}return h=this.findBestLevel(r,i,l,n+b,_,I),Math.max(h,0)},c.findBestLevel=function(t,a,e,l,u,i){for(var s,v=this.fragCurrent,g=this.partCurrent,p=this.lastLoadedFragLevel,r=this.hls.levels,n=r[p],h=!(n==null||(s=n.details)===null||s===void 0||!s.live),b=n==null?void 0:n.codecSet,_=g?g.duration:v?v.duration:0,I=e;I>=a;I--){var O=r[I];if(O&&(!b||O.codecSet===b)){var C=O.details,x=(g?C==null?void 0:C.partTarget:C==null?void 0:C.averagetargetduration)||_,P=void 0;P=I<=p?u*t:i*t;var N=r[I].maxBitrate,M=N*x/P;if(o.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+I+"/"+Math.round(P)+"/"+N+"/"+x+"/"+l+"/"+M),P>N&&(!M||h&&!this.bitrateTestDelay||M<l))return I}}return-1},T=f,(E=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,a=this.bwEstimator;if(!(t===-1||a&&a.canEstimate()))return t;var e=this.getNextABRAutoLevel();return t!==-1&&(e=Math.min(t,e)),e},set:function(t){this._nextAutoLevel=t}}])&&S(T.prototype,E),f}();R.default=m},"./src/controller/audio-stream-controller.ts":function(F,R,d){d.r(R);var A=d("./src/polyfills/number.ts"),y=d("./src/controller/base-stream-controller.ts"),L=d("./src/events.ts"),k=d("./src/utils/buffer-helper.ts"),w=d("./src/controller/fragment-tracker.ts"),D=d("./src/types/level.ts"),o=d("./src/types/loader.ts"),S=d("./src/loader/fragment.ts"),m=d("./src/demux/chunk-cache.ts"),f=d("./src/demux/transmuxer-interface.ts"),T=d("./src/types/transmuxer.ts"),E=d("./src/controller/fragment-finders.ts"),c=d("./src/utils/discontinuities.ts"),t=d("./src/errors.ts"),a=d("./src/utils/logger.ts");function e(){return(e=Object.assign||function(i){for(var s=1;s<arguments.length;s++){var v=arguments[s];for(var g in v)Object.prototype.hasOwnProperty.call(v,g)&&(i[g]=v[g])}return i}).apply(this,arguments)}function l(i,s){return(l=Object.setPrototypeOf||function(v,g){return v.__proto__=g,v})(i,s)}var u=function(i){var s,v;function g(r,n){var h;return(h=i.call(this,r,n,"[audio-stream-controller]")||this).videoBuffer=null,h.videoTrackCC=-1,h.waitingVideoCC=-1,h.audioSwitch=!1,h.trackId=-1,h.waitingData=null,h.mainDetails=null,h.bufferFlushed=!1,h._registerListeners(),h}v=i,(s=g).prototype=Object.create(v.prototype),s.prototype.constructor=s,l(s,v);var p=g.prototype;return p.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},p._registerListeners=function(){var r=this.hls;r.on(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(L.Events.ERROR,this.onError,this),r.on(L.Events.BUFFER_RESET,this.onBufferReset,this),r.on(L.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},p._unregisterListeners=function(){var r=this.hls;r.off(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(L.Events.ERROR,this.onError,this),r.off(L.Events.BUFFER_RESET,this.onBufferReset,this),r.off(L.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},p.onInitPtsFound=function(r,n){var h=n.frag,b=n.id,_=n.initPTS;if(b==="main"){var I=h.cc;this.initPTS[h.cc]=_,this.log("InitPTS for cc: "+I+" found from main: "+_),this.videoTrackCC=I,this.state===y.State.WAITING_INIT_PTS&&this.tick()}},p.startLoad=function(r){if(!this.levels)return this.startPosition=r,void(this.state=y.State.STOPPED);var n=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,n>0&&r===-1?(this.log("Override startPosition with lastCurrentTime @"+n.toFixed(3)),this.state=y.State.IDLE):(this.loadedmetadata=!1,this.state=y.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},p.doTick=function(){switch(this.state){case y.State.IDLE:this.doTickIdle();break;case y.State.WAITING_TRACK:var r,n=this.levels,h=this.trackId,b=n==null||(r=n[h])===null||r===void 0?void 0:r.details;if(b){if(this.waitForCdnTuneIn(b))break;this.state=y.State.WAITING_INIT_PTS}break;case y.State.FRAG_LOADING_WAITING_RETRY:var _,I=performance.now(),O=this.retryDate;(!O||I>=O||(_=this.media)!==null&&_!==void 0&&_.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=y.State.IDLE);break;case y.State.WAITING_INIT_PTS:var C=this.waitingData;if(C){var x=C.frag,P=C.part,N=C.cache,M=C.complete;if(this.initPTS[x.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=y.State.FRAG_LOADING;var B={frag:x,part:P,payload:N.flush(),networkDetails:null};this._handleFragmentLoadProgress(B),M&&i.prototype._handleFragmentLoadComplete.call(this,B)}else if(this.videoTrackCC!==this.waitingVideoCC)a.logger.log("Waiting fragment cc ("+x.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var G=this.getLoadPosition(),K=k.BufferHelper.bufferInfo(this.mediaBuffer,G,this.config.maxBufferHole);Object(E.fragmentWithinToleranceTest)(K.end,this.config.maxFragLookUpTolerance,x)<0&&(a.logger.log("Waiting fragment cc ("+x.cc+") @ "+x.start+" cancelled because another fragment at "+K.end+" is needed"),this.clearWaitingFragment())}}else this.state=y.State.IDLE}this.onTickEnd()},p.clearWaitingFragment=function(){var r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=y.State.IDLE)},p.onTickEnd=function(){var r=this.media;if(r&&r.readyState){var n=(this.mediaBuffer?this.mediaBuffer:r).buffered;!this.loadedmetadata&&n.length&&(this.loadedmetadata=!0),this.lastCurrentTime=r.currentTime}},p.doTickIdle=function(){var r,n,h=this.hls,b=this.levels,_=this.media,I=this.trackId,O=h.config;if(b&&b[I]&&(_||!this.startFragRequested&&O.startFragPrefetch)){var C=b[I].details;if(!C||C.live&&this.levelLastLoaded!==I||this.waitForCdnTuneIn(C))this.state=y.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,S.ElementaryStreamTypes.AUDIO,o.PlaylistLevelType.AUDIO));var x=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,o.PlaylistLevelType.AUDIO);if(x!==null){var P=x.len,N=this.getMaxBufferLength(),M=this.audioSwitch;if(!(P>=N)||M){if(!M&&this._streamEnded(x,C))return h.trigger(L.Events.BUFFER_EOS,{type:"audio"}),void(this.state=y.State.ENDED);var B=C.fragments[0].start,G=x.end;if(M){var K=this.getLoadPosition();G=K,C.PTSKnown&&K<B&&(x.end>B||x.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),_.currentTime=B+.05)}var V=this.getNextFragment(G,C);V?((r=V.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(n=V.decryptdata)!==null&&n!==void 0&&n.key?this.loadFragment(V,C,G):this.loadKey(V,C):this.bufferFlushed=!0}}}}},p.getMaxBufferLength=function(){var r=i.prototype.getMaxBufferLength.call(this),n=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,o.PlaylistLevelType.MAIN);return n===null?r:Math.max(r,n.len)},p.onMediaDetaching=function(){this.videoBuffer=null,i.prototype.onMediaDetaching.call(this)},p.onAudioTracksUpdated=function(r,n){var h=n.audioTracks;this.resetTransmuxer(),this.levels=h.map(function(b){return new D.Level(b)})},p.onAudioTrackSwitching=function(r,n){var h=!!n.url;this.trackId=n.id;var b=this.fragCurrent;b!=null&&b.loader&&b.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),h?this.setInterval(100):this.resetTransmuxer(),h?(this.audioSwitch=!0,this.state=y.State.IDLE):this.state=y.State.STOPPED,this.tick()},p.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},p.onLevelLoaded=function(r,n){this.mainDetails=n.details},p.onAudioTrackLoaded=function(r,n){var h,b=this.levels,_=n.details,I=n.id;if(b){this.log("Track "+I+" loaded ["+_.startSN+","+_.endSN+"],duration:"+_.totalduration);var O=b[I],C=0;if(_.live||(h=O.details)!==null&&h!==void 0&&h.live){var x=this.mainDetails;if(_.fragments[0]||(_.deltaUpdateFailed=!0),_.deltaUpdateFailed||!x)return;!O.details&&_.hasProgramDateTime&&x.hasProgramDateTime?(Object(c.alignPDT)(_,x),C=_.fragments[0].start):C=this.alignPlaylists(_,O.details)}O.details=_,this.levelLastLoaded=I,this.startFragRequested||!this.mainDetails&&_.live||this.setStartPosition(O.details,C),this.state!==y.State.WAITING_TRACK||this.waitForCdnTuneIn(_)||(this.state=y.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+I)},p._handleFragmentLoadProgress=function(r){var n,h=r.frag,b=r.part,_=r.payload,I=this.config,O=this.trackId,C=this.levels;if(C){var x=C[O];console.assert(x,"Audio track is defined on fragment load progress");var P=x.details;console.assert(P,"Audio track details are defined on fragment load progress");var N=I.defaultAudioCodec||x.audioCodec||"mp4a.40.2",M=this.transmuxer;M||(M=this.transmuxer=new f.default(this.hls,o.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var B=this.initPTS[h.cc],G=(n=h.initSegment)===null||n===void 0?void 0:n.data;if(B!==void 0){var K=b?b.index:-1,V=K!==-1,H=new T.ChunkMetadata(h.level,h.sn,h.stats.chunkCount,_.byteLength,K,V);M.push(_,G,N,"",h,b,P.totalduration,!1,H,B)}else a.logger.log("Unknown video PTS for cc "+h.cc+", waiting for video PTS before demuxing audio frag "+h.sn+" of ["+P.startSN+" ,"+P.endSN+"],track "+O),(this.waitingData=this.waitingData||{frag:h,part:b,cache:new m.default,complete:!1}).cache.push(new Uint8Array(_)),this.waitingVideoCC=this.videoTrackCC,this.state=y.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+h.sn+" of level "+h.level+" will not be buffered")},p._handleFragmentLoadComplete=function(r){this.waitingData?this.waitingData.complete=!0:i.prototype._handleFragmentLoadComplete.call(this,r)},p.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},p.onBufferCreated=function(r,n){var h=n.tracks.audio;h&&(this.mediaBuffer=h.buffer),n.tracks.video&&(this.videoBuffer=n.tracks.video.buffer)},p.onFragBuffered=function(r,n){var h=n.frag,b=n.part;h.type===o.PlaylistLevelType.AUDIO&&(this.fragContextChanged(h)?this.warn("Fragment "+h.sn+(b?" p: "+b.index:"")+" of level "+h.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):(h.sn!=="initSegment"&&(this.fragPrevious=h,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(h,b)))},p.onError=function(r,n){switch(n.details){case t.ErrorDetails.FRAG_LOAD_ERROR:case t.ErrorDetails.FRAG_LOAD_TIMEOUT:case t.ErrorDetails.KEY_LOAD_ERROR:case t.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.AUDIO,n);break;case t.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case t.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==y.State.ERROR&&this.state!==y.State.STOPPED&&(this.state=n.fatal?y.State.ERROR:y.State.IDLE,this.warn(n.details+" while loading frag, switching to "+this.state+" state"));break;case t.ErrorDetails.BUFFER_FULL_ERROR:if(n.parent==="audio"&&(this.state===y.State.PARSING||this.state===y.State.PARSED)){var h=!0,b=this.getFwdBufferInfo(this.mediaBuffer,o.PlaylistLevelType.AUDIO);b&&b.len>.5&&(h=!this.reduceMaxBufferLength(b.len)),h&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,i.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},p.onBufferFlushed=function(r,n){n.type===S.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},p._handleTransmuxComplete=function(r){var n,h="audio",b=this.hls,_=r.remuxResult,I=r.chunkMeta,O=this.getCurrentContext(I);if(!O)return this.warn("The loading context changed while buffering fragment "+I.sn+" of level "+I.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(I.level);var C=O.frag,x=O.part,P=_.audio,N=_.text,M=_.id3,B=_.initSegment;if(!this.fragContextChanged(C)){if(this.state=y.State.PARSING,this.audioSwitch&&P&&this.completeAudioSwitch(),B!=null&&B.tracks&&(this._bufferInitSegment(B.tracks,C,I),b.trigger(L.Events.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:h,tracks:B.tracks})),P){var G=P.startPTS,K=P.endPTS,V=P.startDTS,H=P.endDTS;x&&(x.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:G,endPTS:K,startDTS:V,endDTS:H}),C.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,G,K,V,H),this.bufferFragmentData(P,C,x,I)}if(M!=null&&(n=M.samples)!==null&&n!==void 0&&n.length){var W=e({frag:C,id:h},M);b.trigger(L.Events.FRAG_PARSING_METADATA,W)}if(N){var Y=e({frag:C,id:h},N);b.trigger(L.Events.FRAG_PARSING_USERDATA,Y)}}},p._bufferInitSegment=function(r,n,h){if(this.state===y.State.PARSING){r.video&&delete r.video;var b=r.audio;if(b){b.levelCodec=b.codec,b.id="audio",this.log("Init audio buffer, container:"+b.container+", codecs[parsed]=["+b.codec+"]"),this.hls.trigger(L.Events.BUFFER_CODECS,r);var _=b.initSegment;if(_!=null&&_.byteLength){var I={type:"audio",frag:n,part:null,chunkMeta:h,parent:n.type,data:_};this.hls.trigger(L.Events.BUFFER_APPENDING,I)}this.tick()}}},p.loadFragment=function(r,n,h){var b=this.fragmentTracker.getState(r);this.fragCurrent=r,(this.audioSwitch||b===w.FragmentState.NOT_LOADED||b===w.FragmentState.PARTIAL)&&(r.sn==="initSegment"?this._loadInitSegment(r):n.live&&!Object(A.isFiniteNumber)(this.initPTS[r.cc])?(this.log("Waiting for video PTS in continuity counter "+r.cc+" of live stream before loading audio fragment "+r.sn+" of level "+this.trackId),this.state=y.State.WAITING_INIT_PTS):(this.startFragRequested=!0,i.prototype.loadFragment.call(this,r,n,h)))},p.completeAudioSwitch=function(){var r=this.hls,n=this.media,h=this.trackId;n&&(this.log("Switching audio track : flushing all audio"),i.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,r.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:h})},g}(y.default);R.default=u},"./src/controller/audio-track-controller.ts":function(F,R,d){d.r(R);var A=d("./src/events.ts"),y=d("./src/errors.ts"),L=d("./src/controller/base-playlist-controller.ts"),k=d("./src/types/loader.ts");function w(S,m){for(var f=0;f<m.length;f++){var T=m[f];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(S,T.key,T)}}function D(S,m){return(D=Object.setPrototypeOf||function(f,T){return f.__proto__=T,f})(S,m)}var o=function(S){var m,f;function T(a){var e;return(e=S.call(this,a,"[audio-track-controller]")||this).tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.trackName="",e.selectDefaultTrack=!0,e.registerListeners(),e}f=S,(m=T).prototype=Object.create(f.prototype),m.prototype.constructor=m,D(m,f);var E,c,t=T.prototype;return t.registerListeners=function(){var a=this.hls;a.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.on(A.Events.LEVEL_LOADING,this.onLevelLoading,this),a.on(A.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.on(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(A.Events.ERROR,this.onError,this)},t.unregisterListeners=function(){var a=this.hls;a.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),a.off(A.Events.LEVEL_LOADING,this.onLevelLoading,this),a.off(A.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),a.off(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(A.Events.ERROR,this.onError,this)},t.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,S.prototype.destroy.call(this)},t.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},t.onManifestParsed=function(a,e){this.tracks=e.audioTracks||[]},t.onAudioTrackLoaded=function(a,e){var l=e.id,u=e.details,i=this.tracksInGroup[l];if(i){var s=i.details;i.details=e.details,this.log("audioTrack "+l+" loaded ["+u.startSN+"-"+u.endSN+"]"),l===this.trackId&&(this.retryCount=0,this.playlistLoaded(l,e,s))}else this.warn("Invalid audio track id "+l)},t.onLevelLoading=function(a,e){this.switchLevel(e.level)},t.onLevelSwitching=function(a,e){this.switchLevel(e.level)},t.switchLevel=function(a){var e=this.hls.levels[a];if(e!=null&&e.audioGroupIds){var l=e.audioGroupIds[e.urlId];if(this.groupId!==l){this.groupId=l;var u=this.tracks.filter(function(s){return!l||s.groupId===l});this.selectDefaultTrack&&!u.some(function(s){return s.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=u;var i={audioTracks:u};this.log("Updating audio tracks, "+u.length+' track(s) found in "'+l+'" group-id'),this.hls.trigger(A.Events.AUDIO_TRACKS_UPDATED,i),this.selectInitialTrack()}}},t.onError=function(a,e){S.prototype.onError.call(this,a,e),!e.fatal&&e.context&&e.context.type===k.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},t.setAudioTrack=function(a){var e=this.tracksInGroup;if(a<0||a>=e.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var l=e[this.trackId];this.log("Now switching to audio-track index "+a);var u=e[a],i=u.id,s=u.groupId,v=s===void 0?"":s,g=u.name,p=u.type,r=u.url;if(this.trackId=a,this.trackName=g,this.selectDefaultTrack=!1,this.hls.trigger(A.Events.AUDIO_TRACK_SWITCHING,{id:i,groupId:v,name:g,type:p,url:r}),!u.details||u.details.live){var n=this.switchParams(u.url,l==null?void 0:l.details);this.loadPlaylist(n)}}},t.selectInitialTrack=function(){var a=this.tracksInGroup;console.assert(a.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,l=this.findTrackId(e)||this.findTrackId();l!==-1?this.setAudioTrack(l):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(A.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},t.findTrackId=function(a){for(var e=this.tracksInGroup,l=0;l<e.length;l++){var u=e[l];if((!this.selectDefaultTrack||u.default)&&(!a||a===u.name))return u.id}return-1},t.loadPlaylist=function(a){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var l=e.id,u=e.groupId,i=e.url;if(a)try{i=a.addDirectives(i)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("loading audio-track playlist for id: "+l),this.clearTimer(),this.hls.trigger(A.Events.AUDIO_TRACK_LOADING,{url:i,id:l,groupId:u,deliveryDirectives:a||null})}},E=T,(c=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(a){this.selectDefaultTrack=!1,this.setAudioTrack(a)}}])&&w(E.prototype,c),T}(L.default);R.default=o},"./src/controller/base-playlist-controller.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return D});var A=d("./src/polyfills/number.ts"),y=d("./src/types/level.ts"),L=d("./src/controller/level-helper.ts"),k=d("./src/utils/logger.ts"),w=d("./src/errors.ts"),D=function(){function o(m,f){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=k.logger.log.bind(k.logger,f+":"),this.warn=k.logger.warn.bind(k.logger,f+":"),this.hls=m}var S=o.prototype;return S.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},S.onError=function(m,f){f.fatal&&f.type===w.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},S.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},S.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},S.stopLoad=function(){this.canLoad=!1,this.clearTimer()},S.switchParams=function(m,f){var T=f==null?void 0:f.renditionReports;if(T)for(var E=0;E<T.length;E++){var c=T[E],t=""+c.URI;if(t===m.substr(-t.length)){var a=parseInt(c["LAST-MSN"]),e=parseInt(c["LAST-PART"]);if(f&&this.hls.config.lowLatencyMode){var l=Math.min(f.age-f.partTarget,f.targetduration);e!==void 0&&l>f.partTarget&&(e+=1)}if(Object(A.isFiniteNumber)(a))return new y.HlsUrlParameters(a,Object(A.isFiniteNumber)(e)?e:void 0,y.HlsSkip.No)}}},S.loadPlaylist=function(m){},S.shouldLoadTrack=function(m){return this.canLoad&&m&&!!m.url&&(!m.details||m.details.live)},S.playlistLoaded=function(m,f,T){var E=this,c=f.details,t=f.stats,a=t.loading.end?Math.max(0,self.performance.now()-t.loading.end):0;if(c.advancedDateTime=Date.now()-a,c.live||T!=null&&T.live){if(c.reloaded(T),T&&this.log("live playlist "+m+" "+(c.advanced?"REFRESHED "+c.lastPartSn+"-"+c.lastPartIndex:"MISSED")),T&&c.fragments.length>0&&Object(L.mergeDetails)(T,c),!this.canLoad||!c.live)return;var e,l=void 0,u=void 0;if(c.canBlockReload&&c.endSN&&c.advanced){var i=this.hls.config.lowLatencyMode,s=c.lastPartSn,v=c.endSN,g=c.lastPartIndex,p=s===v;g!==-1?(l=p?v+1:s,u=p?i?0:g:g+1):l=v+1;var r=c.age,n=r+c.ageHeader,h=Math.min(n-c.partTarget,1.5*c.targetduration);if(h>0){if(T&&h>T.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+T.tuneInGoal+" to: "+h+" with playlist age: "+c.age),h=0;else{var b=Math.floor(h/c.targetduration);l+=b,u!==void 0&&(u+=Math.round(h%c.targetduration/c.partTarget)),this.log("CDN Tune-in age: "+c.ageHeader+"s last advanced "+r.toFixed(2)+"s goal: "+h+" skip sn "+b+" to part "+u)}c.tuneInGoal=h}if(e=this.getDeliveryDirectives(c,f.deliveryDirectives,l,u),i||!p)return void this.loadPlaylist(e)}else e=this.getDeliveryDirectives(c,f.deliveryDirectives,l,u);var _=Object(L.computeReloadInterval)(c,t);l!==void 0&&c.canBlockReload&&(_-=c.partTarget||1),this.log("reload live playlist "+m+" in "+Math.round(_)+" ms"),this.timer=self.setTimeout(function(){return E.loadPlaylist(e)},_)}else this.clearTimer()},S.getDeliveryDirectives=function(m,f,T,E){var c=Object(y.getSkipValue)(m,T);return f!=null&&f.skip&&m.deltaUpdateFailed&&(T=f.msn,E=f.part,c=y.HlsSkip.No),new y.HlsUrlParameters(T,E,c)},S.retryLoadingOrFail=function(m){var f,T=this,E=this.hls.config,c=this.retryCount<E.levelLoadingMaxRetry;if(c)if(this.retryCount++,m.details.indexOf("LoadTimeOut")>-1&&(f=m.context)!==null&&f!==void 0&&f.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+m.details+'"'),this.loadPlaylist();else{var t=Math.min(Math.pow(2,this.retryCount)*E.levelLoadingRetryDelay,E.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return T.loadPlaylist()},t),this.warn("retry playlist loading #"+this.retryCount+" in "+t+' ms after "'+m.details+'"')}else this.warn('cannot recover from error "'+m.details+'"'),this.clearTimer(),m.fatal=!0;return c},o}()},"./src/controller/base-stream-controller.ts":function(F,R,d){d.r(R),d.d(R,"State",function(){return i}),d.d(R,"default",function(){return s});var A=d("./src/polyfills/number.ts"),y=d("./src/task-loop.ts"),L=d("./src/controller/fragment-tracker.ts"),k=d("./src/utils/buffer-helper.ts"),w=d("./src/utils/logger.ts"),D=d("./src/events.ts"),o=d("./src/errors.ts"),S=d("./src/types/transmuxer.ts"),m=d("./src/utils/mp4-tools.ts"),f=d("./src/utils/discontinuities.ts"),T=d("./src/controller/fragment-finders.ts"),E=d("./src/controller/level-helper.ts"),c=d("./src/loader/fragment-loader.ts"),t=d("./src/crypt/decrypter.ts"),a=d("./src/utils/time-ranges.ts"),e=d("./src/types/loader.ts");function l(v,g){for(var p=0;p<g.length;p++){var r=g[p];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(v,r.key,r)}}function u(v,g){return(u=Object.setPrototypeOf||function(p,r){return p.__proto__=r,p})(v,g)}var i={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},s=function(v){var g,p;function r(_,I,O){var C;return(C=v.call(this)||this).hls=void 0,C.fragPrevious=null,C.fragCurrent=null,C.fragmentTracker=void 0,C.transmuxer=null,C._state=i.STOPPED,C.media=void 0,C.mediaBuffer=void 0,C.config=void 0,C.bitrateTest=!1,C.lastCurrentTime=0,C.nextLoadPosition=0,C.startPosition=0,C.loadedmetadata=!1,C.fragLoadError=0,C.retryDate=0,C.levels=null,C.fragmentLoader=void 0,C.levelLastLoaded=null,C.startFragRequested=!1,C.decrypter=void 0,C.initPTS=[],C.onvseeking=null,C.onvended=null,C.logPrefix="",C.log=void 0,C.warn=void 0,C.logPrefix=O,C.log=w.logger.log.bind(w.logger,O+":"),C.warn=w.logger.warn.bind(w.logger,O+":"),C.hls=_,C.fragmentLoader=new c.default(_.config),C.fragmentTracker=I,C.config=_.config,C.decrypter=new t.default(_,_.config),_.on(D.Events.KEY_LOADED,C.onKeyLoaded,function(x){if(x===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return x}(C)),C}p=v,(g=r).prototype=Object.create(p.prototype),g.prototype.constructor=g,u(g,p);var n,h,b=r.prototype;return b.doTick=function(){this.onTickEnd()},b.onTickEnd=function(){},b.startLoad=function(_){},b.stopLoad=function(){this.fragmentLoader.abort();var _=this.fragCurrent;_&&this.fragmentTracker.removeFragment(_),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=i.STOPPED},b._streamEnded=function(_,I){var O=this.fragCurrent,C=this.fragmentTracker;if(!I.live&&O&&O.sn===I.endSN&&!_.nextStart){var x=C.getState(O);return x===L.FragmentState.PARTIAL||x===L.FragmentState.OK}return!1},b.onMediaAttached=function(_,I){var O=this.media=this.mediaBuffer=I.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),O.addEventListener("seeking",this.onvseeking),O.addEventListener("ended",this.onvended);var C=this.config;this.levels&&C.autoStartLoad&&this.state===i.STOPPED&&this.startLoad(C.startPosition)},b.onMediaDetaching=function(){var _=this.media;_!=null&&_.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),_&&(_.removeEventListener("seeking",this.onvseeking),_.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},b.onMediaSeeking=function(){var _=this.config,I=this.fragCurrent,O=this.media,C=this.mediaBuffer,x=this.state,P=O?O.currentTime:0,N=k.BufferHelper.bufferInfo(C||O,P,_.maxBufferHole);if(this.log("media seeking to "+(Object(A.isFiniteNumber)(P)?P.toFixed(3):P)+", state: "+x),x===i.ENDED)this.resetLoadingState();else if(I&&!N.len){var M=_.maxFragLookUpTolerance,B=I.start-M,G=P>I.start+I.duration+M;(P<B||G)&&(G&&I.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),I.loader.abort()),this.resetLoadingState())}O&&(this.lastCurrentTime=P),this.loadedmetadata||N.len||(this.nextLoadPosition=this.startPosition=P),this.tickImmediate()},b.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},b.onKeyLoaded=function(_,I){if(this.state===i.KEY_LOADING&&I.frag===this.fragCurrent&&this.levels){this.state=i.IDLE;var O=this.levels[I.frag.level].details;O&&this.loadFragment(I.frag,O,I.frag.start)}},b.onHandlerDestroying=function(){this.stopLoad(),v.prototype.onHandlerDestroying.call(this)},b.onHandlerDestroyed=function(){this.state=i.STOPPED,this.hls.off(D.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,v.prototype.onHandlerDestroyed.call(this)},b.loadKey=function(_,I){this.log("Loading key for "+_.sn+" of ["+I.startSN+"-"+I.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+_.level),this.state=i.KEY_LOADING,this.fragCurrent=_,this.hls.trigger(D.Events.KEY_LOADING,{frag:_})},b.loadFragment=function(_,I,O){this._loadFragForPlayback(_,I,O)},b._loadFragForPlayback=function(_,I,O){var C=this;this._doFragLoad(_,I,O,function(x){if(C.fragContextChanged(_))return C.warn("Fragment "+_.sn+(x.part?" p: "+x.part.index:"")+" of level "+_.level+" was dropped during download."),void C.fragmentTracker.removeFragment(_);_.stats.chunkCount++,C._handleFragmentLoadProgress(x)}).then(function(x){if(x){C.fragLoadError=0;var P=C.state;if(!C.fragContextChanged(_))return"payload"in x&&(C.log("Loaded fragment "+_.sn+" of level "+_.level),C.hls.trigger(D.Events.FRAG_LOADED,x),C.state===i.BACKTRACKING)?(C.fragmentTracker.backtrack(_,x),void C.resetFragmentLoading(_)):void C._handleFragmentLoadComplete(x);(P===i.FRAG_LOADING||P===i.BACKTRACKING||!C.fragCurrent&&P===i.PARSING)&&(C.fragmentTracker.removeFragment(_),C.state=i.IDLE)}}).catch(function(x){C.warn(x),C.resetFragmentLoading(_)})},b.flushMainBuffer=function(_,I,O){if(O===void 0&&(O=null),_-I){var C={startOffset:_,endOffset:I,type:O};this.fragLoadError=0,this.hls.trigger(D.Events.BUFFER_FLUSHING,C)}},b._loadInitSegment=function(_){var I=this;this._doFragLoad(_).then(function(O){if(!O||I.fragContextChanged(_)||!I.levels)throw new Error("init load aborted");return O}).then(function(O){var C=I.hls,x=O.payload,P=_.decryptdata;if(x&&x.byteLength>0&&P&&P.key&&P.iv&&P.method==="AES-128"){var N=self.performance.now();return I.decrypter.webCryptoDecrypt(new Uint8Array(x),P.key.buffer,P.iv.buffer).then(function(M){var B=self.performance.now();return C.trigger(D.Events.FRAG_DECRYPTED,{frag:_,payload:M,stats:{tstart:N,tdecrypt:B}}),O.payload=M,O})}return O}).then(function(O){var C=I.fragCurrent,x=I.hls,P=I.levels;if(!P)throw new Error("init load aborted, missing levels");var N=P[_.level].details;console.assert(N,"Level details are defined when init segment is loaded");var M=_.stats;I.state=i.IDLE,I.fragLoadError=0,_.data=new Uint8Array(O.payload),M.parsing.start=M.buffering.start=self.performance.now(),M.parsing.end=M.buffering.end=self.performance.now(),O.frag===C&&x.trigger(D.Events.FRAG_BUFFERED,{stats:M,frag:C,part:null,id:_.type}),I.tick()}).catch(function(O){I.warn(O),I.resetFragmentLoading(_)})},b.fragContextChanged=function(_){var I=this.fragCurrent;return!_||!I||_.level!==I.level||_.sn!==I.sn||_.urlId!==I.urlId},b.fragBufferedComplete=function(_,I){var O=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+_.type+" sn: "+_.sn+(I?" part: "+I.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+_.level+" "+a.default.toString(k.BufferHelper.getBuffered(O))),this.state=i.IDLE,this.tick()},b._handleFragmentLoadComplete=function(_){var I=this.transmuxer;if(I){var O=_.frag,C=_.part,x=_.partsLoaded,P=!x||x.length===0||x.some(function(M){return!M}),N=new S.ChunkMetadata(O.level,O.sn,O.stats.chunkCount+1,0,C?C.index:-1,!P);I.flush(N)}},b._handleFragmentLoadProgress=function(_){},b._doFragLoad=function(_,I,O,C){var x=this;if(O===void 0&&(O=null),!this.levels)throw new Error("frag load aborted, missing levels");if(O=Math.max(_.start,O||0),this.config.lowLatencyMode&&I){var P=I.partList;if(P&&C){O>_.end&&I.fragmentHint&&(_=I.fragmentHint);var N=this.getNextPart(P,_,O);if(N>-1){var M=P[N];return this.log("Loading part sn: "+_.sn+" p: "+M.index+" cc: "+_.cc+" of playlist ["+I.startSN+"-"+I.endSN+"] parts [0-"+N+"-"+(P.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+_.level+", target: "+parseFloat(O.toFixed(3))),this.nextLoadPosition=M.start+M.duration,this.state=i.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:_,part:P[N],targetBufferTime:O}),this.doFragPartsLoad(_,P,N,C).catch(function(B){return x.handleFragLoadError(B)})}if(!_.url||this.loadedEndOfParts(P,O))return Promise.resolve(null)}}return this.log("Loading fragment "+_.sn+" cc: "+_.cc+" "+(I?"of ["+I.startSN+"-"+I.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+_.level+", target: "+parseFloat(O.toFixed(3))),Object(A.isFiniteNumber)(_.sn)&&!this.bitrateTest&&(this.nextLoadPosition=_.start+_.duration),this.state=i.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:_,targetBufferTime:O}),this.fragmentLoader.load(_,C).catch(function(B){return x.handleFragLoadError(B)})},b.doFragPartsLoad=function(_,I,O,C){var x=this;return new Promise(function(P,N){var M=[];(function B(G){var K=I[G];x.fragmentLoader.loadPart(_,K,C).then(function(V){M[K.index]=V;var H=V.part;x.hls.trigger(D.Events.FRAG_LOADED,V);var W=I[G+1];if(!W||W.fragment!==_)return P({frag:_,part:H,partsLoaded:M});B(G+1)}).catch(N)})(O)})},b.handleFragLoadError=function(_){var I=_.data;return I&&I.details===o.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(I.frag,I.part):this.hls.trigger(D.Events.ERROR,I),null},b._handleTransmuxerFlush=function(_){var I=this.getCurrentContext(_);if(I&&this.state===i.PARSING){var O=I.frag,C=I.part,x=I.level,P=self.performance.now();O.stats.parsing.end=P,C&&(C.stats.parsing.end=P),this.updateLevelTiming(O,C,x,_.partial)}else this.fragCurrent||(this.state=i.IDLE)},b.getCurrentContext=function(_){var I=this.levels,O=_.level,C=_.sn,x=_.part;if(!I||!I[O])return this.warn("Levels object was unset while buffering fragment "+C+" of level "+O+". The current chunk will not be buffered."),null;var P=I[O],N=x>-1?Object(E.getPartWith)(P,C,x):null,M=N?N.fragment:Object(E.getFragmentWithSN)(P,C,this.fragCurrent);return M?{frag:M,part:N,level:P}:null},b.bufferFragmentData=function(_,I,O,C){if(_&&this.state===i.PARSING){var x=_.data1,P=_.data2,N=x;if(x&&P&&(N=Object(m.appendUint8Array)(x,P)),N&&N.length){var M={type:_.type,frag:I,part:O,chunkMeta:C,parent:I.type,data:N};this.hls.trigger(D.Events.BUFFER_APPENDING,M),_.dropped&&_.independent&&!O&&this.flushBufferGap(I)}}},b.flushBufferGap=function(_){var I=this.media;if(I)if(k.BufferHelper.isBuffered(I,I.currentTime)){var O=I.currentTime,C=k.BufferHelper.bufferInfo(I,O,0),x=_.duration,P=Math.min(2*this.config.maxFragLookUpTolerance,.25*x),N=Math.max(Math.min(_.start-P,C.end-P),O+P);_.start-N>P&&this.flushMainBuffer(N,_.start)}else this.flushMainBuffer(0,_.start)},b.getFwdBufferInfo=function(_,I){var O=this.config,C=this.getLoadPosition();if(!Object(A.isFiniteNumber)(C))return null;var x=k.BufferHelper.bufferInfo(_,C,O.maxBufferHole);if(x.len===0&&x.nextStart!==void 0){var P=this.fragmentTracker.getBufferedFrag(C,I);if(P&&x.nextStart<P.end)return k.BufferHelper.bufferInfo(_,C,Math.max(x.nextStart,O.maxBufferHole))}return x},b.getMaxBufferLength=function(_){var I,O=this.config;return I=_?Math.max(8*O.maxBufferSize/_,O.maxBufferLength):O.maxBufferLength,Math.min(I,O.maxMaxBufferLength)},b.reduceMaxBufferLength=function(_){var I=this.config,O=_||I.maxBufferLength;return I.maxMaxBufferLength>=O&&(I.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+I.maxMaxBufferLength+"s"),!0)},b.getNextFragment=function(_,I){var O,C,x=I.fragments,P=x.length;if(!P)return null;var N,M=this.config,B=x[0].start;if(I.live){var G=M.initialLiveManifestSize;if(P<G)return this.warn("Not enough fragments to start playback (have: "+P+", need: "+G+")"),null;I.PTSKnown||this.startFragRequested||this.startPosition!==-1||(N=this.getInitialLiveFragment(I,x),this.startPosition=N?this.hls.liveSyncPosition||N.start:_)}else _<=B&&(N=x[0]);if(!N){var K=M.lowLatencyMode?I.partEnd:I.fragmentEnd;N=this.getFragmentAtPosition(_,K,I)}return(O=N)===null||O===void 0||!O.initSegment||(C=N)!==null&&C!==void 0&&C.initSegment.data||this.bitrateTest||(N=N.initSegment),N},b.getNextPart=function(_,I,O){for(var C=-1,x=!1,P=!0,N=0,M=_.length;N<M;N++){var B=_[N];if(P=P&&!B.independent,C>-1&&O<B.start)break;var G=B.loaded;!G&&(x||B.independent||P)&&B.fragment===I&&(C=N),x=G}return C},b.loadedEndOfParts=function(_,I){var O=_[_.length-1];return O&&I>O.start&&O.loaded},b.getInitialLiveFragment=function(_,I){var O=this.fragPrevious,C=null;if(O){if(_.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+O.programDateTime),C=Object(T.findFragmentByPDT)(I,O.endProgramDateTime,this.config.maxFragLookUpTolerance)),!C){var x=O.sn+1;if(x>=_.startSN&&x<=_.endSN){var P=I[x-_.startSN];O.cc===P.cc&&(C=P,this.log("Live playlist, switching playlist, load frag with next SN: "+C.sn))}C||(C=Object(T.findFragWithCC)(I,O.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+C.sn)}}else{var N=this.hls.liveSyncPosition;N!==null&&(C=this.getFragmentAtPosition(N,this.bitrateTest?_.fragmentEnd:_.edge,_))}return C},b.getFragmentAtPosition=function(_,I,O){var C,x=this.config,P=this.fragPrevious,N=O.fragments,M=O.endSN,B=O.fragmentHint,G=x.maxFragLookUpTolerance,K=!!(x.lowLatencyMode&&O.partList&&B);if(K&&B&&!this.bitrateTest&&(N=N.concat(B),M=B.sn),_<I){var V=_>I-G?0:G;C=Object(T.findFragmentByPTS)(P,N,_,V)}else C=N[N.length-1];if(C){var H=C.sn-O.startSN,W=P&&C.level===P.level,Y=N[H+1];if(this.fragmentTracker.getState(C)===L.FragmentState.BACKTRACKED){C=null;for(var X=H;N[X]&&this.fragmentTracker.getState(N[X])===L.FragmentState.BACKTRACKED;)C=P?N[X--]:N[--X];C||(C=Y)}else P&&C.sn===P.sn&&!K&&W&&(C.sn<M&&this.fragmentTracker.getState(Y)!==L.FragmentState.OK?(this.log("SN "+C.sn+" just loaded, load next one: "+Y.sn),C=Y):C=null)}return C},b.synchronizeToLiveEdge=function(_){var I=this.config,O=this.media;if(O){var C=this.hls.liveSyncPosition,x=O.currentTime,P=_.fragments[0].start,N=_.edge,M=x>=P-I.maxFragLookUpTolerance&&x<=N;if(C!==null&&O.duration>C&&(x<C||!M)){var B=I.liveMaxLatencyDuration!==void 0?I.liveMaxLatencyDuration:I.liveMaxLatencyDurationCount*_.targetduration;(!M&&O.readyState<4||x<N-B)&&(this.loadedmetadata||(this.nextLoadPosition=C),O.readyState&&(this.warn("Playback: "+x.toFixed(3)+" is located too far from the end of live sliding playlist: "+N+", reset currentTime to : "+C.toFixed(3)),O.currentTime=C))}}},b.alignPlaylists=function(_,I){var O=this.levels,C=this.levelLastLoaded,x=this.fragPrevious,P=C!==null?O[C]:null,N=_.fragments.length;if(!N)return this.warn("No fragments in live playlist"),0;var M=_.fragments[0].start,B=!I,G=_.alignedSliding&&Object(A.isFiniteNumber)(M);if(B||!G&&!M){Object(f.alignStream)(x,P,_);var K=_.fragments[0].start;return this.log("Live playlist sliding: "+K.toFixed(2)+" start-sn: "+(I?I.startSN:"na")+"->"+_.startSN+" prev-sn: "+(x?x.sn:"na")+" fragments: "+N),K}return M},b.waitForCdnTuneIn=function(_){return _.live&&_.canBlockReload&&_.tuneInGoal>Math.max(_.partHoldBack,3*_.partTarget)},b.setStartPosition=function(_,I){var O=this.startPosition;if(O<I&&(O=-1),O===-1||this.lastCurrentTime===-1){var C=_.startTimeOffset;Object(A.isFiniteNumber)(C)?(O=I+C,C<0&&(O+=_.totalduration),O=Math.min(Math.max(I,O),I+_.totalduration),this.log("Start time offset "+C+" found in playlist, adjust startPosition to "+O),this.startPosition=O):_.live?O=this.hls.liveSyncPosition||I:this.startPosition=O=0,this.lastCurrentTime=O}this.nextLoadPosition=O},b.getLoadPosition=function(){var _=this.media,I=0;return this.loadedmetadata&&_?I=_.currentTime:this.nextLoadPosition&&(I=this.nextLoadPosition),I},b.handleFragLoadAborted=function(_,I){this.transmuxer&&_.sn!=="initSegment"&&_.stats.aborted&&(this.warn("Fragment "+_.sn+(I?" part"+I.index:"")+" of level "+_.level+" was aborted"),this.resetFragmentLoading(_))},b.resetFragmentLoading=function(_){this.fragCurrent&&this.fragContextChanged(_)||(this.state=i.IDLE)},b.onFragmentOrKeyLoadError=function(_,I){if(!I.fatal){var O=I.frag;if(O&&O.type===_){var C=this.fragCurrent;console.assert(C&&O.sn===C.sn&&O.level===C.level&&O.urlId===C.urlId,"Frag load error must match current frag to retry");var x=this.config;if(this.fragLoadError+1<=x.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(O.level))return;var P=Math.min(Math.pow(2,this.fragLoadError)*x.fragLoadingRetryDelay,x.fragLoadingMaxRetryTimeout);this.warn("Fragment "+O.sn+" of "+_+" "+O.level+" failed to load, retrying in "+P+"ms"),this.retryDate=self.performance.now()+P,this.fragLoadError++,this.state=i.FRAG_LOADING_WAITING_RETRY}else I.levelRetry?(_===e.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=i.IDLE):(w.logger.error(I.details+" reaches max retry, redispatch as fatal ..."),I.fatal=!0,this.hls.stopLoad(),this.state=i.ERROR)}}},b.afterBufferFlushed=function(_,I,O){if(_){var C=k.BufferHelper.getBuffered(_);this.fragmentTracker.detectEvictedFragments(I,C,O),this.state===i.ENDED&&this.resetLoadingState()}},b.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=i.IDLE},b.resetLiveStartWhenNotLoaded=function(_){if(!this.loadedmetadata){this.startFragRequested=!1;var I=this.levels?this.levels[_].details:null;if(I!=null&&I.live)return this.startPosition=-1,this.setStartPosition(I,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},b.updateLevelTiming=function(_,I,O,C){var x=this,P=O.details;console.assert(!!P,"level.details must be defined"),Object.keys(_.elementaryStreams).reduce(function(N,M){var B=_.elementaryStreams[M];if(B){var G=B.endPTS-B.startPTS;if(G<=0)return x.warn("Could not parse fragment "+_.sn+" "+M+" duration reliably ("+G+") resetting transmuxer to fallback to playlist timing"),x.resetTransmuxer(),N||!1;var K=C?0:Object(E.updateFragPTSDTS)(P,_,B.startPTS,B.endPTS,B.startDTS,B.endDTS);return x.hls.trigger(D.Events.LEVEL_PTS_UPDATED,{details:P,level:O,drift:K,type:M,frag:_,start:B.startPTS,end:B.endPTS}),!0}return N},!1)?(this.state=i.PARSED,this.hls.trigger(D.Events.FRAG_PARSED,{frag:_,part:I})):this.resetLoadingState()},b.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},n=r,(h=[{key:"state",get:function(){return this._state},set:function(_){var I=this._state;I!==_&&(this._state=_,this.log(I+"->"+_))}}])&&l(n.prototype,h),r}(y.default)},"./src/controller/buffer-controller.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return T});var A=d("./src/polyfills/number.ts"),y=d("./src/events.ts"),L=d("./src/utils/logger.ts"),k=d("./src/errors.ts"),w=d("./src/utils/buffer-helper.ts"),D=d("./src/utils/mediasource-helper.ts"),o=d("./src/loader/fragment.ts"),S=d("./src/controller/buffer-operation-queue.ts"),m=Object(D.getMediaSource)(),f=/([ha]vc.)(?:\.[^.,]+)+/,T=function(){function E(t){var a=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=a.hls,l=a.media,u=a.mediaSource;L.logger.log("[buffer-controller]: Media source opened"),l&&(a.updateMediaElementDuration(),e.trigger(y.Events.MEDIA_ATTACHED,{media:l})),u&&u.removeEventListener("sourceopen",a._onMediaSourceOpen),a.checkPendingTracks()},this._onMediaSourceClose=function(){L.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){L.logger.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var c=E.prototype;return c.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},c.destroy=function(){this.unregisterListeners(),this.details=null},c.registerListeners=function(){var t=this.hls;t.on(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(y.Events.BUFFER_RESET,this.onBufferReset,this),t.on(y.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(y.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(y.Events.BUFFER_EOS,this.onBufferEos,this),t.on(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(y.Events.FRAG_PARSED,this.onFragParsed,this),t.on(y.Events.FRAG_CHANGED,this.onFragChanged,this)},c.unregisterListeners=function(){var t=this.hls;t.off(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(y.Events.BUFFER_RESET,this.onBufferReset,this),t.off(y.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(y.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(y.Events.BUFFER_EOS,this.onBufferEos,this),t.off(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(y.Events.FRAG_PARSED,this.onFragParsed,this),t.off(y.Events.FRAG_CHANGED,this.onFragChanged,this)},c._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new S.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},c.onManifestParsed=function(t,a){var e=2;(a.audio&&!a.video||!a.altAudio)&&(e=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=e,this.details=null,L.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},c.onMediaAttaching=function(t,a){var e=this.media=a.media;if(e&&m){var l=this.mediaSource=new m;l.addEventListener("sourceopen",this._onMediaSourceOpen),l.addEventListener("sourceended",this._onMediaSourceEnded),l.addEventListener("sourceclose",this._onMediaSourceClose),e.src=self.URL.createObjectURL(l),this._objectUrl=e.src}},c.onMediaDetaching=function(){var t=this.media,a=this.mediaSource,e=this._objectUrl;if(a){if(L.logger.log("[buffer-controller]: media source detaching"),a.readyState==="open")try{a.endOfStream()}catch(l){L.logger.warn("[buffer-controller]: onMediaDetaching: "+l.message+" while calling endOfStream")}this.onBufferReset(),a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(e&&self.URL.revokeObjectURL(e),t.src===e?(t.removeAttribute("src"),t.load()):L.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(y.Events.MEDIA_DETACHED,void 0)},c.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach(function(a){var e=t.sourceBuffer[a];try{e&&(t.removeBufferListeners(a),t.mediaSource&&t.mediaSource.removeSourceBuffer(e),t.sourceBuffer[a]=void 0)}catch(l){L.logger.warn("[buffer-controller]: Failed to reset the "+a+" buffer",l)}}),this._initSourceBuffer()},c.onBufferCodecs=function(t,a){var e=this,l=this.getSourceBufferTypes().length;Object.keys(a).forEach(function(u){if(l){var i=e.tracks[u];if(i&&typeof i.buffer.changeType=="function"){var s=a[u],v=s.codec,g=s.levelCodec,p=s.container;if((i.levelCodec||i.codec).replace(f,"$1")!==(g||v).replace(f,"$1")){var r=p+";codecs="+(g||v);e.appendChangeType(u,r)}}}else e.pendingTracks[u]=a[u]}),l||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},c.appendChangeType=function(t,a){var e=this,l=this.operationQueue,u={execute:function(){var i=e.sourceBuffer[t];i&&(L.logger.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+a),i.changeType(a)),l.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(i){L.logger.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",i)}};l.append(u,t)},c.onBufferAppending=function(t,a){var e=this,l=this.hls,u=this.operationQueue,i=this.tracks,s=a.data,v=a.type,g=a.frag,p=a.part,r=a.chunkMeta,n=r.buffering[v],h=self.performance.now();n.start=h;var b=g.stats.buffering,_=p?p.stats.buffering:null;b.start===0&&(b.start=h),_&&_.start===0&&(_.start=h);var I=i.audio,O=v==="audio"&&r.id===1&&(I==null?void 0:I.container)==="audio/mpeg",C={execute:function(){if(n.executeStart=self.performance.now(),O){var x=e.sourceBuffer[v];if(x){var P=g.start-x.timestampOffset;Math.abs(P)>=.1&&(L.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+g.start+" (delta: "+P+") sn: "+g.sn+")"),x.timestampOffset=g.start)}}e.appendExecutor(s,v)},onStart:function(){},onComplete:function(){var x=self.performance.now();n.executeEnd=n.end=x,b.first===0&&(b.first=x),_&&_.first===0&&(_.first=x);var P=e.sourceBuffer,N={};for(var M in P)N[M]=w.BufferHelper.getBuffered(P[M]);e.appendError=0,e.hls.trigger(y.Events.BUFFER_APPENDED,{type:v,frag:g,part:p,chunkMeta:r,parent:g.type,timeRanges:N})},onError:function(x){L.logger.error("[buffer-controller]: Error encountered while trying to append to the "+v+" SourceBuffer",x);var P={type:k.ErrorTypes.MEDIA_ERROR,parent:g.type,details:k.ErrorDetails.BUFFER_APPEND_ERROR,err:x,fatal:!1};x.code===DOMException.QUOTA_EXCEEDED_ERR?P.details=k.ErrorDetails.BUFFER_FULL_ERROR:(e.appendError++,P.details=k.ErrorDetails.BUFFER_APPEND_ERROR,e.appendError>l.config.appendErrorMaxRetry&&(L.logger.error("[buffer-controller]: Failed "+l.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),P.fatal=!0)),l.trigger(y.Events.ERROR,P)}};u.append(C,v)},c.onBufferFlushing=function(t,a){var e=this,l=this.operationQueue,u=function(i){return{execute:e.removeExecutor.bind(e,i,a.startOffset,a.endOffset),onStart:function(){},onComplete:function(){e.hls.trigger(y.Events.BUFFER_FLUSHED,{type:i})},onError:function(s){L.logger.warn("[buffer-controller]: Failed to remove from "+i+" SourceBuffer",s)}}};a.type?l.append(u(a.type),a.type):this.getSourceBufferTypes().forEach(function(i){l.append(u(i),i)})},c.onFragParsed=function(t,a){var e=this,l=a.frag,u=a.part,i=[],s=u?u.elementaryStreams:l.elementaryStreams;s[o.ElementaryStreamTypes.AUDIOVIDEO]?i.push("audiovideo"):(s[o.ElementaryStreamTypes.AUDIO]&&i.push("audio"),s[o.ElementaryStreamTypes.VIDEO]&&i.push("video")),i.length===0&&L.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+l.type+" level: "+l.level+" sn: "+l.sn),this.blockBuffers(function(){var v=self.performance.now();l.stats.buffering.end=v,u&&(u.stats.buffering.end=v);var g=u?u.stats:l.stats;e.hls.trigger(y.Events.FRAG_BUFFERED,{frag:l,part:u,stats:g,id:l.type})},i)},c.onFragChanged=function(t,a){this.flushBackBuffer()},c.onBufferEos=function(t,a){var e=this;this.getSourceBufferTypes().reduce(function(l,u){var i=e.sourceBuffer[u];return a.type&&a.type!==u||i&&!i.ended&&(i.ended=!0,L.logger.log("[buffer-controller]: "+u+" sourceBuffer now EOS")),l&&!(i&&!i.ended)},!0)&&this.blockBuffers(function(){var l=e.mediaSource;l&&l.readyState==="open"&&l.endOfStream()})},c.onLevelUpdated=function(t,a){var e=a.details;e.fragments.length&&(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},c.flushBackBuffer=function(){var t=this.hls,a=this.details,e=this.media,l=this.sourceBuffer;if(e&&a!==null){var u=this.getSourceBufferTypes();if(u.length){var i=a.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(Object(A.isFiniteNumber)(i)&&!(i<0)){var s=e.currentTime,v=a.levelTargetDuration,g=Math.max(i,v),p=Math.floor(s/v)*v-g;u.forEach(function(r){var n=l[r];if(n){var h=w.BufferHelper.getBuffered(n);h.length>0&&p>h.start(0)&&(t.trigger(y.Events.BACK_BUFFER_REACHED,{bufferEnd:p}),a.live&&t.trigger(y.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:p}),t.trigger(y.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:p,type:r}))}})}}}},c.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&this.mediaSource.readyState==="open"){var t=this.details,a=this.hls,e=this.media,l=this.mediaSource,u=t.fragments[0].start+t.totalduration,i=e.duration,s=Object(A.isFiniteNumber)(l.duration)?l.duration:0;t.live&&a.config.liveDurationInfinity?(L.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),l.duration=1/0,this.updateSeekableRange(t)):(u>s&&u>i||!Object(A.isFiniteNumber)(i))&&(L.logger.log("[buffer-controller]: Updating Media Source duration to "+u.toFixed(3)),l.duration=u)}},c.updateSeekableRange=function(t){var a=this.mediaSource,e=t.fragments;if(e.length&&t.live&&a!=null&&a.setLiveSeekableRange){var l=Math.max(0,e[0].start),u=Math.max(l,l+t.totalduration);a.setLiveSeekableRange(l,u)}},c.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,a=this.operationQueue,e=this.pendingTracks,l=Object.keys(e).length;if(l&&!t||l===2){this.createSourceBuffers(e),this.pendingTracks={};var u=this.getSourceBufferTypes();if(u.length===0)return void this.hls.trigger(y.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});u.forEach(function(i){a.executeNext(i)})}},c.createSourceBuffers=function(t){var a=this.sourceBuffer,e=this.mediaSource;if(!e)throw Error("createSourceBuffers called when mediaSource was null");var l=0;for(var u in t)if(!a[u]){var i=t[u];if(!i)throw Error("source buffer exists for track "+u+", however track does not");var s=i.levelCodec||i.codec,v=i.container+";codecs="+s;L.logger.log("[buffer-controller]: creating sourceBuffer("+v+")");try{var g=a[u]=e.addSourceBuffer(v),p=u;this.addBufferListener(p,"updatestart",this._onSBUpdateStart),this.addBufferListener(p,"updateend",this._onSBUpdateEnd),this.addBufferListener(p,"error",this._onSBUpdateError),this.tracks[u]={buffer:g,codec:s,container:i.container,levelCodec:i.levelCodec,id:i.id},l++}catch(r){L.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+r.message),this.hls.trigger(y.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,mimeType:v})}}l&&this.hls.trigger(y.Events.BUFFER_CREATED,{tracks:this.tracks})},c._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},c._onSBUpdateEnd=function(t){var a=this.operationQueue;a.current(t).onComplete(),a.shiftAndExecuteNext(t)},c._onSBUpdateError=function(t,a){L.logger.error("[buffer-controller]: "+t+" SourceBuffer error",a),this.hls.trigger(y.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var e=this.operationQueue.current(t);e&&e.onError(a)},c.removeExecutor=function(t,a,e){var l=this.media,u=this.mediaSource,i=this.operationQueue,s=this.sourceBuffer[t];if(!l||!u||!s)return L.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(t);var v=Object(A.isFiniteNumber)(l.duration)?l.duration:1/0,g=Object(A.isFiniteNumber)(u.duration)?u.duration:1/0,p=Math.max(0,a),r=Math.min(e,v,g);r>p?(L.logger.log("[buffer-controller]: Removing ["+p+","+r+"] from the "+t+" SourceBuffer"),console.assert(!s.updating,t+" sourceBuffer must not be updating"),s.remove(p,r)):i.shiftAndExecuteNext(t)},c.appendExecutor=function(t,a){var e=this.operationQueue,l=this.sourceBuffer[a];if(!l)return L.logger.warn("[buffer-controller]: Attempting to append to the "+a+" SourceBuffer, but it does not exist"),void e.shiftAndExecuteNext(a);l.ended=!1,console.assert(!l.updating,a+" sourceBuffer must not be updating"),l.appendBuffer(t)},c.blockBuffers=function(t,a){var e=this;if(a===void 0&&(a=this.getSourceBufferTypes()),!a.length)return L.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(t);var l=this.operationQueue,u=a.map(function(i){return l.appendBlocker(i)});Promise.all(u).then(function(){t(),a.forEach(function(i){var s=e.sourceBuffer[i];s&&s.updating||l.shiftAndExecuteNext(i)})})},c.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},c.addBufferListener=function(t,a,e){var l=this.sourceBuffer[t];if(l){var u=e.bind(this,t);this.listeners[t].push({event:a,listener:u}),l.addEventListener(a,u)}},c.removeBufferListeners=function(t){var a=this.sourceBuffer[t];a&&this.listeners[t].forEach(function(e){a.removeEventListener(e.event,e.listener)})},E}()},"./src/controller/buffer-operation-queue.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return y});var A=d("./src/utils/logger.ts"),y=function(){function L(w){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=w}var k=L.prototype;return k.append=function(w,D){var o=this.queues[D];o.push(w),o.length===1&&this.buffers[D]&&this.executeNext(D)},k.insertAbort=function(w,D){this.queues[D].unshift(w),this.executeNext(D)},k.appendBlocker=function(w){var D,o=new Promise(function(m){D=m}),S={execute:D,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(S,w),o},k.executeNext=function(w){var D=this.buffers,o=this.queues,S=D[w],m=o[w];if(m.length){var f=m[0];try{f.execute()}catch(T){A.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),f.onError(T),S&&S.updating||(m.shift(),this.executeNext(w))}}},k.shiftAndExecuteNext=function(w){this.queues[w].shift(),this.executeNext(w)},k.current=function(w){return this.queues[w][0]},L}()},"./src/controller/cap-level-controller.ts":function(F,R,d){d.r(R);var A=d("./src/events.ts");function y(k,w){for(var D=0;D<w.length;D++){var o=w[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(k,o.key,o)}}var L=function(){function k(m){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=m,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var w,D,o,S=k.prototype;return S.setStreamController=function(m){this.streamController=m},S.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},S.registerListeners=function(){var m=this.hls;m.on(A.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.on(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.on(A.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},S.unregisterListener=function(){var m=this.hls;m.off(A.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),m.off(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.off(A.Events.BUFFER_CODECS,this.onBufferCodecs,this),m.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},S.onFpsDropLevelCapping=function(m,f){k.isLevelAllowed(f.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(f.droppedLevel)},S.onMediaAttaching=function(m,f){this.media=f.media instanceof HTMLVideoElement?f.media:null},S.onManifestParsed=function(m,f){var T=this.hls;this.restrictedLevels=[],this.firstLevel=f.firstLevel,T.config.capLevelToPlayerSize&&f.video&&this.startCapping()},S.onBufferCodecs=function(m,f){this.hls.config.capLevelToPlayerSize&&f.video&&this.startCapping()},S.onMediaDetaching=function(){this.stopCapping()},S.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var m=this.hls.levels;if(m.length){var f=this.hls;f.autoLevelCapping=this.getMaxLevel(m.length-1),f.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=f.autoLevelCapping}}},S.getMaxLevel=function(m){var f=this,T=this.hls.levels;if(!T.length)return-1;var E=T.filter(function(c,t){return k.isLevelAllowed(t,f.restrictedLevels)&&t<=m});return this.clientRect=null,k.getMaxLevelByMediaSize(E,this.mediaWidth,this.mediaHeight)},S.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},S.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},S.getDimensions=function(){if(this.clientRect)return this.clientRect;var m=this.media,f={width:0,height:0};if(m){var T=m.getBoundingClientRect();f.width=T.width,f.height=T.height,f.width||f.height||(f.width=T.right-T.left||m.width||0,f.height=T.bottom-T.top||m.height||0)}return this.clientRect=f,f},k.isLevelAllowed=function(m,f){return f===void 0&&(f=[]),f.indexOf(m)===-1},k.getMaxLevelByMediaSize=function(m,f,T){if(!m||!m.length)return-1;for(var E,c,t=m.length-1,a=0;a<m.length;a+=1){var e=m[a];if((e.width>=f||e.height>=T)&&(E=e,!(c=m[a+1])||E.width!==c.width||E.height!==c.height)){t=a;break}}return t},w=k,o=[{key:"contentScaleFactor",get:function(){var m=1;try{m=self.devicePixelRatio}catch{}return m}}],(D=[{key:"mediaWidth",get:function(){return this.getDimensions().width*k.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*k.contentScaleFactor}}])&&y(w.prototype,D),o&&y(w,o),k}();R.default=L},"./src/controller/eme-controller.ts":function(F,R,d){d.r(R);var A=d("./src/events.ts"),y=d("./src/errors.ts"),L=d("./src/utils/logger.ts"),k=d("./src/utils/mediakeys-helper.ts");function w(o,S){for(var m=0;m<S.length;m++){var f=S[m];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(o,f.key,f)}}var D=function(){function o(T){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=T,this._config=T.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var S,m,f=o.prototype;return f.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},f._registerListeners=function(){this.hls.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(A.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this)},f._unregisterListeners=function(){this.hls.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(A.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this)},f.getLicenseServerUrl=function(T){switch(T){case k.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+T+'"')},f._attemptKeySystemAccess=function(T,E,c){var t=this,a=function(l,u,i,s){switch(l){case k.KeySystems.WIDEVINE:return function(v,g,p){var r={audioCapabilities:[],videoCapabilities:[]};return v.forEach(function(n){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+n+'"',robustness:p.audioRobustness||""})}),g.forEach(function(n){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+n+'"',robustness:p.videoRobustness||""})}),[r]}(u,i,s);default:throw new Error("Unknown key-system: "+l)}}(T,E,c,this._drmSystemOptions);L.logger.log("Requesting encrypted media key-system access");var e=this.requestMediaKeySystemAccess(T,a);this.mediaKeysPromise=e.then(function(l){return t._onMediaKeySystemAccessObtained(T,l)}),e.catch(function(l){L.logger.error('Failed to obtain key-system "'+T+'" access:',l)})},f._onMediaKeySystemAccessObtained=function(T,E){var c=this;L.logger.log('Access for key-system "'+T+'" obtained');var t={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:E,mediaKeySystemDomain:T};this._mediaKeysList.push(t);var a=Promise.resolve().then(function(){return E.createMediaKeys()}).then(function(e){return t.mediaKeys=e,L.logger.log('Media-keys created for key-system "'+T+'"'),c._onMediaKeysCreated(),e});return a.catch(function(e){L.logger.error("Failed to create media-keys:",e)}),a},f._onMediaKeysCreated=function(){var T=this;this._mediaKeysList.forEach(function(E){E.mediaKeysSession||(E.mediaKeysSession=E.mediaKeys.createSession(),T._onNewMediaKeySession(E.mediaKeysSession))})},f._onNewMediaKeySession=function(T){var E=this;L.logger.log("New key-system session "+T.sessionId),T.addEventListener("message",function(c){E._onKeySessionMessage(T,c.message)},!1)},f._onKeySessionMessage=function(T,E){L.logger.log("Got EME message event, creating license request"),this._requestLicense(E,function(c){L.logger.log("Received license data (length: "+(c&&c.byteLength)+"), updating key-session"),T.update(c)})},f.onMediaEncrypted=function(T){var E=this;if(L.logger.log('Media is encrypted using "'+T.initDataType+'" init data type'),!this.mediaKeysPromise)return L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(A.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var c=function(t){E._media&&(E._attemptSetMediaKeys(t),E._generateRequestWithPreferredKeySession(T.initDataType,T.initData))};this.mediaKeysPromise.then(c).catch(c)},f._attemptSetMediaKeys=function(T){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var E=this._mediaKeysList[0];if(!E||!E.mediaKeys)return L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(A.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});L.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(E.mediaKeys),this._hasSetMediaKeys=!0}},f._generateRequestWithPreferredKeySession=function(T,E){var c=this,t=this._mediaKeysList[0];if(!t)return L.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(A.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(t.mediaKeysSessionInitialized)L.logger.warn("Key-Session already initialized but requested again");else{var a=t.mediaKeysSession;if(!a)return L.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(A.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!E)return L.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(A.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});L.logger.log('Generating key-session request for "'+T+'" init data type'),t.mediaKeysSessionInitialized=!0,a.generateRequest(T,E).then(function(){L.logger.debug("Key-session generation succeeded")}).catch(function(e){L.logger.error("Error generating key-session request:",e),c.hls.trigger(A.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})}},f._createLicenseXhr=function(T,E,c){var t=new XMLHttpRequest;t.responseType="arraybuffer",t.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,t,T,E,c);var a=this._licenseXhrSetup;if(a)try{a.call(this.hls,t,T),a=void 0}catch(e){L.logger.error(e)}try{t.readyState||t.open("POST",T,!0),a&&a.call(this.hls,t,T)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return t},f._onLicenseRequestReadyStageChange=function(T,E,c,t){switch(T.readyState){case 4:if(T.status===200){this._requestLicenseFailureCount=0,L.logger.log("License request succeeded");var a=T.response,e=this._licenseResponseCallback;if(e)try{a=e.call(this.hls,T,E)}catch(u){L.logger.error(u)}t(a)}else{if(L.logger.error("License Request XHR failed ("+E+"). Status: "+T.status+" ("+T.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(A.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var l=3-this._requestLicenseFailureCount+1;L.logger.warn("Retrying license request, "+l+" attempts left"),this._requestLicense(c,t)}}},f._generateLicenseRequestChallenge=function(T,E){switch(T.mediaKeySystemDomain){case k.KeySystems.WIDEVINE:return E}throw new Error("unsupported key-system: "+T.mediaKeySystemDomain)},f._requestLicense=function(T,E){L.logger.log("Requesting content license for key-system");var c=this._mediaKeysList[0];if(!c)return L.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(A.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var t=this.getLicenseServerUrl(c.mediaKeySystemDomain),a=this._createLicenseXhr(t,T,E);L.logger.log("Sending license request to URL: "+t);var e=this._generateLicenseRequestChallenge(c,T);a.send(e)}catch(l){L.logger.error("Failure requesting DRM license: "+l),this.hls.trigger(A.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},f.onMediaAttached=function(T,E){if(this._emeEnabled){var c=E.media;this._media=c,c.addEventListener("encrypted",this._onMediaEncrypted)}},f.onMediaDetached=function(){var T=this._media,E=this._mediaKeysList;T&&(T.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(E.map(function(c){if(c.mediaKeysSession)return c.mediaKeysSession.close().catch(function(){})})).then(function(){return T.setMediaKeys(null)}).catch(function(){}))},f.onManifestParsed=function(T,E){if(this._emeEnabled){var c=E.levels.map(function(a){return a.audioCodec}).filter(function(a){return!!a}),t=E.levels.map(function(a){return a.videoCodec}).filter(function(a){return!!a});this._attemptKeySystemAccess(k.KeySystems.WIDEVINE,c,t)}},S=o,(m=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&w(S.prototype,m),o}();R.default=D},"./src/controller/fps-controller.ts":function(F,R,d){d.r(R);var A=d("./src/events.ts"),y=d("./src/utils/logger.ts"),L=function(){function k(D){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=D,this.registerListeners()}var w=k.prototype;return w.setStreamController=function(D){this.streamController=D},w.registerListeners=function(){this.hls.on(A.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},w.unregisterListeners=function(){this.hls.off(A.Events.MEDIA_ATTACHING,this.onMediaAttaching)},w.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},w.onMediaAttaching=function(D,o){var S=this.hls.config;if(S.capLevelOnFPSDrop){var m=o.media instanceof self.HTMLVideoElement?o.media:null;this.media=m,m&&typeof m.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),S.fpsDroppedMonitoringPeriod)}},w.checkFPS=function(D,o,S){var m=performance.now();if(o){if(this.lastTime){var f=m-this.lastTime,T=S-this.lastDroppedFrames,E=o-this.lastDecodedFrames,c=1e3*T/f,t=this.hls;if(t.trigger(A.Events.FPS_DROP,{currentDropped:T,currentDecoded:E,totalDroppedFrames:S}),c>0&&T>t.config.fpsDroppedMonitoringThreshold*E){var a=t.currentLevel;y.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+a),a>0&&(t.autoLevelCapping===-1||t.autoLevelCapping>=a)&&(a-=1,t.trigger(A.Events.FPS_DROP_LEVEL_CAPPING,{level:a,droppedLevel:t.currentLevel}),t.autoLevelCapping=a,this.streamController.nextLevelSwitch())}}this.lastTime=m,this.lastDroppedFrames=S,this.lastDecodedFrames=o}},w.checkFPSInterval=function(){var D=this.media;if(D)if(this.isVideoPlaybackQualityAvailable){var o=D.getVideoPlaybackQuality();this.checkFPS(D,o.totalVideoFrames,o.droppedVideoFrames)}else this.checkFPS(D,D.webkitDecodedFrameCount,D.webkitDroppedFrameCount)},k}();R.default=L},"./src/controller/fragment-finders.ts":function(F,R,d){d.r(R),d.d(R,"findFragmentByPDT",function(){return L}),d.d(R,"findFragmentByPTS",function(){return k}),d.d(R,"fragmentWithinToleranceTest",function(){return w}),d.d(R,"pdtWithinToleranceTest",function(){return D}),d.d(R,"findFragWithCC",function(){return o});var A=d("./src/polyfills/number.ts"),y=d("./src/utils/binary-search.ts");function L(S,m,f){if(m===null||!Array.isArray(S)||!S.length||!Object(A.isFiniteNumber)(m)||m<(S[0].programDateTime||0)||m>=(S[S.length-1].endProgramDateTime||0))return null;f=f||0;for(var T=0;T<S.length;++T){var E=S[T];if(D(m,f,E))return E}return null}function k(S,m,f,T){f===void 0&&(f=0),T===void 0&&(T=0);var E=null;if(S?E=m[S.sn-m[0].sn+1]||null:f===0&&m[0].start===0&&(E=m[0]),E&&w(f,T,E)===0)return E;var c=y.default.search(m,w.bind(null,f,T));return c||E}function w(S,m,f){S===void 0&&(S=0),m===void 0&&(m=0);var T=Math.min(m,f.duration+(f.deltaPTS?f.deltaPTS:0));return f.start+f.duration-T<=S?1:f.start-T>S&&f.start?-1:0}function D(S,m,f){var T=1e3*Math.min(m,f.duration+(f.deltaPTS?f.deltaPTS:0));return(f.endProgramDateTime||0)-T>S}function o(S,m){return y.default.search(S,function(f){return f.cc<m?1:f.cc>m?-1:0})}},"./src/controller/fragment-tracker.ts":function(F,R,d){d.r(R),d.d(R,"FragmentState",function(){return A}),d.d(R,"FragmentTracker",function(){return w});var A,y,L=d("./src/events.ts"),k=d("./src/types/loader.ts");(y=A||(A={})).NOT_LOADED="NOT_LOADED",y.BACKTRACKED="BACKTRACKED",y.APPENDING="APPENDING",y.PARTIAL="PARTIAL",y.OK="OK";var w=function(){function S(f){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=f,this._registerListeners()}var m=S.prototype;return m._registerListeners=function(){var f=this.hls;f.on(L.Events.BUFFER_APPENDED,this.onBufferAppended,this),f.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),f.on(L.Events.FRAG_LOADED,this.onFragLoaded,this)},m._unregisterListeners=function(){var f=this.hls;f.off(L.Events.BUFFER_APPENDED,this.onBufferAppended,this),f.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),f.off(L.Events.FRAG_LOADED,this.onFragLoaded,this)},m.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},m.getAppendedFrag=function(f,T){if(T===k.PlaylistLevelType.MAIN){var E=this.activeFragment,c=this.activeParts;if(!E)return null;if(c)for(var t=c.length;t--;){var a=c[t],e=a?a.end:E.appendedPTS;if(a.start<=f&&e!==void 0&&f<=e)return t>9&&(this.activeParts=c.slice(t-9)),a}else if(E.start<=f&&E.appendedPTS!==void 0&&f<=E.appendedPTS)return E}return this.getBufferedFrag(f,T)},m.getBufferedFrag=function(f,T){for(var E=this.fragments,c=Object.keys(E),t=c.length;t--;){var a=E[c[t]];if((a==null?void 0:a.body.type)===T&&a.buffered){var e=a.body;if(e.start<=f&&f<=e.end)return e}}return null},m.detectEvictedFragments=function(f,T,E){var c=this;Object.keys(this.fragments).forEach(function(t){var a=c.fragments[t];if(a)if(a.buffered){var e=a.range[f];e&&e.time.some(function(l){var u=!c.isTimeBuffered(l.startPTS,l.endPTS,T);return u&&c.removeFragment(a.body),u})}else a.body.type===E&&c.removeFragment(a.body)})},m.detectPartialFragments=function(f){var T=this,E=this.timeRanges,c=f.frag,t=f.part;if(E&&c.sn!=="initSegment"){var a=o(c),e=this.fragments[a];e&&(Object.keys(E).forEach(function(l){var u=c.elementaryStreams[l];if(u){var i=E[l],s=t!==null||u.partial===!0;e.range[l]=T.getBufferedTimes(c,t,s,i)}}),e.backtrack=e.loaded=null,Object.keys(e.range).length?e.buffered=!0:this.removeFragment(e.body))}},m.fragBuffered=function(f){var T=o(f),E=this.fragments[T];E&&(E.backtrack=E.loaded=null,E.buffered=!0)},m.getBufferedTimes=function(f,T,E,c){for(var t={time:[],partial:E},a=T?T.start:f.start,e=T?T.end:f.end,l=f.minEndPTS||e,u=f.maxStartPTS||a,i=0;i<c.length;i++){var s=c.start(i)-this.bufferPadding,v=c.end(i)+this.bufferPadding;if(u>=s&&l<=v){t.time.push({startPTS:Math.max(a,c.start(i)),endPTS:Math.min(e,c.end(i))});break}if(a<v&&e>s)t.partial=!0,t.time.push({startPTS:Math.max(a,c.start(i)),endPTS:Math.min(e,c.end(i))});else if(e<=s)break}return t},m.getPartialFragment=function(f){var T,E,c,t=null,a=0,e=this.bufferPadding,l=this.fragments;return Object.keys(l).forEach(function(u){var i=l[u];i&&D(i)&&(E=i.body.start-e,c=i.body.end+e,f>=E&&f<=c&&(T=Math.min(f-E,c-f),a<=T&&(t=i.body,a=T)))}),t},m.getState=function(f){var T=o(f),E=this.fragments[T];return E?E.buffered?D(E)?A.PARTIAL:A.OK:E.backtrack?A.BACKTRACKED:A.APPENDING:A.NOT_LOADED},m.backtrack=function(f,T){var E=o(f),c=this.fragments[E];if(!c||c.backtrack)return null;var t=c.backtrack=T||c.loaded;return c.loaded=null,t},m.getBacktrackData=function(f){var T=o(f),E=this.fragments[T];if(E){var c,t=E.backtrack;if(t!=null&&(c=t.payload)!==null&&c!==void 0&&c.byteLength)return t;this.removeFragment(f)}return null},m.isTimeBuffered=function(f,T,E){for(var c,t,a=0;a<E.length;a++){if(c=E.start(a)-this.bufferPadding,t=E.end(a)+this.bufferPadding,f>=c&&T<=t)return!0;if(T<=c)return!1}return!1},m.onFragLoaded=function(f,T){var E=T.frag,c=T.part;if(E.sn!=="initSegment"&&!E.bitrateTest&&!c){var t=o(E);this.fragments[t]={body:E,loaded:T,backtrack:null,buffered:!1,range:Object.create(null)}}},m.onBufferAppended=function(f,T){var E=this,c=T.frag,t=T.part,a=T.timeRanges;if(c.type===k.PlaylistLevelType.MAIN)if(this.activeFragment=c,t){var e=this.activeParts;e||(this.activeParts=e=[]),e.push(t)}else this.activeParts=null;this.timeRanges=a,Object.keys(a).forEach(function(l){var u=a[l];if(E.detectEvictedFragments(l,u),!t)for(var i=0;i<u.length;i++)c.appendedPTS=Math.max(u.end(i),c.appendedPTS||0)})},m.onFragBuffered=function(f,T){this.detectPartialFragments(T)},m.hasFragment=function(f){var T=o(f);return!!this.fragments[T]},m.removeFragmentsInRange=function(f,T,E){var c=this;Object.keys(this.fragments).forEach(function(t){var a=c.fragments[t];if(a&&a.buffered){var e=a.body;e.type===E&&e.start<T&&e.end>f&&c.removeFragment(e)}})},m.removeFragment=function(f){var T=o(f);f.stats.loaded=0,f.clearElementaryStreamInfo(),delete this.fragments[T]},m.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},S}();function D(S){var m,f;return S.buffered&&(((m=S.range.video)===null||m===void 0?void 0:m.partial)||((f=S.range.audio)===null||f===void 0?void 0:f.partial))}function o(S){return S.type+"_"+S.level+"_"+S.urlId+"_"+S.sn}},"./src/controller/gap-controller.ts":function(F,R,d){d.r(R),d.d(R,"STALL_MINIMUM_DURATION_MS",function(){return w}),d.d(R,"MAX_START_GAP_JUMP",function(){return D}),d.d(R,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return o}),d.d(R,"SKIP_BUFFER_RANGE_START",function(){return S}),d.d(R,"default",function(){return m});var A=d("./src/utils/buffer-helper.ts"),y=d("./src/errors.ts"),L=d("./src/events.ts"),k=d("./src/utils/logger.ts"),w=250,D=2,o=.1,S=.05,m=function(){function f(E,c,t,a){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=E,this.media=c,this.fragmentTracker=t,this.hls=a}var T=f.prototype;return T.destroy=function(){this.hls=this.fragmentTracker=this.media=null},T.poll=function(E){var c=this.config,t=this.media,a=this.stalled,e=t.currentTime,l=t.seeking,u=this.seeking&&!l,i=!this.seeking&&l;if(this.seeking=l,e===E){if((i||u)&&(this.stalled=null),!t.paused&&!t.ended&&t.playbackRate!==0&&A.BufferHelper.getBuffered(t).length){var s=A.BufferHelper.bufferInfo(t,e,0),v=s.len>0,g=s.nextStart||0;if(v||g){if(l){var p=s.len>D,r=!g||g-e>D&&!this.fragmentTracker.getPartialFragment(e);if(p||r)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var n,h=Math.max(g,s.start||0)-e,b=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,_=!(b==null||(n=b.details)===null||n===void 0)&&n.live?2*b.details.targetduration:D;if(h>0&&h<=_)return void this._trySkipBufferHole(null)}var I=self.performance.now();if(a!==null){var O=I-a;!l&&O>=w&&this._reportStall(s.len);var C=A.BufferHelper.bufferInfo(t,e,c.maxBufferHole);this._tryFixBufferStall(C,O)}else this.stalled=I}}}else if(this.moved=!0,a!==null){if(this.stallReported){var x=self.performance.now()-a;k.logger.warn("playback not stuck anymore @"+e+", after "+Math.round(x)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},T._tryFixBufferStall=function(E,c){var t=this.config,a=this.fragmentTracker,e=this.media.currentTime,l=a.getPartialFragment(e);l&&this._trySkipBufferHole(l)||E.len>t.maxBufferHole&&c>1e3*t.highBufferWatchdogPeriod&&(k.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},T._reportStall=function(E){var c=this.hls,t=this.media;this.stallReported||(this.stallReported=!0,k.logger.warn("Playback stalling at @"+t.currentTime+" due to low buffer (buffer="+E+")"),c.trigger(L.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:E}))},T._trySkipBufferHole=function(E){for(var c=this.config,t=this.hls,a=this.media,e=a.currentTime,l=0,u=A.BufferHelper.getBuffered(a),i=0;i<u.length;i++){var s=u.start(i);if(e+c.maxBufferHole>=l&&e<s){var v=Math.max(s+S,a.currentTime+o);return k.logger.warn("skipping hole, adjusting currentTime from "+e+" to "+v),this.moved=!0,this.stalled=null,a.currentTime=v,E&&t.trigger(L.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+e+" to "+v,frag:E}),v}l=u.end(i)}return 0},T._tryNudgeBuffer=function(){var E=this.config,c=this.hls,t=this.media,a=t.currentTime,e=(this.nudgeRetry||0)+1;if(this.nudgeRetry=e,e<E.nudgeMaxRetry){var l=a+e*E.nudgeOffset;k.logger.warn("Nudging 'currentTime' from "+a+" to "+l),t.currentTime=l,c.trigger(L.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else k.logger.error("Playhead still not moving while enough data buffered @"+a+" after "+E.nudgeMaxRetry+" nudges"),c.trigger(L.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},f}()},"./src/controller/id3-track-controller.ts":function(F,R,d){d.r(R);var A=d("./src/events.ts"),y=d("./src/utils/texttrack-utils.ts"),L=d("./src/demux/id3.ts"),k=function(){function w(o){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=o,this._registerListeners()}var D=w.prototype;return D.destroy=function(){this._unregisterListeners()},D._registerListeners=function(){var o=this.hls;o.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(A.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},D._unregisterListeners=function(){var o=this.hls;o.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(A.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),o.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},D.onMediaAttached=function(o,S){this.media=S.media},D.onMediaDetaching=function(){this.id3Track&&(Object(y.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},D.getID3Track=function(o){if(this.media){for(var S=0;S<o.length;S++){var m=o[S];if(m.kind==="metadata"&&m.label==="id3")return Object(y.sendAddTrackEvent)(m,this.media),m}return this.media.addTextTrack("metadata","id3")}},D.onFragParsingMetadata=function(o,S){if(this.media){var m=S.frag,f=S.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var T=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,E=0;E<f.length;E++){var c=L.getID3Frames(f[E].data);if(c){var t=f[E].pts,a=E<f.length-1?f[E+1].pts:m.end;a-t<=0&&(a=t+.25);for(var e=0;e<c.length;e++){var l=c[e];if(!L.isTimeStampFrame(l)){var u=new T(t,a,"");u.value=l,this.id3Track.addCue(u)}}}}}},D.onBufferFlushing=function(o,S){var m=S.startOffset,f=S.endOffset,T=S.type;if(!T||T==="audio"){var E=this.id3Track;E&&Object(y.removeCuesInRange)(E,m,f)}},w}();R.default=k},"./src/controller/latency-controller.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return w});var A=d("./src/errors.ts"),y=d("./src/events.ts"),L=d("./src/utils/logger.ts");function k(D,o){for(var S=0;S<o.length;S++){var m=o[S];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(D,m.key,m)}}var w=function(){function D(f){var T=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return T.timeupdate()},this.hls=f,this.config=f.config,this.registerListeners()}var o,S,m=D.prototype;return m.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},m.registerListeners=function(){this.hls.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(y.Events.ERROR,this.onError,this)},m.unregisterListeners=function(){this.hls.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(y.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(y.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(y.Events.ERROR,this.onError)},m.onMediaAttached=function(f,T){this.media=T.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},m.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},m.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},m.onLevelUpdated=function(f,T){var E=T.details;this.levelDetails=E,E.advanced&&this.timeupdate(),!E.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},m.onError=function(f,T){T.details===A.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,L.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},m.timeupdate=function(){var f=this.media,T=this.levelDetails;if(f&&T){this.currentTime=f.currentTime;var E=this.computeLatency();if(E!==null){this._latency=E;var c=this.config,t=c.lowLatencyMode,a=c.maxLiveSyncPlaybackRate;if(t&&a!==1){var e=this.targetLatency;if(e!==null){var l=E-e,u=l<Math.min(this.maxLatency,e+T.targetduration);if(T.live&&u&&l>.05&&this.forwardBufferLength>1){var i=Math.min(2,Math.max(1,a)),s=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20;f.playbackRate=Math.min(i,Math.max(1,s))}else f.playbackRate!==1&&f.playbackRate!==0&&(f.playbackRate=1)}}}}},m.estimateLiveEdge=function(){var f=this.levelDetails;return f===null?null:f.edge+f.age},m.computeLatency=function(){var f=this.estimateLiveEdge();return f===null?null:f-this.currentTime},o=D,(S=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var f=this.config,T=this.levelDetails;return f.liveMaxLatencyDuration!==void 0?f.liveMaxLatencyDuration:T?f.liveMaxLatencyDurationCount*T.targetduration:0}},{key:"targetLatency",get:function(){var f=this.levelDetails;if(f===null)return null;var T=f.holdBack,E=f.partHoldBack,c=f.targetduration,t=this.config,a=t.liveSyncDuration,e=t.liveSyncDurationCount,l=t.lowLatencyMode,u=this.hls.userConfig,i=l&&E||T;(u.liveSyncDuration||u.liveSyncDurationCount||i===0)&&(i=a!==void 0?a:e*c);var s=c;return i+Math.min(1*this.stallCount,s)}},{key:"liveSyncPosition",get:function(){var f=this.estimateLiveEdge(),T=this.targetLatency,E=this.levelDetails;if(f===null||T===null||E===null)return null;var c=E.edge,t=f-T-this.edgeStalled,a=c-E.totalduration,e=c-(this.config.lowLatencyMode&&E.partTarget||E.targetduration);return Math.min(Math.max(a,t),e)}},{key:"drift",get:function(){var f=this.levelDetails;return f===null?1:f.drift}},{key:"edgeStalled",get:function(){var f=this.levelDetails;if(f===null)return 0;var T=3*(this.config.lowLatencyMode&&f.partTarget||f.targetduration);return Math.max(f.age-T,0)}},{key:"forwardBufferLength",get:function(){var f=this.media,T=this.levelDetails;if(!f||!T)return 0;var E=f.buffered.length;return E?f.buffered.end(E-1):T.edge-this.currentTime}}])&&k(o.prototype,S),D}()},"./src/controller/level-controller.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return E});var A=d("./src/types/level.ts"),y=d("./src/events.ts"),L=d("./src/errors.ts"),k=d("./src/utils/codecs.ts"),w=d("./src/controller/level-helper.ts"),D=d("./src/controller/base-playlist-controller.ts"),o=d("./src/types/loader.ts");function S(){return(S=Object.assign||function(c){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var e in a)Object.prototype.hasOwnProperty.call(a,e)&&(c[e]=a[e])}return c}).apply(this,arguments)}function m(c,t){for(var a=0;a<t.length;a++){var e=t[a];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(c,e.key,e)}}function f(c,t){return(f=Object.setPrototypeOf||function(a,e){return a.__proto__=e,a})(c,t)}var T=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),E=function(c){var t,a;function e(s){var v;return(v=c.call(this,s,"[level-controller]")||this)._levels=[],v._firstLevel=-1,v._startLevel=void 0,v.currentLevelIndex=-1,v.manualLevelIndex=-1,v.onParsedComplete=void 0,v._registerListeners(),v}a=c,(t=e).prototype=Object.create(a.prototype),t.prototype.constructor=t,f(t,a);var l,u,i=e.prototype;return i._registerListeners=function(){var s=this.hls;s.on(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(y.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.on(y.Events.FRAG_LOADED,this.onFragLoaded,this),s.on(y.Events.ERROR,this.onError,this)},i._unregisterListeners=function(){var s=this.hls;s.off(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(y.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.off(y.Events.FRAG_LOADED,this.onFragLoaded,this),s.off(y.Events.ERROR,this.onError,this)},i.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,c.prototype.destroy.call(this)},i.startLoad=function(){this._levels.forEach(function(s){s.loadError=0}),c.prototype.startLoad.call(this)},i.onManifestLoaded=function(s,v){var g,p,r=[],n=[],h=[],b={},_=!1,I=!1,O=!1;if(v.levels.forEach(function(N){var M=N.attrs;_=_||!(!N.width||!N.height),I=I||!!N.videoCodec,O=O||!!N.audioCodec,T&&N.audioCodec&&N.audioCodec.indexOf("mp4a.40.34")!==-1&&(N.audioCodec=void 0);var B=N.bitrate+"-"+N.attrs.RESOLUTION+"-"+N.attrs.CODECS;(p=b[B])?p.url.push(N.url):(p=new A.Level(N),b[B]=p,r.push(p)),M&&(M.AUDIO&&Object(w.addGroupId)(p,"audio",M.AUDIO),M.SUBTITLES&&Object(w.addGroupId)(p,"text",M.SUBTITLES))}),(_||I)&&O&&(r=r.filter(function(N){var M=N.videoCodec,B=N.width,G=N.height;return!!M||!(!B||!G)})),r=r.filter(function(N){var M=N.audioCodec,B=N.videoCodec;return(!M||Object(k.isCodecSupportedInMp4)(M,"audio"))&&(!B||Object(k.isCodecSupportedInMp4)(B,"video"))}),v.audioTracks&&(n=v.audioTracks.filter(function(N){return!N.audioCodec||Object(k.isCodecSupportedInMp4)(N.audioCodec,"audio")}),Object(w.assignTrackIdsByGroup)(n)),v.subtitles&&(h=v.subtitles,Object(w.assignTrackIdsByGroup)(h)),r.length>0){g=r[0].bitrate,r.sort(function(N,M){return N.bitrate-M.bitrate}),this._levels=r;for(var C=0;C<r.length;C++)if(r[C].bitrate===g){this._firstLevel=C,this.log("manifest loaded, "+r.length+" level(s) found, first bitrate: "+g);break}var x=O&&!I,P={levels:r,audioTracks:n,subtitleTracks:h,firstLevel:this._firstLevel,stats:v.stats,audio:O,video:I,altAudio:!x&&n.some(function(N){return!!N.url})};this.hls.trigger(y.Events.MANIFEST_PARSED,P),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(y.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:v.url,reason:"no level with compatible codecs found in manifest"})},i.onError=function(s,v){if(c.prototype.onError.call(this,s,v),!v.fatal){var g=v.context,p=this._levels[this.currentLevelIndex];if(g&&(g.type===o.PlaylistContextType.AUDIO_TRACK&&p.audioGroupIds&&g.groupId===p.audioGroupIds[p.urlId]||g.type===o.PlaylistContextType.SUBTITLE_TRACK&&p.textGroupIds&&g.groupId===p.textGroupIds[p.urlId]))this.redundantFailover(this.currentLevelIndex);else{var r,n=!1,h=!0;switch(v.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:case L.ErrorDetails.KEY_LOAD_ERROR:case L.ErrorDetails.KEY_LOAD_TIMEOUT:if(v.frag){var b=this._levels[v.frag.level];b?(b.fragmentError++,b.fragmentError>this.hls.config.fragLoadingMaxRetry&&(r=v.frag.level)):r=v.frag.level}break;case L.ErrorDetails.LEVEL_LOAD_ERROR:case L.ErrorDetails.LEVEL_LOAD_TIMEOUT:g&&(g.deliveryDirectives&&(h=!1),r=g.level),n=!0;break;case L.ErrorDetails.REMUX_ALLOC_ERROR:r=v.level,n=!0}r!==void 0&&this.recoverLevel(v,r,n,h)}}},i.recoverLevel=function(s,v,g,p){var r=s.details,n=this._levels[v];if(n.loadError++,g){if(!this.retryLoadingOrFail(s))return void(this.currentLevelIndex=-1);s.levelRetry=!0}if(p){var h=n.url.length;if(h>1&&n.loadError<h)s.levelRetry=!0,this.redundantFailover(v);else if(this.manualLevelIndex===-1){var b=v===0?this._levels.length-1:v-1;this.currentLevelIndex!==b&&this._levels[b].loadError===0&&(this.warn(r+": switch to "+b),s.levelRetry=!0,this.hls.nextAutoLevel=b)}}},i.redundantFailover=function(s){var v=this._levels[s],g=v.url.length;if(g>1){var p=(v.urlId+1)%g;this.warn("Switching to redundant URL-id "+p),this._levels.forEach(function(r){r.urlId=p}),this.level=s}},i.onFragLoaded=function(s,v){var g=v.frag;if(g!==void 0&&g.type===o.PlaylistLevelType.MAIN){var p=this._levels[g.level];p!==void 0&&(p.fragmentError=0,p.loadError=0)}},i.onLevelLoaded=function(s,v){var g,p,r=v.level,n=v.details,h=this._levels[r];if(!h)return this.warn("Invalid level index "+r),void((p=v.deliveryDirectives)!==null&&p!==void 0&&p.skip&&(n.deltaUpdateFailed=!0));r===this.currentLevelIndex?(h.fragmentError===0&&(h.loadError=0,this.retryCount=0),this.playlistLoaded(r,v,h.details)):(g=v.deliveryDirectives)!==null&&g!==void 0&&g.skip&&(n.deltaUpdateFailed=!0)},i.onAudioTrackSwitched=function(s,v){var g=this.hls.levels[this.currentLevelIndex];if(g&&g.audioGroupIds){for(var p=-1,r=this.hls.audioTracks[v.id].groupId,n=0;n<g.audioGroupIds.length;n++)if(g.audioGroupIds[n]===r){p=n;break}p!==g.urlId&&(g.urlId=p,this.startLoad())}},i.loadPlaylist=function(s){var v=this.currentLevelIndex,g=this._levels[v];if(this.canLoad&&g&&g.url.length>0){var p=g.urlId,r=g.url[p];if(s)try{r=s.addDirectives(r)}catch(n){this.warn("Could not construct new URL with HLS Delivery Directives: "+n)}this.log("Attempt loading level index "+v+(s?" at sn "+s.msn+" part "+s.part:"")+" with URL-id "+p+" "+r),this.clearTimer(),this.hls.trigger(y.Events.LEVEL_LOADING,{url:r,level:v,id:p,deliveryDirectives:s||null})}},i.removeLevel=function(s,v){var g=function(r,n){return n!==v},p=this._levels.filter(function(r,n){return n!==s||r.url.length>1&&v!==void 0&&(r.url=r.url.filter(g),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(g)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(g)),r.urlId=0,!0)}).map(function(r,n){var h=r.details;return h!=null&&h.fragments&&h.fragments.forEach(function(b){b.level=n}),r});this._levels=p,this.hls.trigger(y.Events.LEVELS_UPDATED,{levels:p})},l=e,(u=[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(s){var v,g=this._levels;if(g.length!==0&&(this.currentLevelIndex!==s||(v=g[s])===null||v===void 0||!v.details)){if(s<0||s>=g.length){var p=s<0;if(this.hls.trigger(y.Events.ERROR,{type:L.ErrorTypes.OTHER_ERROR,details:L.ErrorDetails.LEVEL_SWITCH_ERROR,level:s,fatal:p,reason:"invalid level idx"}),p)return;s=Math.min(s,g.length-1)}this.clearTimer();var r=this.currentLevelIndex,n=g[r],h=g[s];this.log("switching to level "+s+" from "+r),this.currentLevelIndex=s;var b=S({},h,{level:s,maxBitrate:h.maxBitrate,uri:h.uri,urlId:h.urlId});delete b._urlId,this.hls.trigger(y.Events.LEVEL_SWITCHING,b);var _=h.details;if(!_||_.live){var I=this.switchParams(h.uri,n==null?void 0:n.details);this.loadPlaylist(I)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(s){this.manualLevelIndex=s,this._startLevel===void 0&&(this._startLevel=s),s!==-1&&(this.level=s)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(s){this._firstLevel=s}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var s=this.hls.config.startLevel;return s!==void 0?s:this._firstLevel}return this._startLevel},set:function(s){this._startLevel=s}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(s){this.level=s,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=s)}}])&&m(l.prototype,u),e}(D.default)},"./src/controller/level-helper.ts":function(F,R,d){d.r(R),d.d(R,"addGroupId",function(){return L}),d.d(R,"assignTrackIdsByGroup",function(){return k}),d.d(R,"updatePTS",function(){return w}),d.d(R,"updateFragPTSDTS",function(){return o}),d.d(R,"mergeDetails",function(){return S}),d.d(R,"mapPartIntersection",function(){return m}),d.d(R,"mapFragmentIntersection",function(){return f}),d.d(R,"adjustSliding",function(){return T}),d.d(R,"addSliding",function(){return E}),d.d(R,"computeReloadInterval",function(){return c}),d.d(R,"getFragmentWithSN",function(){return t}),d.d(R,"getPartWith",function(){return a});var A=d("./src/polyfills/number.ts"),y=d("./src/utils/logger.ts");function L(e,l,u){switch(l){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(u);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(u)}}function k(e){var l={};e.forEach(function(u){var i=u.groupId||"";u.id=l[i]=l[i]||0,l[i]++})}function w(e,l,u){D(e[l],e[u])}function D(e,l){var u=l.startPTS;if(Object(A.isFiniteNumber)(u)){var i,s=0;l.sn>e.sn?(s=u-e.start,i=e):(s=e.start-u,i=l),i.duration!==s&&(i.duration=s)}else l.sn>e.sn?e.cc===l.cc&&e.minEndPTS?l.start=e.start+(e.minEndPTS-e.start):l.start=e.start+e.duration:l.start=Math.max(e.start-l.duration,0)}function o(e,l,u,i,s,v){i-u<=0&&(y.logger.warn("Fragment should have a positive duration",l),i=u+l.duration,v=s+l.duration);var g=u,p=i,r=l.startPTS,n=l.endPTS;if(Object(A.isFiniteNumber)(r)){var h=Math.abs(r-u);Object(A.isFiniteNumber)(l.deltaPTS)?l.deltaPTS=Math.max(h,l.deltaPTS):l.deltaPTS=h,g=Math.max(u,r),u=Math.min(u,r),s=Math.min(s,l.startDTS),p=Math.min(i,n),i=Math.max(i,n),v=Math.max(v,l.endDTS)}l.duration=i-u;var b=u-l.start;l.appendedPTS=i,l.start=l.startPTS=u,l.maxStartPTS=g,l.startDTS=s,l.endPTS=i,l.minEndPTS=p,l.endDTS=v;var _,I=l.sn;if(!e||I<e.startSN||I>e.endSN)return 0;var O=I-e.startSN,C=e.fragments;for(C[O]=l,_=O;_>0;_--)D(C[_],C[_-1]);for(_=O;_<C.length-1;_++)D(C[_],C[_+1]);return e.fragmentHint&&D(C[C.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,b}function S(e,l){for(var u=null,i=e.fragments,s=i.length-1;s>=0;s--){var v=i[s].initSegment;if(v){u=v;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var g,p=0;if(f(e,l,function(I,O){var C;I.relurl&&(p=I.cc-O.cc),Object(A.isFiniteNumber)(I.startPTS)&&Object(A.isFiniteNumber)(I.endPTS)&&(O.start=O.startPTS=I.startPTS,O.startDTS=I.startDTS,O.appendedPTS=I.appendedPTS,O.maxStartPTS=I.maxStartPTS,O.endPTS=I.endPTS,O.endDTS=I.endDTS,O.minEndPTS=I.minEndPTS,O.duration=I.endPTS-I.startPTS,O.duration&&(g=O),l.PTSKnown=l.alignedSliding=!0),O.elementaryStreams=I.elementaryStreams,O.loader=I.loader,O.stats=I.stats,O.urlId=I.urlId,I.initSegment?(O.initSegment=I.initSegment,u=I.initSegment):O.initSegment&&O.initSegment.relurl!=((C=u)===null||C===void 0?void 0:C.relurl)||(O.initSegment=u)}),l.skippedSegments&&(l.deltaUpdateFailed=l.fragments.some(function(I){return!I}),l.deltaUpdateFailed)){y.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var r=l.skippedSegments;r--;)l.fragments.shift();l.startSN=l.fragments[0].sn,l.startCC=l.fragments[0].cc}var n=l.fragments;if(p){y.logger.warn("discontinuity sliding from playlist, take drift into account");for(var h=0;h<n.length;h++)n[h].cc+=p}l.skippedSegments&&(l.startCC=l.fragments[0].cc),m(e.partList,l.partList,function(I,O){O.elementaryStreams=I.elementaryStreams,O.stats=I.stats}),g?o(l,g,g.startPTS,g.endPTS,g.startDTS,g.endDTS):T(e,l),n.length&&(l.totalduration=l.edge-n[0].start),l.driftStartTime=e.driftStartTime,l.driftStart=e.driftStart;var b=l.advancedDateTime;if(l.advanced&&b){var _=l.edge;l.driftStart||(l.driftStartTime=b,l.driftStart=_),l.driftEndTime=b,l.driftEnd=_}else l.driftEndTime=e.driftEndTime,l.driftEnd=e.driftEnd,l.advancedDateTime=e.advancedDateTime}function m(e,l,u){if(e&&l)for(var i=0,s=0,v=e.length;s<=v;s++){var g=e[s],p=l[s+i];g&&p&&g.index===p.index&&g.fragment.sn===p.fragment.sn?u(g,p):i--}}function f(e,l,u){for(var i=l.skippedSegments,s=Math.max(e.startSN,l.startSN)-l.startSN,v=(e.fragmentHint?1:0)+(i?l.endSN:Math.min(e.endSN,l.endSN))-l.startSN,g=l.startSN-e.startSN,p=l.fragmentHint?l.fragments.concat(l.fragmentHint):l.fragments,r=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,n=s;n<=v;n++){var h=r[g+n],b=p[n];i&&!b&&n<i&&(b=l.fragments[n]=h),h&&b&&u(h,b)}}function T(e,l){var u=l.startSN+l.skippedSegments-e.startSN,i=e.fragments;u<0||u>=i.length||E(l,i[u].start)}function E(e,l){if(l){for(var u=e.fragments,i=e.skippedSegments;i<u.length;i++)u[i].start+=l;e.fragmentHint&&(e.fragmentHint.start+=l)}}function c(e,l){var u,i=1e3*e.levelTargetDuration,s=i/2,v=e.age,g=v>0&&v<3*i,p=l.loading.end-l.loading.start,r=e.availabilityDelay;if(e.updated===!1)if(g){var n=333*e.misses;u=Math.max(Math.min(s,2*p),n),e.availabilityDelay=(e.availabilityDelay||0)+u}else u=s;else g?(r=Math.min(r||i/2,v),e.availabilityDelay=r,u=r+i-v):u=i-p;return Math.round(u)}function t(e,l,u){if(!e||!e.details)return null;var i=e.details,s=i.fragments[l-i.startSN];return s||((s=i.fragmentHint)&&s.sn===l?s:l<i.startSN&&u&&u.sn===l?u:null)}function a(e,l,u){if(!e||!e.details)return null;var i=e.details.partList;if(i)for(var s=i.length;s--;){var v=i[s];if(v.index===u&&v.fragment.sn===l)return v}return null}},"./src/controller/stream-controller.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return e});var A=d("./src/polyfills/number.ts"),y=d("./src/controller/base-stream-controller.ts"),L=d("./src/is-supported.ts"),k=d("./src/events.ts"),w=d("./src/utils/buffer-helper.ts"),D=d("./src/controller/fragment-tracker.ts"),o=d("./src/types/loader.ts"),S=d("./src/loader/fragment.ts"),m=d("./src/demux/transmuxer-interface.ts"),f=d("./src/types/transmuxer.ts"),T=d("./src/controller/gap-controller.ts"),E=d("./src/errors.ts"),c=d("./src/utils/logger.ts");function t(l,u){for(var i=0;i<u.length;i++){var s=u[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(l,s.key,s)}}function a(l,u){return(a=Object.setPrototypeOf||function(i,s){return i.__proto__=s,i})(l,u)}var e=function(l){var u,i;function s(r,n){var h;return(h=l.call(this,r,n,"[stream-controller]")||this).audioCodecSwap=!1,h.gapController=null,h.level=-1,h._forceStartLoad=!1,h.altAudio=!1,h.audioOnly=!1,h.fragPlaying=null,h.onvplaying=null,h.onvseeked=null,h.fragLastKbps=0,h.stalled=!1,h.couldBacktrack=!1,h.audioCodecSwitch=!1,h.videoBuffer=null,h._registerListeners(),h}i=l,(u=s).prototype=Object.create(i.prototype),u.prototype.constructor=u,a(u,i);var v,g,p=s.prototype;return p._registerListeners=function(){var r=this.hls;r.on(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(k.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(k.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(k.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.on(k.Events.ERROR,this.onError,this),r.on(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(k.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.on(k.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(k.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.on(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},p._unregisterListeners=function(){var r=this.hls;r.off(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(k.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(k.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),r.off(k.Events.ERROR,this.onError,this),r.off(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(k.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),r.off(k.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(k.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),r.off(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},p.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},p.startLoad=function(r){if(this.levels){var n=this.lastCurrentTime,h=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var b=h.startLevel;b===-1&&(h.config.testBandwidth?(b=0,this.bitrateTest=!0):b=h.nextAutoLevel),this.level=h.nextLoadLevel=b,this.loadedmetadata=!1}n>0&&r===-1&&(this.log("Override startPosition with lastCurrentTime @"+n.toFixed(3)),r=n),this.state=y.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()}else this._forceStartLoad=!0,this.state=y.State.STOPPED},p.stopLoad=function(){this._forceStartLoad=!1,l.prototype.stopLoad.call(this)},p.doTick=function(){switch(this.state){case y.State.IDLE:this.doTickIdle();break;case y.State.WAITING_LEVEL:var r,n=this.levels,h=this.level,b=n==null||(r=n[h])===null||r===void 0?void 0:r.details;if(b&&(!b.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(b))break;this.state=y.State.IDLE;break}break;case y.State.FRAG_LOADING_WAITING_RETRY:var _,I=self.performance.now(),O=this.retryDate;(!O||I>=O||(_=this.media)!==null&&_!==void 0&&_.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=y.State.IDLE)}this.onTickEnd()},p.onTickEnd=function(){l.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},p.doTickIdle=function(){var r,n,h=this.hls,b=this.levelLastLoaded,_=this.levels,I=this.media,O=h.config,C=h.nextLoadLevel;if(b!==null&&(I||!this.startFragRequested&&O.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&_&&_[C]){var x=_[C];this.level=h.nextLoadLevel=C;var P=x.details;if(!P||this.state===y.State.WAITING_LEVEL||P.live&&this.levelLastLoaded!==C)this.state=y.State.WAITING_LEVEL;else{var N=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:I,o.PlaylistLevelType.MAIN);if(N!==null&&!(N.len>=this.getMaxBufferLength(x.maxBitrate))){if(this._streamEnded(N,P)){var M={};return this.altAudio&&(M.type="video"),this.hls.trigger(k.Events.BUFFER_EOS,M),void(this.state=y.State.ENDED)}var B=N.end,G=this.getNextFragment(B,P);if(this.couldBacktrack&&!this.fragPrevious&&G&&G.sn!=="initSegment"){var K=G.sn-P.startSN;K>1&&(G=P.fragments[K-1],this.fragmentTracker.removeFragment(G))}if(G&&this.fragmentTracker.getState(G)===D.FragmentState.OK&&this.nextLoadPosition>B){var V=this.audioOnly&&!this.altAudio?S.ElementaryStreamTypes.AUDIO:S.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(I,V,o.PlaylistLevelType.MAIN),G=this.getNextFragment(this.nextLoadPosition,P)}G&&(!G.initSegment||G.initSegment.data||this.bitrateTest||(G=G.initSegment),((r=G.decryptdata)===null||r===void 0?void 0:r.keyFormat)!=="identity"||(n=G.decryptdata)!==null&&n!==void 0&&n.key?this.loadFragment(G,P,B):this.loadKey(G,P))}}}},p.loadFragment=function(r,n,h){var b,_=this.fragmentTracker.getState(r);if(this.fragCurrent=r,_===D.FragmentState.BACKTRACKED){var I=this.fragmentTracker.getBacktrackData(r);if(I)return this._handleFragmentLoadProgress(I),void this._handleFragmentLoadComplete(I);_=D.FragmentState.NOT_LOADED}_===D.FragmentState.NOT_LOADED||_===D.FragmentState.PARTIAL?r.sn==="initSegment"?this._loadInitSegment(r):this.bitrateTest?(r.bitrateTest=!0,this.log("Fragment "+r.sn+" of level "+r.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(r)):(this.startFragRequested=!0,l.prototype.loadFragment.call(this,r,n,h)):_===D.FragmentState.APPENDING?this.reduceMaxBufferLength(r.duration)&&this.fragmentTracker.removeFragment(r):((b=this.media)===null||b===void 0?void 0:b.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},p.getAppendedFrag=function(r){var n=this.fragmentTracker.getAppendedFrag(r,o.PlaylistLevelType.MAIN);return n&&"fragment"in n?n.fragment:n},p.getBufferedFrag=function(r){return this.fragmentTracker.getBufferedFrag(r,o.PlaylistLevelType.MAIN)},p.followingBufferedFrag=function(r){return r?this.getBufferedFrag(r.end+.5):null},p.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},p.nextLevelSwitch=function(){var r=this.levels,n=this.media;if(n!=null&&n.readyState){var h,b=this.getAppendedFrag(n.currentTime);if(b&&b.start>1&&this.flushMainBuffer(0,b.start-1),!n.paused&&r){var _=r[this.hls.nextLoadLevel],I=this.fragLastKbps;h=I&&this.fragCurrent?this.fragCurrent.duration*_.maxBitrate/(1e3*I)+1:0}else h=0;var O=this.getBufferedFrag(n.currentTime+h);if(O){var C=this.followingBufferedFrag(O);if(C){this.abortCurrentFrag();var x=C.maxStartPTS?C.maxStartPTS:C.start,P=C.duration,N=Math.max(O.end,x+Math.min(Math.max(P-this.config.maxFragLookUpTolerance,.5*P),.75*P));this.flushMainBuffer(N,Number.POSITIVE_INFINITY)}}}},p.abortCurrentFrag=function(){var r=this.fragCurrent;this.fragCurrent=null,r!=null&&r.loader&&r.loader.abort(),this.state===y.State.KEY_LOADING&&(this.state=y.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},p.flushMainBuffer=function(r,n){l.prototype.flushMainBuffer.call(this,r,n,this.altAudio?"video":null)},p.onMediaAttached=function(r,n){l.prototype.onMediaAttached.call(this,r,n);var h=n.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),h.addEventListener("playing",this.onvplaying),h.addEventListener("seeked",this.onvseeked),this.gapController=new T.default(this.config,h,this.fragmentTracker,this.hls)},p.onMediaDetaching=function(){var r=this.media;r&&(r.removeEventListener("playing",this.onvplaying),r.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),l.prototype.onMediaDetaching.call(this)},p.onMediaPlaying=function(){this.tick()},p.onMediaSeeked=function(){var r=this.media,n=r?r.currentTime:null;Object(A.isFiniteNumber)(n)&&this.log("Media seeked to "+n.toFixed(3)),this.tick()},p.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(k.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},p.onManifestParsed=function(r,n){var h,b=!1,_=!1;n.levels.forEach(function(I){(h=I.audioCodec)&&(h.indexOf("mp4a.40.2")!==-1&&(b=!0),h.indexOf("mp4a.40.5")!==-1&&(_=!0))}),this.audioCodecSwitch=b&&_&&!Object(L.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=n.levels,this.startFragRequested=!1},p.onLevelLoading=function(r,n){var h=this.levels;if(h&&this.state===y.State.IDLE){var b=h[n.level];(!b.details||b.details.live&&this.levelLastLoaded!==n.level||this.waitForCdnTuneIn(b.details))&&(this.state=y.State.WAITING_LEVEL)}},p.onLevelLoaded=function(r,n){var h,b=this.levels,_=n.level,I=n.details,O=I.totalduration;if(b){this.log("Level "+_+" loaded ["+I.startSN+","+I.endSN+"], cc ["+I.startCC+", "+I.endCC+"] duration:"+O);var C=this.fragCurrent;!C||this.state!==y.State.FRAG_LOADING&&this.state!==y.State.FRAG_LOADING_WAITING_RETRY||C.level!==n.level&&C.loader&&(this.state=y.State.IDLE,C.loader.abort());var x=b[_],P=0;if(I.live||(h=x.details)!==null&&h!==void 0&&h.live){if(I.fragments[0]||(I.deltaUpdateFailed=!0),I.deltaUpdateFailed)return;P=this.alignPlaylists(I,x.details)}if(x.details=I,this.levelLastLoaded=_,this.hls.trigger(k.Events.LEVEL_UPDATED,{details:I,level:_}),this.state===y.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(I))return;this.state=y.State.IDLE}this.startFragRequested?I.live&&this.synchronizeToLiveEdge(I):this.setStartPosition(I,P),this.tick()}else this.warn("Levels were reset while loading level "+_)},p._handleFragmentLoadProgress=function(r){var n,h=r.frag,b=r.part,_=r.payload,I=this.levels;if(I){var O=I[h.level],C=O.details;if(C){var x=O.videoCodec,P=C.PTSKnown||!C.live,N=(n=h.initSegment)===null||n===void 0?void 0:n.data,M=this._getAudioCodec(O),B=this.transmuxer=this.transmuxer||new m.default(this.hls,o.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),G=b?b.index:-1,K=G!==-1,V=new f.ChunkMetadata(h.level,h.sn,h.stats.chunkCount,_.byteLength,G,K),H=this.initPTS[h.cc];B.push(_,N,M,x,h,b,C.totalduration,P,V,H)}else this.warn("Dropping fragment "+h.sn+" of level "+h.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+h.sn+" of level "+h.level+" will not be buffered")},p.onAudioTrackSwitching=function(r,n){var h=this.altAudio,b=!!n.url,_=n.id;if(!b){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var I=this.fragCurrent;I!=null&&I.loader&&(this.log("Switching to main audio track, cancel main fragment load"),I.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var O=this.hls;h&&O.trigger(k.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),O.trigger(k.Events.AUDIO_TRACK_SWITCHED,{id:_})}},p.onAudioTrackSwitched=function(r,n){var h=n.id,b=!!this.hls.audioTracks[h].url;if(b){var _=this.videoBuffer;_&&this.mediaBuffer!==_&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=_)}this.altAudio=b,this.tick()},p.onBufferCreated=function(r,n){var h,b,_=n.tracks,I=!1;for(var O in _){var C=_[O];if(C.id==="main"){if(b=O,h=C,O==="video"){var x=_[O];x&&(this.videoBuffer=x.buffer)}}else I=!0}I&&h?(this.log("Alternate track found, use "+b+".buffered to schedule main fragment loading"),this.mediaBuffer=h.buffer):this.mediaBuffer=this.media},p.onFragBuffered=function(r,n){var h=n.frag,b=n.part;if(!h||h.type===o.PlaylistLevelType.MAIN){if(this.fragContextChanged(h))return this.warn("Fragment "+h.sn+(b?" p: "+b.index:"")+" of level "+h.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===y.State.PARSED&&(this.state=y.State.IDLE));var _=b?b.stats:h.stats;this.fragLastKbps=Math.round(8*_.total/(_.buffering.end-_.loading.first)),h.sn!=="initSegment"&&(this.fragPrevious=h),this.fragBufferedComplete(h,b)}},p.onError=function(r,n){switch(n.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(o.PlaylistLevelType.MAIN,n);break;case E.ErrorDetails.LEVEL_LOAD_ERROR:case E.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==y.State.ERROR&&(n.fatal?(this.warn(""+n.details),this.state=y.State.ERROR):n.levelRetry||this.state!==y.State.WAITING_LEVEL||(this.state=y.State.IDLE));break;case E.ErrorDetails.BUFFER_FULL_ERROR:if(n.parent==="main"&&(this.state===y.State.PARSING||this.state===y.State.PARSED)){var h=!0,b=this.getFwdBufferInfo(this.media,o.PlaylistLevelType.MAIN);b&&b.len>.5&&(h=!this.reduceMaxBufferLength(b.len)),h&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},p.checkBuffer=function(){var r=this.media,n=this.gapController;if(r&&n&&r.readyState){var h=w.BufferHelper.getBuffered(r);!this.loadedmetadata&&h.length?(this.loadedmetadata=!0,this.seekToStartPos()):n.poll(this.lastCurrentTime),this.lastCurrentTime=r.currentTime}},p.onFragLoadEmergencyAborted=function(){this.state=y.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},p.onBufferFlushed=function(r,n){var h=n.type;if(h!==S.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var b=(h===S.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(b,h,o.PlaylistLevelType.MAIN)}},p.onLevelsUpdated=function(r,n){this.levels=n.levels},p.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},p.seekToStartPos=function(){var r=this.media,n=r.currentTime,h=this.startPosition;if(h>=0&&n<h){if(r.seeking)return void c.logger.log("could not seek to "+h+", already seeking at "+n);var b=w.BufferHelper.getBuffered(r),_=(b.length?b.start(0):0)-h;_>0&&_<this.config.maxBufferHole&&(c.logger.log("adjusting start position by "+_+" to match buffer start"),h+=_,this.startPosition=h),this.log("seek to target start position "+h+" from current time "+n),r.currentTime=h}},p._getAudioCodec=function(r){var n=this.config.defaultAudioCodec||r.audioCodec;return this.audioCodecSwap&&n&&(this.log("Swapping audio codec"),n=n.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),n},p._loadBitrateTestFrag=function(r){var n=this;this._doFragLoad(r).then(function(h){var b=n.hls;if(h&&!b.nextLoadLevel&&!n.fragContextChanged(r)){n.fragLoadError=0,n.state=y.State.IDLE,n.startFragRequested=!1,n.bitrateTest=!1;var _=r.stats;_.parsing.start=_.parsing.end=_.buffering.start=_.buffering.end=self.performance.now(),b.trigger(k.Events.FRAG_LOADED,h)}})},p._handleTransmuxComplete=function(r){var n,h="main",b=this.hls,_=r.remuxResult,I=r.chunkMeta,O=this.getCurrentContext(I);if(!O)return this.warn("The loading context changed while buffering fragment "+I.sn+" of level "+I.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(I.level);var C=O.frag,x=O.part,P=O.level,N=_.video,M=_.text,B=_.id3,G=_.initSegment,K=this.altAudio?void 0:_.audio;if(!this.fragContextChanged(C)){if(this.state=y.State.PARSING,G){G.tracks&&(this._bufferInitSegment(P,G.tracks,C,I),b.trigger(k.Events.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:h,tracks:G.tracks}));var V=G.initPTS,H=G.timescale;Object(A.isFiniteNumber)(V)&&(this.initPTS[C.cc]=V,b.trigger(k.Events.INIT_PTS_FOUND,{frag:C,id:h,initPTS:V,timescale:H}))}if(N&&_.independent!==!1){if(P.details){var W=N.startPTS,Y=N.endPTS,X=N.startDTS,tt=N.endDTS;if(x)x.elementaryStreams[N.type]={startPTS:W,endPTS:Y,startDTS:X,endDTS:tt};else if(N.firstKeyFrame&&N.independent&&(this.couldBacktrack=!0),N.dropped&&N.independent){if(this.getLoadPosition()+this.config.maxBufferHole<W)return void this.backtrack(C);C.setElementaryStreamInfo(N.type,C.start,Y,C.start,tt,!0)}C.setElementaryStreamInfo(N.type,W,Y,X,tt),this.bufferFragmentData(N,C,x,I)}}else if(_.independent===!1)return void this.backtrack(C);if(K){var et=K.startPTS,nt=K.endPTS,J=K.startDTS,st=K.endDTS;x&&(x.elementaryStreams[S.ElementaryStreamTypes.AUDIO]={startPTS:et,endPTS:nt,startDTS:J,endDTS:st}),C.setElementaryStreamInfo(S.ElementaryStreamTypes.AUDIO,et,nt,J,st),this.bufferFragmentData(K,C,x,I)}if(B!=null&&(n=B.samples)!==null&&n!==void 0&&n.length){var Z={frag:C,id:h,samples:B.samples};b.trigger(k.Events.FRAG_PARSING_METADATA,Z)}if(M){var rt={frag:C,id:h,samples:M.samples};b.trigger(k.Events.FRAG_PARSING_USERDATA,rt)}}},p._bufferInitSegment=function(r,n,h,b){var _=this;if(this.state===y.State.PARSING){this.audioOnly=!!n.audio&&!n.video,this.altAudio&&!this.audioOnly&&delete n.audio;var I=n.audio,O=n.video,C=n.audiovideo;if(I){var x=r.audioCodec,P=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(x&&(x=x.indexOf("mp4a.40.5")!==-1?"mp4a.40.2":"mp4a.40.5"),I.metadata.channelCount!==1&&P.indexOf("firefox")===-1&&(x="mp4a.40.5")),P.indexOf("android")!==-1&&I.container!=="audio/mpeg"&&(x="mp4a.40.2",this.log("Android: force audio codec to "+x)),r.audioCodec&&r.audioCodec!==x&&this.log('Swapping manifest audio codec "'+r.audioCodec+'" for "'+x+'"'),I.levelCodec=x,I.id="main",this.log("Init audio buffer, container:"+I.container+", codecs[selected/level/parsed]=["+(x||"")+"/"+(r.audioCodec||"")+"/"+I.codec+"]")}O&&(O.levelCodec=r.videoCodec,O.id="main",this.log("Init video buffer, container:"+O.container+", codecs[level/parsed]=["+(r.videoCodec||"")+"/"+O.codec+"]")),C&&this.log("Init audiovideo buffer, container:"+C.container+", codecs[level/parsed]=["+(r.attrs.CODECS||"")+"/"+C.codec+"]"),this.hls.trigger(k.Events.BUFFER_CODECS,n),Object.keys(n).forEach(function(N){var M=n[N].initSegment;M!=null&&M.byteLength&&_.hls.trigger(k.Events.BUFFER_APPENDING,{type:N,data:M,frag:h,part:null,chunkMeta:b,parent:h.type})}),this.tick()}},p.backtrack=function(r){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(r);var n=this.fragmentTracker.backtrack(r);this.fragPrevious=null,this.nextLoadPosition=r.start,n?this.resetFragmentLoading(r):this.state=y.State.BACKTRACKING},p.checkFragmentChanged=function(){var r=this.media,n=null;if(r&&r.readyState>1&&r.seeking===!1){var h=r.currentTime;if(w.BufferHelper.isBuffered(r,h)?n=this.getAppendedFrag(h):w.BufferHelper.isBuffered(r,h+.1)&&(n=this.getAppendedFrag(h+.1)),n){var b=this.fragPlaying,_=n.level;b&&n.sn===b.sn&&b.level===_&&n.urlId===b.urlId||(this.hls.trigger(k.Events.FRAG_CHANGED,{frag:n}),b&&b.level===_||this.hls.trigger(k.Events.LEVEL_SWITCHED,{level:_}),this.fragPlaying=n)}}},v=s,(g=[{key:"nextLevel",get:function(){var r=this.nextBufferedFrag;return r?r.level:-1}},{key:"currentLevel",get:function(){var r=this.media;if(r){var n=this.getAppendedFrag(r.currentTime);if(n)return n.level}return-1}},{key:"nextBufferedFrag",get:function(){var r=this.media;if(r){var n=this.getAppendedFrag(r.currentTime);return this.followingBufferedFrag(n)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&t(v.prototype,g),s}(y.default)},"./src/controller/subtitle-stream-controller.ts":function(F,R,d){d.r(R),d.d(R,"SubtitleStreamController",function(){return c});var A=d("./src/events.ts"),y=d("./src/utils/logger.ts"),L=d("./src/utils/buffer-helper.ts"),k=d("./src/controller/fragment-finders.ts"),w=d("./src/utils/discontinuities.ts"),D=d("./src/controller/level-helper.ts"),o=d("./src/controller/fragment-tracker.ts"),S=d("./src/controller/base-stream-controller.ts"),m=d("./src/types/loader.ts"),f=d("./src/types/level.ts");function T(t,a){for(var e=0;e<a.length;e++){var l=a[e];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(t,l.key,l)}}function E(t,a){return(E=Object.setPrototypeOf||function(e,l){return e.__proto__=l,e})(t,a)}var c=function(t){var a,e;function l(v,g){var p;return(p=t.call(this,v,g,"[subtitle-stream-controller]")||this).levels=[],p.currentTrackId=-1,p.tracksBuffered=[],p.mainDetails=null,p._registerListeners(),p}e=t,(a=l).prototype=Object.create(e.prototype),a.prototype.constructor=a,E(a,e);var u,i,s=l.prototype;return s.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},s._registerListeners=function(){var v=this.hls;v.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(A.Events.ERROR,this.onError,this),v.on(A.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.on(A.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.on(A.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.on(A.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.on(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},s._unregisterListeners=function(){var v=this.hls;v.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(A.Events.ERROR,this.onError,this),v.off(A.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.off(A.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.off(A.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.off(A.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.off(A.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},s.startLoad=function(){this.stopLoad(),this.state=S.State.IDLE,this.setInterval(500),this.tick()},s.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},s.onLevelLoaded=function(v,g){this.mainDetails=g.details},s.onSubtitleFragProcessed=function(v,g){var p=g.frag,r=g.success;if(this.fragPrevious=p,this.state=S.State.IDLE,r){var n=this.tracksBuffered[this.currentTrackId];if(n){for(var h,b=p.start,_=0;_<n.length;_++)if(b>=n[_].start&&b<=n[_].end){h=n[_];break}var I=p.start+p.duration;h?h.end=I:(h={start:b,end:I},n.push(h)),this.fragmentTracker.fragBuffered(p)}}},s.onBufferFlushing=function(v,g){var p=g.startOffset,r=g.endOffset;if(p===0&&r!==Number.POSITIVE_INFINITY){var n=this.currentTrackId,h=this.levels;if(!h.length||!h[n]||!h[n].details)return;var b=r-h[n].details.targetduration;if(b<=0)return;g.endOffsetSubtitles=Math.max(0,b),this.tracksBuffered.forEach(function(_){for(var I=0;I<_.length;)if(_[I].end<=b)_.shift();else{if(!(_[I].start<b))break;_[I].start=b,I++}}),this.fragmentTracker.removeFragmentsInRange(p,b,m.PlaylistLevelType.SUBTITLE)}},s.onError=function(v,g){var p,r=g.frag;r&&r.type===m.PlaylistLevelType.SUBTITLE&&((p=this.fragCurrent)!==null&&p!==void 0&&p.loader&&this.fragCurrent.loader.abort(),this.state=S.State.IDLE)},s.onSubtitleTracksUpdated=function(v,g){var p=this,r=g.subtitleTracks;this.tracksBuffered=[],this.levels=r.map(function(n){return new f.Level(n)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(n){p.tracksBuffered[n.id]=[]}),this.mediaBuffer=null},s.onSubtitleTrackSwitch=function(v,g){if(this.currentTrackId=g.id,this.levels.length&&this.currentTrackId!==-1){var p=this.levels[this.currentTrackId];p!=null&&p.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null}else this.clearInterval()},s.onSubtitleTrackLoaded=function(v,g){var p,r=g.details,n=g.id,h=this.currentTrackId,b=this.levels;if(b.length){var _=b[h];if(!(n>=b.length||n!==h)&&_){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||(p=_.details)!==null&&p!==void 0&&p.live){var I=this.mainDetails;if(r.deltaUpdateFailed||!I)return;var O=I.fragments[0];_.details?this.alignPlaylists(r,_.details)===0&&O&&Object(D.addSliding)(r,O.start):r.hasProgramDateTime&&I.hasProgramDateTime?Object(w.alignPDT)(r,I):O&&Object(D.addSliding)(r,O.start)}_.details=r,this.levelLastLoaded=n,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===S.State.IDLE&&(Object(k.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),_.details=void 0))}}},s._handleFragmentLoadComplete=function(v){var g=v.frag,p=v.payload,r=g.decryptdata,n=this.hls;if(!this.fragContextChanged(g)&&p&&p.byteLength>0&&r&&r.key&&r.iv&&r.method==="AES-128"){var h=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(p),r.key.buffer,r.iv.buffer).then(function(b){var _=performance.now();n.trigger(A.Events.FRAG_DECRYPTED,{frag:g,payload:b,stats:{tstart:h,tdecrypt:_}})})}},s.doTick=function(){if(this.media){if(this.state===S.State.IDLE){var v,g=this.currentTrackId,p=this.levels;if(!p.length||!p[g]||!p[g].details)return;var r=p[g].details,n=r.targetduration,h=this.config,b=this.media,_=L.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,b.currentTime-n,h.maxBufferHole),I=_.end;if(_.len>this.getMaxBufferLength()+n)return;console.assert(r,"Subtitle track details are defined on idle subtitle stream controller tick");var O,C=r.fragments,x=C.length,P=r.edge,N=this.fragPrevious;if(I<P){var M=h.maxFragLookUpTolerance;N&&r.hasProgramDateTime&&(O=Object(k.findFragmentByPDT)(C,N.endProgramDateTime,M)),O||!(O=Object(k.findFragmentByPTS)(N,C,I,M))&&N&&N.start<C[0].start&&(O=C[0])}else O=C[x-1];(v=O)!==null&&v!==void 0&&v.encrypted?(y.logger.log("Loading key for "+O.sn),this.state=S.State.KEY_LOADING,this.hls.trigger(A.Events.KEY_LOADING,{frag:O})):O&&this.fragmentTracker.getState(O)===o.FragmentState.NOT_LOADED&&this.loadFragment(O,r,I)}}else this.state=S.State.IDLE},s.loadFragment=function(v,g,p){this.fragCurrent=v,t.prototype.loadFragment.call(this,v,g,p)},u=l,(i=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&T(u.prototype,i),l}(S.default)},"./src/controller/subtitle-track-controller.ts":function(F,R,d){d.r(R);var A=d("./src/events.ts"),y=d("./src/utils/texttrack-utils.ts"),L=d("./src/controller/base-playlist-controller.ts"),k=d("./src/types/loader.ts");function w(m,f){for(var T=0;T<f.length;T++){var E=f[T];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(m,E.key,E)}}function D(m,f){return(D=Object.setPrototypeOf||function(T,E){return T.__proto__=E,T})(m,f)}var o=function(m){var f,T;function E(e){var l;return(l=m.call(this,e,"[subtitle-track-controller]")||this).media=null,l.tracks=[],l.groupId=null,l.tracksInGroup=[],l.trackId=-1,l.selectDefaultTrack=!0,l.queuedDefaultTrack=-1,l.trackChangeListener=function(){return l.onTextTracksChanged()},l.asyncPollTrackChange=function(){return l.pollTrackChange(0)},l.useTextTrackPolling=!1,l.subtitlePollingInterval=-1,l.subtitleDisplay=!0,l.registerListeners(),l}T=m,(f=E).prototype=Object.create(T.prototype),f.prototype.constructor=f,D(f,T);var c,t,a=E.prototype;return a.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,m.prototype.destroy.call(this)},a.registerListeners=function(){var e=this.hls;e.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(A.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(A.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(A.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(A.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){var e=this.hls;e.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(A.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(A.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(A.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(A.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(A.Events.ERROR,this.onError,this)},a.onMediaAttached=function(e,l){this.media=l.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},a.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},a.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),S(this.media.textTracks).forEach(function(e){Object(y.clearCurrentCues)(e)}),this.subtitleTrack=-1,this.media=null)},a.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},a.onManifestParsed=function(e,l){this.tracks=l.subtitleTracks},a.onSubtitleTrackLoaded=function(e,l){var u=l.id,i=l.details,s=this.trackId,v=this.tracksInGroup[s];if(v){var g=v.details;v.details=l.details,this.log("subtitle track "+u+" loaded ["+i.startSN+"-"+i.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,l,g))}else this.warn("Invalid subtitle track id "+u)},a.onLevelLoading=function(e,l){this.switchLevel(l.level)},a.onLevelSwitching=function(e,l){this.switchLevel(l.level)},a.switchLevel=function(e){var l=this.hls.levels[e];if(l!=null&&l.textGroupIds){var u=l.textGroupIds[l.urlId];if(this.groupId!==u){var i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,s=this.tracks.filter(function(p){return!u||p.groupId===u});this.tracksInGroup=s;var v=this.findTrackId(i==null?void 0:i.name)||this.findTrackId();this.groupId=u;var g={subtitleTracks:s};this.log("Updating subtitle tracks, "+s.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(A.Events.SUBTITLE_TRACKS_UPDATED,g),v!==-1&&this.setSubtitleTrack(v,i)}}},a.findTrackId=function(e){for(var l=this.tracksInGroup,u=0;u<l.length;u++){var i=l[u];if((!this.selectDefaultTrack||i.default)&&(!e||e===i.name))return i.id}return-1},a.onError=function(e,l){m.prototype.onError.call(this,e,l),!l.fatal&&l.context&&l.context.type===k.PlaylistContextType.SUBTITLE_TRACK&&l.context.id===this.trackId&&l.context.groupId===this.groupId&&this.retryLoadingOrFail(l)},a.loadPlaylist=function(e){var l=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(l)){var u=l.id,i=l.groupId,s=l.url;if(e)try{s=e.addDirectives(s)}catch(v){this.warn("Could not construct new URL with HLS Delivery Directives: "+v)}this.log("Loading subtitle playlist for id "+u),this.hls.trigger(A.Events.SUBTITLE_TRACK_LOADING,{url:s,id:u,groupId:i,deliveryDirectives:e||null})}},a.toggleTrackModes=function(e){var l=this,u=this.media,i=this.subtitleDisplay,s=this.trackId;if(u){var v=S(u.textTracks),g=v.filter(function(n){return n.groupId===l.groupId});if(e===-1)[].slice.call(v).forEach(function(n){n.mode="disabled"});else{var p=g[s];p&&(p.mode="disabled")}var r=g[e];r&&(r.mode=i?"showing":"hidden")}},a.setSubtitleTrack=function(e,l){var u,i=this.tracksInGroup;if(this.media){if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(u=i[e])!==null&&u!==void 0&&u.details)||e<-1||e>=i.length)){this.clearTimer();var s=i[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,s){var v=s.id,g=s.groupId,p=g===void 0?"":g,r=s.name,n=s.type,h=s.url;this.hls.trigger(A.Events.SUBTITLE_TRACK_SWITCH,{id:v,groupId:p,name:r,type:n,url:h});var b=this.switchParams(s.url,l==null?void 0:l.details);this.loadPlaylist(b)}else this.hls.trigger(A.Events.SUBTITLE_TRACK_SWITCH,{id:e})}}else this.queuedDefaultTrack=e},a.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,l=S(this.media.textTracks),u=0;u<l.length;u++)if(l[u].mode==="hidden")e=u;else if(l[u].mode==="showing"){e=u;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},c=E,(t=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var l=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,l)}}])&&w(c.prototype,t),E}(L.default);function S(m){for(var f=[],T=0;T<m.length;T++){var E=m[T];E.kind==="subtitles"&&E.label&&f.push(m[T])}return f}R.default=o},"./src/controller/timeline-controller.ts":function(F,R,d){d.r(R),d.d(R,"TimelineController",function(){return f});var A=d("./src/polyfills/number.ts"),y=d("./src/events.ts"),L=d("./src/utils/cea-608-parser.ts"),k=d("./src/utils/output-filter.ts"),w=d("./src/utils/webvtt-parser.ts"),D=d("./src/utils/texttrack-utils.ts"),o=d("./src/utils/imsc1-ttml-parser.ts"),S=d("./src/types/loader.ts"),m=d("./src/utils/logger.ts"),f=function(){function E(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var a=new k.default(this,"textTrack1"),e=new k.default(this,"textTrack2"),l=new k.default(this,"textTrack3"),u=new k.default(this,"textTrack4");this.cea608Parser1=new L.default(1,a,e),this.cea608Parser2=new L.default(3,l,u)}t.on(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(y.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(y.Events.FRAG_LOADING,this.onFragLoading,this),t.on(y.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(y.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(y.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(y.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(y.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var c=E.prototype;return c.destroy=function(){var t=this.hls;t.off(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(y.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(y.Events.FRAG_LOADING,this.onFragLoading,this),t.off(y.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(y.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(y.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(y.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(y.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},c.addCues=function(t,a,e,l,u){for(var i,s,v,g,p=!1,r=u.length;r--;){var n=u[r],h=(i=n[0],s=n[1],v=a,g=e,Math.min(s,g)-Math.max(i,v));if(h>=0&&(n[0]=Math.min(n[0],a),n[1]=Math.max(n[1],e),p=!0,h/(e-a)>.5))return}if(p||u.push([a,e]),this.config.renderTextTracksNatively){var b=this.captionsTracks[t];this.Cues.newCue(b,a,e,l)}else{var _=this.Cues.newCue(null,a,e,l);this.hls.trigger(y.Events.CUES_PARSED,{type:"captions",cues:_,track:t})}},c.onInitPtsFound=function(t,a){var e=this,l=a.frag,u=a.id,i=a.initPTS,s=a.timescale,v=this.unparsedVttFrags;u==="main"&&(this.initPTS[l.cc]=i,this.timescale[l.cc]=s),v.length&&(this.unparsedVttFrags=[],v.forEach(function(g){e.onFragLoaded(y.Events.FRAG_LOADED,g)}))},c.getExistingTrack=function(t){var a=this.media;if(a)for(var e=0;e<a.textTracks.length;e++){var l=a.textTracks[e];if(l[t])return l}return null},c.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},c.createNativeTrack=function(t){if(!this.captionsTracks[t]){var a=this.captionsProperties,e=this.captionsTracks,l=this.media,u=a[t],i=u.label,s=u.languageCode,v=this.getExistingTrack(t);if(v)e[t]=v,Object(D.clearCurrentCues)(e[t]),Object(D.sendAddTrackEvent)(e[t],l);else{var g=this.createTextTrack("captions",i,s);g&&(g[t]=!0,e[t]=g)}}},c.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var a=this.captionsProperties[t];if(a){var e={_id:t,label:a.label,kind:"captions",default:!!a.media&&!!a.media.default,closedCaptions:a.media};this.nonNativeCaptionsTracks[t]=e,this.hls.trigger(y.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[e]})}}},c.createTextTrack=function(t,a,e){var l=this.media;if(l)return l.addTextTrack(t,a,e)},c.onMediaAttaching=function(t,a){this.media=a.media,this._cleanTracks()},c.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach(function(a){Object(D.clearCurrentCues)(t[a]),delete t[a]}),this.nonNativeCaptionsTracks={}},c.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},c._cleanTracks=function(){var t=this.media;if(t){var a=t.textTracks;if(a)for(var e=0;e<a.length;e++)Object(D.clearCurrentCues)(a[e])}},c.onSubtitleTracksUpdated=function(t,a){var e=this;this.textTracks=[];var l=a.subtitleTracks||[],u=l.some(function(g){return g.textCodec===o.IMSC1_CODEC});if(this.config.enableWebVTT||u&&this.config.enableIMSC1){var i=this.tracks&&l&&this.tracks.length===l.length;if(this.tracks=l||[],this.config.renderTextTracksNatively){var s=this.media?this.media.textTracks:[];this.tracks.forEach(function(g,p){var r;if(p<s.length){for(var n=null,h=0;h<s.length;h++)if(T(s[h],g)){n=s[h];break}n&&(r=n)}r?Object(D.clearCurrentCues)(r):(r=e.createTextTrack("subtitles",g.name,g.lang))&&(r.mode="disabled"),r&&(r.groupId=g.groupId,e.textTracks.push(r))})}else if(!i&&this.tracks&&this.tracks.length){var v=this.tracks.map(function(g){return{label:g.name,kind:g.type.toLowerCase(),default:g.default,subtitleTrack:g}});this.hls.trigger(y.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:v})}}},c.onManifestLoaded=function(t,a){var e=this;this.config.enableCEA708Captions&&a.captions&&a.captions.forEach(function(l){var u=/(?:CC|SERVICE)([1-4])/.exec(l.instreamId);if(u){var i="textTrack"+u[1],s=e.captionsProperties[i];s&&(s.label=l.name,l.lang&&(s.languageCode=l.lang),s.media=l)}})},c.onFragLoading=function(t,a){var e=this.cea608Parser1,l=this.cea608Parser2,u=this.lastSn;if(this.enabled&&e&&l&&a.frag.type===S.PlaylistLevelType.MAIN){var i=a.frag.sn;i!==u+1&&(e.reset(),l.reset()),this.lastSn=i}},c.onFragLoaded=function(t,a){var e=a.frag,l=a.payload,u=this.initPTS,i=this.unparsedVttFrags;if(e.type===S.PlaylistLevelType.SUBTITLE)if(l.byteLength){if(!Object(A.isFiniteNumber)(u[e.cc]))return i.push(a),void(u.length&&this.hls.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:new Error("Missing initial subtitle PTS")}));var s=e.decryptdata;if(s==null||s.key==null||s.method!=="AES-128"){var v=this.tracks[e.level],g=this.vttCCs;g[e.cc]||(g[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc),v&&v.textCodec===o.IMSC1_CODEC?this._parseIMSC1(e,l):this._parseVTTs(e,l,g)}}else this.hls.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:new Error("Empty subtitle payload")})},c._parseIMSC1=function(t,a){var e=this,l=this.hls;Object(o.parseIMSC1)(a,this.initPTS[t.cc],this.timescale[t.cc],function(u){e._appendCues(u,t.level),l.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(u){m.logger.log("Failed to parse IMSC1: "+u),l.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:u})})},c._parseVTTs=function(t,a,e){var l=this,u=this.hls;Object(w.parseWebVTT)(a,this.initPTS[t.cc],this.timescale[t.cc],e,t.cc,t.start,function(i){l._appendCues(i,t.level),u.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})},function(i){l._fallbackToIMSC1(t,a),m.logger.log("Failed to parse VTT cue: "+i),u.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:i})})},c._fallbackToIMSC1=function(t,a){var e=this,l=this.tracks[t.level];l.textCodec||Object(o.parseIMSC1)(a,this.initPTS[t.cc],this.timescale[t.cc],function(){l.textCodec=o.IMSC1_CODEC,e._parseIMSC1(t,a)},function(){l.textCodec="wvtt"})},c._appendCues=function(t,a){var e=this.hls;if(this.config.renderTextTracksNatively){var l=this.textTracks[a];if(l.mode==="disabled")return;t.forEach(function(i){return Object(D.addCueToTrack)(l,i)})}else{var u=this.tracks[a].default?"default":"subtitles"+a;e.trigger(y.Events.CUES_PARSED,{type:"subtitles",cues:t,track:u})}},c.onFragDecrypted=function(t,a){var e=a.frag;if(e.type===S.PlaylistLevelType.SUBTITLE){if(!Object(A.isFiniteNumber)(this.initPTS[e.cc]))return void this.unparsedVttFrags.push(a);this.onFragLoaded(y.Events.FRAG_LOADED,a)}},c.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},c.onFragParsingUserdata=function(t,a){var e=this.cea608Parser1,l=this.cea608Parser2;if(this.enabled&&e&&l)for(var u=0;u<a.samples.length;u++){var i=a.samples[u].bytes;if(i){var s=this.extractCea608Data(i);e.addData(a.samples[u].pts,s[0]),l.addData(a.samples[u].pts,s[1])}}},c.onBufferFlushing=function(t,a){var e=a.startOffset,l=a.endOffset,u=a.endOffsetSubtitles,i=a.type,s=this.media;if(s&&!(s.currentTime<l)){if(!i||i==="video"){var v=this.captionsTracks;Object.keys(v).forEach(function(p){return Object(D.removeCuesInRange)(v[p],e,l)})}if(this.config.renderTextTracksNatively&&e===0&&u!==void 0){var g=this.textTracks;Object.keys(g).forEach(function(p){return Object(D.removeCuesInRange)(g[p],e,u)})}}},c.extractCea608Data=function(t){for(var a=31&t[0],e=2,l=[[],[]],u=0;u<a;u++){var i=t[e++],s=127&t[e++],v=127&t[e++],g=3&i;s===0&&v===0||(4&i)!=0&&(g!==0&&g!==1||(l[g].push(s),l[g].push(v)))}return l},E}();function T(E,c){return E&&E.label===c.name&&!(E.textTrack1||E.textTrack2)}},"./src/crypt/aes-crypto.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return A});var A=function(){function y(L,k){this.subtle=void 0,this.aesIV=void 0,this.subtle=L,this.aesIV=k}return y.prototype.decrypt=function(L,k){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},k,L)},y}()},"./src/crypt/aes-decryptor.ts":function(F,R,d){d.r(R),d.d(R,"removePadding",function(){return y}),d.d(R,"default",function(){return L});var A=d("./src/utils/typed-array.ts");function y(k){var w=k.byteLength,D=w&&new DataView(k.buffer).getUint8(w-1);return D?Object(A.sliceUint8)(k,0,w-D):k}var L=function(){function k(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var w=k.prototype;return w.uint8ArrayToUint32Array_=function(D){for(var o=new DataView(D),S=new Uint32Array(4),m=0;m<4;m++)S[m]=o.getUint32(4*m);return S},w.initTable=function(){var D=this.sBox,o=this.invSBox,S=this.subMix,m=S[0],f=S[1],T=S[2],E=S[3],c=this.invSubMix,t=c[0],a=c[1],e=c[2],l=c[3],u=new Uint32Array(256),i=0,s=0,v=0;for(v=0;v<256;v++)u[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var g=s^s<<1^s<<2^s<<3^s<<4;g=g>>>8^255&g^99,D[i]=g,o[g]=i;var p=u[i],r=u[p],n=u[r],h=257*u[g]^16843008*g;m[i]=h<<24|h>>>8,f[i]=h<<16|h>>>16,T[i]=h<<8|h>>>24,E[i]=h,h=16843009*n^65537*r^257*p^16843008*i,t[g]=h<<24|h>>>8,a[g]=h<<16|h>>>16,e[g]=h<<8|h>>>24,l[g]=h,i?(i=p^u[u[u[n^p]]],s^=u[u[s]]):i=s=1}},w.expandKey=function(D){for(var o=this.uint8ArrayToUint32Array_(D),S=!0,m=0;m<o.length&&S;)S=o[m]===this.key[m],m++;if(!S){this.key=o;var f=this.keySize=o.length;if(f!==4&&f!==6&&f!==8)throw new Error("Invalid aes key size="+f);var T,E,c,t,a=this.ksRows=4*(f+6+1),e=this.keySchedule=new Uint32Array(a),l=this.invKeySchedule=new Uint32Array(a),u=this.sBox,i=this.rcon,s=this.invSubMix,v=s[0],g=s[1],p=s[2],r=s[3];for(T=0;T<a;T++)T<f?c=e[T]=o[T]:(t=c,T%f==0?(t=u[(t=t<<8|t>>>24)>>>24]<<24|u[t>>>16&255]<<16|u[t>>>8&255]<<8|u[255&t],t^=i[T/f|0]<<24):f>6&&T%f==4&&(t=u[t>>>24]<<24|u[t>>>16&255]<<16|u[t>>>8&255]<<8|u[255&t]),e[T]=c=(e[T-f]^t)>>>0);for(E=0;E<a;E++)T=a-E,t=3&E?e[T]:e[T-4],l[E]=E<4||T<=4?t:v[u[t>>>24]]^g[u[t>>>16&255]]^p[u[t>>>8&255]]^r[u[255&t]],l[E]=l[E]>>>0}},w.networkToHostOrderSwap=function(D){return D<<24|(65280&D)<<8|(16711680&D)>>8|D>>>24},w.decrypt=function(D,o,S){for(var m,f,T,E,c,t,a,e,l,u,i,s,v,g,p=this.keySize+6,r=this.invKeySchedule,n=this.invSBox,h=this.invSubMix,b=h[0],_=h[1],I=h[2],O=h[3],C=this.uint8ArrayToUint32Array_(S),x=C[0],P=C[1],N=C[2],M=C[3],B=new Int32Array(D),G=new Int32Array(B.length),K=this.networkToHostOrderSwap;o<B.length;){for(l=K(B[o]),u=K(B[o+1]),i=K(B[o+2]),s=K(B[o+3]),c=l^r[0],t=s^r[1],a=i^r[2],e=u^r[3],v=4,g=1;g<p;g++)m=b[c>>>24]^_[t>>16&255]^I[a>>8&255]^O[255&e]^r[v],f=b[t>>>24]^_[a>>16&255]^I[e>>8&255]^O[255&c]^r[v+1],T=b[a>>>24]^_[e>>16&255]^I[c>>8&255]^O[255&t]^r[v+2],E=b[e>>>24]^_[c>>16&255]^I[t>>8&255]^O[255&a]^r[v+3],c=m,t=f,a=T,e=E,v+=4;m=n[c>>>24]<<24^n[t>>16&255]<<16^n[a>>8&255]<<8^n[255&e]^r[v],f=n[t>>>24]<<24^n[a>>16&255]<<16^n[e>>8&255]<<8^n[255&c]^r[v+1],T=n[a>>>24]<<24^n[e>>16&255]<<16^n[c>>8&255]<<8^n[255&t]^r[v+2],E=n[e>>>24]<<24^n[c>>16&255]<<16^n[t>>8&255]<<8^n[255&a]^r[v+3],G[o]=K(m^x),G[o+1]=K(E^P),G[o+2]=K(T^N),G[o+3]=K(f^M),x=l,P=u,N=i,M=s,o+=4}return G.buffer},k}()},"./src/crypt/decrypter.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return o});var A=d("./src/crypt/aes-crypto.ts"),y=d("./src/crypt/fast-aes-key.ts"),L=d("./src/crypt/aes-decryptor.ts"),k=d("./src/utils/logger.ts"),w=d("./src/utils/mp4-tools.ts"),D=d("./src/utils/typed-array.ts"),o=function(){function S(f,T,E){var c=(E===void 0?{}:E).removePKCS7Padding,t=c===void 0||c;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=f,this.config=T,this.removePKCS7Padding=t,t)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var m=S.prototype;return m.destroy=function(){this.observer=null},m.isSync=function(){return this.config.enableSoftwareAES},m.flush=function(){var f=this.currentResult;if(f){var T=new Uint8Array(f);return this.reset(),this.removePKCS7Padding?Object(L.removePadding)(T):T}this.reset()},m.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},m.decrypt=function(f,T,E,c){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(f),T,E);var t=this.flush();t&&c(t.buffer)}else this.webCryptoDecrypt(new Uint8Array(f),T,E).then(c)},m.softwareDecrypt=function(f,T,E){var c=this.currentIV,t=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(f=Object(w.appendUint8Array)(a,f),this.remainderData=null);var e=this.getValidChunk(f);if(!e.length)return null;c&&(E=c);var l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new L.default),l.expandKey(T);var u=t;return this.currentResult=l.decrypt(e.buffer,0,E),this.currentIV=Object(D.sliceUint8)(e,-16).buffer,u||null},m.webCryptoDecrypt=function(f,T,E){var c=this,t=this.subtle;return this.key===T&&this.fastAesKey||(this.key=T,this.fastAesKey=new y.default(t,T)),this.fastAesKey.expandKey().then(function(a){return t?new A.default(t,E).decrypt(f.buffer,a):Promise.reject(new Error("web crypto not initialized"))}).catch(function(a){return c.onWebCryptoError(a,f,T,E)})},m.onWebCryptoError=function(f,T,E,c){return k.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",f),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(T,E,c)},m.getValidChunk=function(f){var T=f,E=f.length-f.length%16;return E!==f.length&&(T=Object(D.sliceUint8)(f,0,E),this.remainderData=Object(D.sliceUint8)(f,E)),T},m.logOnce=function(f){this.logEnabled&&(k.logger.log("[decrypter.ts]: "+f),this.logEnabled=!1)},S}()},"./src/crypt/fast-aes-key.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return A});var A=function(){function y(L,k){this.subtle=void 0,this.key=void 0,this.subtle=L,this.key=k}return y.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},y}()},"./src/demux/aacdemuxer.ts":function(F,R,d){d.r(R);var A=d("./src/demux/base-audio-demuxer.ts"),y=d("./src/demux/adts.ts"),L=d("./src/utils/logger.ts"),k=d("./src/demux/id3.ts");function w(o,S){return(w=Object.setPrototypeOf||function(m,f){return m.__proto__=f,m})(o,S)}var D=function(o){var S,m;function f(E,c){var t;return(t=o.call(this)||this).observer=void 0,t.config=void 0,t.observer=E,t.config=c,t}m=o,(S=f).prototype=Object.create(m.prototype),S.prototype.constructor=S,w(S,m);var T=f.prototype;return T.resetInitSegment=function(E,c,t){o.prototype.resetInitSegment.call(this,E,c,t),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:E,duration:t,inputTimeScale:9e4,dropped:0}},f.probe=function(E){if(!E)return!1;for(var c=(k.getID3Data(E,0)||[]).length,t=E.length;c<t;c++)if(y.probe(E,c))return L.logger.log("ADTS sync word found !"),!0;return!1},T.canParse=function(E,c){return y.canParse(E,c)},T.appendFrame=function(E,c,t){y.initTrackConfig(E,this.observer,c,t,E.manifestCodec);var a=y.appendFrame(E,c,t,this.initPTS,this.frameIndex);if(a&&a.missing===0)return a},f}(A.default);D.minProbeByteLength=9,R.default=D},"./src/demux/adts.ts":function(F,R,d){d.r(R),d.d(R,"getAudioConfig",function(){return k}),d.d(R,"isHeaderPattern",function(){return w}),d.d(R,"getHeaderLength",function(){return D}),d.d(R,"getFullFrameLength",function(){return o}),d.d(R,"canGetFrameLength",function(){return S}),d.d(R,"isHeader",function(){return m}),d.d(R,"canParse",function(){return f}),d.d(R,"probe",function(){return T}),d.d(R,"initTrackConfig",function(){return E}),d.d(R,"getFrameDuration",function(){return c}),d.d(R,"parseFrameHeader",function(){return t}),d.d(R,"appendFrame",function(){return a});var A=d("./src/utils/logger.ts"),y=d("./src/errors.ts"),L=d("./src/events.ts");function k(e,l,u,i){var s,v,g,p,r=navigator.userAgent.toLowerCase(),n=i,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];s=1+((192&l[u+2])>>>6);var b=(60&l[u+2])>>>2;if(!(b>h.length-1))return g=(1&l[u+2])<<2,g|=(192&l[u+3])>>>6,A.logger.log("manifest codec:"+i+", ADTS type:"+s+", samplingIndex:"+b),/firefox/i.test(r)?b>=6?(s=5,p=new Array(4),v=b-3):(s=2,p=new Array(2),v=b):r.indexOf("android")!==-1?(s=2,p=new Array(2),v=b):(s=5,p=new Array(4),i&&(i.indexOf("mp4a.40.29")!==-1||i.indexOf("mp4a.40.5")!==-1)||!i&&b>=6?v=b-3:((i&&i.indexOf("mp4a.40.2")!==-1&&(b>=6&&g===1||/vivaldi/i.test(r))||!i&&g===1)&&(s=2,p=new Array(2)),v=b)),p[0]=s<<3,p[0]|=(14&b)>>1,p[1]|=(1&b)<<7,p[1]|=g<<3,s===5&&(p[1]|=(14&v)>>1,p[2]=(1&v)<<7,p[2]|=8,p[3]=0),{config:p,samplerate:h[b],channelCount:g,codec:"mp4a.40."+s,manifestCodec:n};e.trigger(L.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+b})}function w(e,l){return e[l]===255&&(246&e[l+1])==240}function D(e,l){return 1&e[l+1]?7:9}function o(e,l){return(3&e[l+3])<<11|e[l+4]<<3|(224&e[l+5])>>>5}function S(e,l){return l+5<e.length}function m(e,l){return l+1<e.length&&w(e,l)}function f(e,l){return S(e,l)&&w(e,l)&&o(e,l)<=e.length-l}function T(e,l){if(m(e,l)){var u=D(e,l);if(l+u>=e.length)return!1;var i=o(e,l);if(i<=u)return!1;var s=l+i;return s===e.length||m(e,s)}return!1}function E(e,l,u,i,s){if(!e.samplerate){var v=k(l,u,i,s);if(!v)return;e.config=v.config,e.samplerate=v.samplerate,e.channelCount=v.channelCount,e.codec=v.codec,e.manifestCodec=v.manifestCodec,A.logger.log("parsed codec:"+e.codec+", rate:"+v.samplerate+", channels:"+v.channelCount)}}function c(e){return 9216e4/e}function t(e,l,u,i,s){var v=D(e,l),g=o(e,l);if((g-=v)>0)return{headerLength:v,frameLength:g,stamp:u+i*s}}function a(e,l,u,i,s){var v=t(l,u,i,s,c(e.samplerate));if(v){var g,p=v.frameLength,r=v.headerLength,n=v.stamp,h=r+p,b=Math.max(0,u+h-l.length);b?(g=new Uint8Array(h-r)).set(l.subarray(u+r,l.length),0):g=l.subarray(u+r,u+h);var _={unit:g,pts:n};return b||e.samples.push(_),{sample:_,length:h,missing:b}}}},"./src/demux/base-audio-demuxer.ts":function(F,R,d){d.r(R),d.d(R,"initPTSFn",function(){return o});var A=d("./src/polyfills/number.ts"),y=d("./src/demux/id3.ts"),L=d("./src/demux/dummy-demuxed-track.ts"),k=d("./src/utils/mp4-tools.ts"),w=d("./src/utils/typed-array.ts"),D=function(){function S(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var m=S.prototype;return m.resetInitSegment=function(f,T,E){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},m.resetTimeStamp=function(){},m.resetContiguity=function(){},m.canParse=function(f,T){return!1},m.appendFrame=function(f,T,E){},m.demux=function(f,T){this.cachedData&&(f=Object(k.appendUint8Array)(this.cachedData,f),this.cachedData=null);var E,c,t=y.getID3Data(f,0),a=t?t.length:0,e=this._audioTrack,l=this._id3Track,u=t?y.getTimeStamp(t):void 0,i=f.length;for(this.frameIndex!==0&&this.initPTS!==null||(this.initPTS=o(u,T)),t&&t.length>0&&l.samples.push({pts:this.initPTS,dts:this.initPTS,data:t}),c=this.initPTS;a<i;){if(this.canParse(f,a)){var s=this.appendFrame(e,f,a);s?(this.frameIndex++,c=s.sample.pts,E=a+=s.length):a=i}else y.canParse(f,a)?(t=y.getID3Data(f,a),l.samples.push({pts:c,dts:c,data:t}),E=a+=t.length):a++;if(a===i&&E!==i){var v=Object(w.sliceUint8)(f,E);this.cachedData?this.cachedData=Object(k.appendUint8Array)(this.cachedData,v):this.cachedData=v}}return{audioTrack:e,avcTrack:Object(L.dummyTrack)(),id3Track:l,textTrack:Object(L.dummyTrack)()}},m.demuxSampleAes=function(f,T,E){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},m.flush=function(f){var T=this.cachedData;return T&&(this.cachedData=null,this.demux(T,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(L.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(L.dummyTrack)()}},m.destroy=function(){},S}(),o=function(S,m){return Object(A.isFiniteNumber)(S)?90*S:9e4*m};R.default=D},"./src/demux/chunk-cache.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return A});var A=function(){function y(){this.chunks=[],this.dataLength=0}var L=y.prototype;return L.push=function(k){this.chunks.push(k),this.dataLength+=k.length},L.flush=function(){var k,w=this.chunks,D=this.dataLength;return w.length?(k=w.length===1?w[0]:function(o,S){for(var m=new Uint8Array(S),f=0,T=0;T<o.length;T++){var E=o[T];m.set(E,f),f+=E.length}return m}(w,D),this.reset(),k):new Uint8Array(0)},L.reset=function(){this.chunks.length=0,this.dataLength=0},y}()},"./src/demux/dummy-demuxed-track.ts":function(F,R,d){function A(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}d.r(R),d.d(R,"dummyTrack",function(){return A})},"./src/demux/exp-golomb.ts":function(F,R,d){d.r(R);var A=d("./src/utils/logger.ts"),y=function(){function L(w){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=w,this.bytesAvailable=w.byteLength,this.word=0,this.bitsAvailable=0}var k=L.prototype;return k.loadWord=function(){var w=this.data,D=this.bytesAvailable,o=w.byteLength-D,S=new Uint8Array(4),m=Math.min(4,D);if(m===0)throw new Error("no bytes available");S.set(w.subarray(o,o+m)),this.word=new DataView(S.buffer).getUint32(0),this.bitsAvailable=8*m,this.bytesAvailable-=m},k.skipBits=function(w){var D;this.bitsAvailable>w?(this.word<<=w,this.bitsAvailable-=w):(w-=this.bitsAvailable,w-=(D=w>>3)>>3,this.bytesAvailable-=D,this.loadWord(),this.word<<=w,this.bitsAvailable-=w)},k.readBits=function(w){var D=Math.min(this.bitsAvailable,w),o=this.word>>>32-D;return w>32&&A.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=D,this.bitsAvailable>0?this.word<<=D:this.bytesAvailable>0&&this.loadWord(),(D=w-D)>0&&this.bitsAvailable?o<<D|this.readBits(D):o},k.skipLZ=function(){var w;for(w=0;w<this.bitsAvailable;++w)if((this.word&2147483648>>>w)!=0)return this.word<<=w,this.bitsAvailable-=w,w;return this.loadWord(),w+this.skipLZ()},k.skipUEG=function(){this.skipBits(1+this.skipLZ())},k.skipEG=function(){this.skipBits(1+this.skipLZ())},k.readUEG=function(){var w=this.skipLZ();return this.readBits(w+1)-1},k.readEG=function(){var w=this.readUEG();return 1&w?1+w>>>1:-1*(w>>>1)},k.readBoolean=function(){return this.readBits(1)===1},k.readUByte=function(){return this.readBits(8)},k.readUShort=function(){return this.readBits(16)},k.readUInt=function(){return this.readBits(32)},k.skipScalingList=function(w){for(var D=8,o=8,S=0;S<w;S++)o!==0&&(o=(D+this.readEG()+256)%256),D=o===0?D:o},k.readSPS=function(){var w,D,o,S=0,m=0,f=0,T=0,E=this.readUByte.bind(this),c=this.readBits.bind(this),t=this.readUEG.bind(this),a=this.readBoolean.bind(this),e=this.skipBits.bind(this),l=this.skipEG.bind(this),u=this.skipUEG.bind(this),i=this.skipScalingList.bind(this);E();var s=E();if(c(5),e(3),E(),u(),s===100||s===110||s===122||s===244||s===44||s===83||s===86||s===118||s===128){var v=t();if(v===3&&e(1),u(),u(),e(1),a())for(D=v!==3?8:12,o=0;o<D;o++)a()&&i(o<6?16:64)}u();var g=t();if(g===0)t();else if(g===1)for(e(1),l(),l(),w=t(),o=0;o<w;o++)l();u(),e(1);var p=t(),r=t(),n=c(1);n===0&&e(1),e(1),a()&&(S=t(),m=t(),f=t(),T=t());var h=[1,1];if(a()&&a())switch(E()){case 1:h=[1,1];break;case 2:h=[12,11];break;case 3:h=[10,11];break;case 4:h=[16,11];break;case 5:h=[40,33];break;case 6:h=[24,11];break;case 7:h=[20,11];break;case 8:h=[32,11];break;case 9:h=[80,33];break;case 10:h=[18,11];break;case 11:h=[15,11];break;case 12:h=[64,33];break;case 13:h=[160,99];break;case 14:h=[4,3];break;case 15:h=[3,2];break;case 16:h=[2,1];break;case 255:h=[E()<<8|E(),E()<<8|E()]}return{width:Math.ceil(16*(p+1)-2*S-2*m),height:(2-n)*(r+1)*16-(n?2:4)*(f+T),pixelRatio:h}},k.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},L}();R.default=y},"./src/demux/id3.ts":function(F,R,d){d.r(R),d.d(R,"isHeader",function(){return y}),d.d(R,"isFooter",function(){return L}),d.d(R,"getID3Data",function(){return k}),d.d(R,"canParse",function(){return D}),d.d(R,"getTimeStamp",function(){return o}),d.d(R,"isTimeStampFrame",function(){return S}),d.d(R,"getID3Frames",function(){return f}),d.d(R,"decodeFrame",function(){return T}),d.d(R,"utf8ArrayToStr",function(){return e}),d.d(R,"testables",function(){return l});var A,y=function(u,i){return i+10<=u.length&&u[i]===73&&u[i+1]===68&&u[i+2]===51&&u[i+3]<255&&u[i+4]<255&&u[i+6]<128&&u[i+7]<128&&u[i+8]<128&&u[i+9]<128},L=function(u,i){return i+10<=u.length&&u[i]===51&&u[i+1]===68&&u[i+2]===73&&u[i+3]<255&&u[i+4]<255&&u[i+6]<128&&u[i+7]<128&&u[i+8]<128&&u[i+9]<128},k=function(u,i){for(var s=i,v=0;y(u,i);)v+=10,v+=w(u,i+6),L(u,i+10)&&(v+=10),i+=v;if(v>0)return u.subarray(s,s+v)},w=function(u,i){var s=0;return s=(127&u[i])<<21,s|=(127&u[i+1])<<14,s|=(127&u[i+2])<<7,s|=127&u[i+3]},D=function(u,i){return y(u,i)&&w(u,i+6)+10<=u.length-i},o=function(u){for(var i=f(u),s=0;s<i.length;s++){var v=i[s];if(S(v))return a(v)}},S=function(u){return u&&u.key==="PRIV"&&u.info==="com.apple.streaming.transportStreamTimestamp"},m=function(u){var i=String.fromCharCode(u[0],u[1],u[2],u[3]),s=w(u,4);return{type:i,size:s,data:u.subarray(10,10+s)}},f=function(u){for(var i=0,s=[];y(u,i);){for(var v=w(u,i+6),g=(i+=10)+v;i+8<g;){var p=m(u.subarray(i)),r=T(p);r&&s.push(r),i+=p.size+10}L(u,i)&&(i+=10)}return s},T=function(u){return u.type==="PRIV"?E(u):u.type[0]==="W"?t(u):c(u)},E=function(u){if(!(u.size<2)){var i=e(u.data,!0),s=new Uint8Array(u.data.subarray(i.length+1));return{key:u.type,info:i,data:s.buffer}}},c=function(u){if(!(u.size<2)){if(u.type==="TXXX"){var i=1,s=e(u.data.subarray(i),!0);i+=s.length+1;var v=e(u.data.subarray(i));return{key:u.type,info:s,data:v}}var g=e(u.data.subarray(1));return{key:u.type,data:g}}},t=function(u){if(u.type==="WXXX"){if(u.size<2)return;var i=1,s=e(u.data.subarray(i),!0);i+=s.length+1;var v=e(u.data.subarray(i));return{key:u.type,info:s,data:v}}var g=e(u.data);return{key:u.type,data:g}},a=function(u){if(u.data.byteLength===8){var i=new Uint8Array(u.data),s=1&i[3],v=(i[4]<<23)+(i[5]<<15)+(i[6]<<7)+i[7];return v/=45,s&&(v+=4772185884e-2),Math.round(v)}},e=function(u,i){i===void 0&&(i=!1);var s=(A||self.TextDecoder===void 0||(A=new self.TextDecoder("utf-8")),A);if(s){var v=s.decode(u);if(i){var g=v.indexOf("\0");return g!==-1?v.substring(0,g):v}return v.replace(/\0/g,"")}for(var p,r,n,h=u.length,b="",_=0;_<h;){if((p=u[_++])===0&&i)return b;if(p!==0&&p!==3)switch(p>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(p);break;case 12:case 13:r=u[_++],b+=String.fromCharCode((31&p)<<6|63&r);break;case 14:r=u[_++],n=u[_++],b+=String.fromCharCode((15&p)<<12|(63&r)<<6|(63&n)<<0)}}return b},l={decodeTextFrame:c}},"./src/demux/mp3demuxer.ts":function(F,R,d){d.r(R);var A=d("./src/demux/base-audio-demuxer.ts"),y=d("./src/demux/id3.ts"),L=d("./src/utils/logger.ts"),k=d("./src/demux/mpegaudio.ts");function w(o,S){return(w=Object.setPrototypeOf||function(m,f){return m.__proto__=f,m})(o,S)}var D=function(o){var S,m;function f(){return o.apply(this,arguments)||this}m=o,(S=f).prototype=Object.create(m.prototype),S.prototype.constructor=S,w(S,m);var T=f.prototype;return T.resetInitSegment=function(E,c,t){o.prototype.resetInitSegment.call(this,E,c,t),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:E,duration:t,inputTimeScale:9e4,dropped:0}},f.probe=function(E){if(!E)return!1;for(var c=(y.getID3Data(E,0)||[]).length,t=E.length;c<t;c++)if(k.probe(E,c))return L.logger.log("MPEG Audio sync word found !"),!0;return!1},T.canParse=function(E,c){return k.canParse(E,c)},T.appendFrame=function(E,c,t){if(this.initPTS!==null)return k.appendFrame(E,c,t,this.initPTS,this.frameIndex)},f}(A.default);D.minProbeByteLength=4,R.default=D},"./src/demux/mp4demuxer.ts":function(F,R,d){d.r(R);var A=d("./src/utils/mp4-tools.ts"),y=d("./src/demux/dummy-demuxed-track.ts"),L=function(){function k(D,o){this.remainderData=null,this.config=void 0,this.config=o}var w=k.prototype;return w.resetTimeStamp=function(){},w.resetInitSegment=function(){},w.resetContiguity=function(){},k.probe=function(D){return Object(A.findBox)({data:D,start:0,end:Math.min(D.length,16384)},["moof"]).length>0},w.demux=function(D){var o=D,S=Object(y.dummyTrack)();if(this.config.progressive){this.remainderData&&(o=Object(A.appendUint8Array)(this.remainderData,D));var m=Object(A.segmentValidRange)(o);this.remainderData=m.remainder,S.samples=m.valid||new Uint8Array}else S.samples=o;return{audioTrack:Object(y.dummyTrack)(),avcTrack:S,id3Track:Object(y.dummyTrack)(),textTrack:Object(y.dummyTrack)()}},w.flush=function(){var D=Object(y.dummyTrack)();return D.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(y.dummyTrack)(),avcTrack:D,id3Track:Object(y.dummyTrack)(),textTrack:Object(y.dummyTrack)()}},w.demuxSampleAes=function(D,o,S){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},w.destroy=function(){},k}();L.minProbeByteLength=1024,R.default=L},"./src/demux/mpegaudio.ts":function(F,R,d){d.r(R),d.d(R,"appendFrame",function(){return D}),d.d(R,"parseHeader",function(){return o}),d.d(R,"isHeaderPattern",function(){return S}),d.d(R,"isHeader",function(){return m}),d.d(R,"canParse",function(){return f}),d.d(R,"probe",function(){return T});var A=null,y=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],L=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],k=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],w=[0,1,1,4];function D(E,c,t,a,e){if(!(t+24>c.length)){var l=o(c,t);if(l&&t+l.frameLength<=c.length){var u=a+e*(9e4*l.samplesPerFrame/l.sampleRate),i={unit:c.subarray(t,t+l.frameLength),pts:u,dts:u};return E.config=[],E.channelCount=l.channelCount,E.samplerate=l.sampleRate,E.samples.push(i),{sample:i,length:l.frameLength,missing:0}}}}function o(E,c){var t=E[c+1]>>3&3,a=E[c+1]>>1&3,e=E[c+2]>>4&15,l=E[c+2]>>2&3;if(t!==1&&e!==0&&e!==15&&l!==3){var u=E[c+2]>>1&1,i=E[c+3]>>6,s=1e3*y[14*(t===3?3-a:a===3?3:4)+e-1],v=L[3*(t===3?0:t===2?1:2)+l],g=i===3?1:2,p=k[t][a],r=w[a],n=8*p*r,h=Math.floor(p*s/v+u)*r;if(A===null){var b=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);A=b?parseInt(b[1]):0}return!!A&&A<=87&&a===2&&s>=224e3&&i===0&&(E[c+3]=128|E[c+3]),{sampleRate:v,channelCount:g,frameLength:h,samplesPerFrame:n}}}function S(E,c){return E[c]===255&&(224&E[c+1])==224&&(6&E[c+1])!=0}function m(E,c){return c+1<E.length&&S(E,c)}function f(E,c){return S(E,c)&&4<=E.length-c}function T(E,c){if(c+1<E.length&&S(E,c)){var t=o(E,c),a=4;t!=null&&t.frameLength&&(a=t.frameLength);var e=c+a;return e===E.length||m(E,e)}return!1}},"./src/demux/sample-aes.ts":function(F,R,d){d.r(R);var A=d("./src/crypt/decrypter.ts"),y=d("./src/demux/tsdemuxer.ts"),L=function(){function k(D,o,S){this.keyData=void 0,this.decrypter=void 0,this.keyData=S,this.decrypter=new A.default(D,o,{removePKCS7Padding:!1})}var w=k.prototype;return w.decryptBuffer=function(D,o){this.decrypter.decrypt(D,this.keyData.key.buffer,this.keyData.iv.buffer,o)},w.decryptAacSample=function(D,o,S,m){var f=D[o].unit,T=f.subarray(16,f.length-f.length%16),E=T.buffer.slice(T.byteOffset,T.byteOffset+T.length),c=this;this.decryptBuffer(E,function(t){var a=new Uint8Array(t);f.set(a,16),m||c.decryptAacSamples(D,o+1,S)})},w.decryptAacSamples=function(D,o,S){for(;;o++){if(o>=D.length)return void S();if(!(D[o].unit.length<32)){var m=this.decrypter.isSync();if(this.decryptAacSample(D,o,S,m),!m)return}}},w.getAvcEncryptedData=function(D){for(var o=16*Math.floor((D.length-48)/160)+16,S=new Int8Array(o),m=0,f=32;f<=D.length-16;f+=160,m+=16)S.set(D.subarray(f,f+16),m);return S},w.getAvcDecryptedUnit=function(D,o){for(var S=new Uint8Array(o),m=0,f=32;f<=D.length-16;f+=160,m+=16)D.set(S.subarray(m,m+16),f);return D},w.decryptAvcSample=function(D,o,S,m,f,T){var E=Object(y.discardEPB)(f.data),c=this.getAvcEncryptedData(E),t=this;this.decryptBuffer(c.buffer,function(a){f.data=t.getAvcDecryptedUnit(E,a),T||t.decryptAvcSamples(D,o,S+1,m)})},w.decryptAvcSamples=function(D,o,S,m){if(D instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;o++,S=0){if(o>=D.length)return void m();for(var f=D[o].units;!(S>=f.length);S++){var T=f[S];if(!(T.data.length<=48||T.type!==1&&T.type!==5)){var E=this.decrypter.isSync();if(this.decryptAvcSample(D,o,S,m,T,E),!E)return}}}},k}();R.default=L},"./src/demux/transmuxer-interface.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return m});var A=d("./node_modules/webworkify-webpack/index.js"),y=d("./src/events.ts"),L=d("./src/demux/transmuxer.ts"),k=d("./src/utils/logger.ts"),w=d("./src/errors.ts"),D=d("./src/utils/mediasource-helper.ts"),o=d("./node_modules/eventemitter3/index.js"),S=Object(D.getMediaSource)()||{isTypeSupported:function(){return!1}},m=function(){function f(E,c,t,a){var e=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=E,this.id=c,this.onTransmuxComplete=t,this.onFlush=a;var l=E.config,u=function(g,p){(p=p||{}).frag=e.frag,p.id=e.id,E.trigger(g,p)};this.observer=new o.EventEmitter,this.observer.on(y.Events.FRAG_DECRYPTED,u),this.observer.on(y.Events.ERROR,u);var i={mp4:S.isTypeSupported("video/mp4"),mpeg:S.isTypeSupported("audio/mpeg"),mp3:S.isTypeSupported('audio/mp4; codecs="mp3"')},s=navigator.vendor;if(l.enableWorker&&typeof Worker<"u"){var v;k.logger.log("demuxing in webworker");try{v=this.worker=A("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),v.addEventListener("message",this.onwmsg),v.onerror=function(g){E.trigger(y.Events.ERROR,{type:w.ErrorTypes.OTHER_ERROR,details:w.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(g.message+"  ("+g.filename+":"+g.lineno+")")})},v.postMessage({cmd:"init",typeSupported:i,vendor:s,id:c,config:JSON.stringify(l)})}catch(g){k.logger.warn("Error in worker:",g),k.logger.error("Error while initializing DemuxerWorker, fallback to inline"),v&&self.URL.revokeObjectURL(v.objectURL),this.transmuxer=new L.default(this.observer,i,l,s,c),this.worker=null}}else this.transmuxer=new L.default(this.observer,i,l,s,c)}var T=f.prototype;return T.destroy=function(){var E=this.worker;if(E)E.removeEventListener("message",this.onwmsg),E.terminate(),this.worker=null;else{var c=this.transmuxer;c&&(c.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.observer=null},T.push=function(E,c,t,a,e,l,u,i,s,v){var g=this;s.transmuxing.start=self.performance.now();var p=this.transmuxer,r=this.worker,n=l?l.start:e.start,h=e.decryptdata,b=this.frag,_=!(b&&e.cc===b.cc),I=!(b&&s.level===b.level),O=b?s.sn-b.sn:-1,C=this.part?s.part-this.part.index:1,x=!I&&(O===1||O===0&&C===1),P=self.performance.now();(I||O||e.stats.parsing.start===0)&&(e.stats.parsing.start=P),!l||!C&&x||(l.stats.parsing.start=P);var N=new L.TransmuxState(_,x,i,I,n);if(!x||_){k.logger.log("[transmuxer-interface, "+e.type+"]: Starting new transmux session for sn: "+s.sn+" p: "+s.part+" level: "+s.level+" id: "+s.id+`
        discontinuity: `+_+`
        trackSwitch: `+I+`
        contiguous: `+x+`
        accurateTimeOffset: `+i+`
        timeOffset: `+n);var M=new L.TransmuxConfig(t,a,c,u,v);this.configureTransmuxer(M)}if(this.frag=e,this.part=l,r)r.postMessage({cmd:"demux",data:E,decryptdata:h,chunkMeta:s,state:N},E instanceof ArrayBuffer?[E]:[]);else if(p){var B=p.push(E,h,s,N);Object(L.isPromise)(B)?B.then(function(G){g.handleTransmuxComplete(G)}):this.handleTransmuxComplete(B)}},T.flush=function(E){var c=this;E.transmuxing.start=self.performance.now();var t=this.transmuxer,a=this.worker;if(a)a.postMessage({cmd:"flush",chunkMeta:E});else if(t){var e=t.flush(E);Object(L.isPromise)(e)?e.then(function(l){c.handleFlushResult(l,E)}):this.handleFlushResult(e,E)}},T.handleFlushResult=function(E,c){var t=this;E.forEach(function(a){t.handleTransmuxComplete(a)}),this.onFlush(c)},T.onWorkerMessage=function(E){var c=E.data,t=this.hls;switch(c.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(c.data);break;case"flush":this.onFlush(c.data);break;default:c.data=c.data||{},c.data.frag=this.frag,c.data.id=this.id,t.trigger(c.event,c.data)}},T.configureTransmuxer=function(E){var c=this.worker,t=this.transmuxer;c?c.postMessage({cmd:"configure",config:E}):t&&t.configure(E)},T.handleTransmuxComplete=function(E){E.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(E)},f}()},"./src/demux/transmuxer-worker.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return w});var A=d("./src/demux/transmuxer.ts"),y=d("./src/events.ts"),L=d("./src/utils/logger.ts"),k=d("./node_modules/eventemitter3/index.js");function w(m){var f=new k.EventEmitter,T=function(E,c){m.postMessage({event:E,data:c})};f.on(y.Events.FRAG_DECRYPTED,T),f.on(y.Events.ERROR,T),m.addEventListener("message",function(E){var c=E.data;switch(c.cmd){case"init":var t=JSON.parse(c.config);m.transmuxer=new A.default(f,c.typeSupported,t,c.vendor,c.id),Object(L.enableLogs)(t.debug),T("init",null);break;case"configure":m.transmuxer.configure(c.config);break;case"demux":var a=m.transmuxer.push(c.data,c.decryptdata,c.chunkMeta,c.state);Object(A.isPromise)(a)?a.then(function(u){D(m,u)}):D(m,a);break;case"flush":var e=c.chunkMeta,l=m.transmuxer.flush(e);Object(A.isPromise)(l)?l.then(function(u){S(m,u,e)}):S(m,l,e)}})}function D(m,f){if((T=f.remuxResult).audio||T.video||T.text||T.id3||T.initSegment){var T,E=[],c=f.remuxResult,t=c.audio,a=c.video;t&&o(E,t),a&&o(E,a),m.postMessage({event:"transmuxComplete",data:f},E)}}function o(m,f){f.data1&&m.push(f.data1.buffer),f.data2&&m.push(f.data2.buffer)}function S(m,f,T){f.forEach(function(E){D(m,E)}),m.postMessage({event:"flush",data:T})}},"./src/demux/transmuxer.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return e}),d.d(R,"isPromise",function(){return u}),d.d(R,"TransmuxConfig",function(){return i}),d.d(R,"TransmuxState",function(){return s});var A,y=d("./src/events.ts"),L=d("./src/errors.ts"),k=d("./src/crypt/decrypter.ts"),w=d("./src/demux/aacdemuxer.ts"),D=d("./src/demux/mp4demuxer.ts"),o=d("./src/demux/tsdemuxer.ts"),S=d("./src/demux/mp3demuxer.ts"),m=d("./src/remux/mp4-remuxer.ts"),f=d("./src/remux/passthrough-remuxer.ts"),T=d("./src/demux/chunk-cache.ts"),E=d("./src/utils/mp4-tools.ts"),c=d("./src/utils/logger.ts");try{A=self.performance.now.bind(self.performance)}catch{c.logger.debug("Unable to use Performance API on this environment"),A=self.Date.now}var t=[{demux:o.default,remux:m.default},{demux:D.default,remux:f.default},{demux:w.default,remux:m.default},{demux:S.default,remux:m.default}],a=1024;t.forEach(function(v){var g=v.demux;a=Math.max(a,g.minProbeByteLength)});var e=function(){function v(p,r,n,h,b){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new T.default,this.observer=p,this.typeSupported=r,this.config=n,this.vendor=h,this.id=b}var g=v.prototype;return g.configure=function(p){this.transmuxConfig=p,this.decrypter&&this.decrypter.reset()},g.push=function(p,r,n,h){var b=this,_=n.transmuxing;_.executeStart=A();var I=new Uint8Array(p),O=this.cache,C=this.config,x=this.currentTransmuxState,P=this.transmuxConfig;h&&(this.currentTransmuxState=h);var N=function(ot,at){var gt=null;return ot.byteLength>0&&at!=null&&at.key!=null&&at.iv!==null&&at.method!=null&&(gt=at),gt}(I,r);if(N&&N.method==="AES-128"){var M=this.getDecrypter();if(!C.enableSoftwareAES)return this.decryptionPromise=M.webCryptoDecrypt(I,N.key.buffer,N.iv.buffer).then(function(ot){var at=b.push(ot,null,n);return b.decryptionPromise=null,at}),this.decryptionPromise;var B=M.softwareDecrypt(I,N.key.buffer,N.iv.buffer);if(!B)return _.executeEnd=A(),l(n);I=new Uint8Array(B)}var G=h||x,K=G.contiguous,V=G.discontinuity,H=G.trackSwitch,W=G.accurateTimeOffset,Y=G.timeOffset,X=P.audioCodec,tt=P.videoCodec,et=P.defaultInitPts,nt=P.duration,J=P.initSegmentData;if((V||H)&&this.resetInitSegment(J,X,tt,nt),V&&this.resetInitialTimestamp(et),K||this.resetContiguity(),this.needsProbing(I,V,H)){if(O.dataLength){var st=O.flush();I=Object(E.appendUint8Array)(st,I)}this.configureTransmuxer(I,P)}var Z=this.transmux(I,N,Y,W,n),rt=this.currentTransmuxState;return rt.contiguous=!0,rt.discontinuity=!1,rt.trackSwitch=!1,_.executeEnd=A(),Z},g.flush=function(p){var r=this,n=p.transmuxing;n.executeStart=A();var h=this.decrypter,b=this.cache,_=this.currentTransmuxState,I=this.decryptionPromise;if(I)return I.then(function(){return r.flush(p)});var O=[],C=_.timeOffset;if(h){var x=h.flush();x&&O.push(this.push(x,null,p))}var P=b.dataLength;b.reset();var N=this.demuxer,M=this.remuxer;if(!N||!M)return P>=a&&this.observer.emit(y.Events.ERROR,y.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),n.executeEnd=A(),[l(p)];var B=N.flush(C);return u(B)?B.then(function(G){return r.flushRemux(O,G,p),O}):(this.flushRemux(O,B,p),O)},g.flushRemux=function(p,r,n){var h=r.audioTrack,b=r.avcTrack,_=r.id3Track,I=r.textTrack,O=this.currentTransmuxState,C=O.accurateTimeOffset,x=O.timeOffset;c.logger.log("[transmuxer.ts]: Flushed fragment "+n.sn+(n.part>-1?" p: "+n.part:"")+" of level "+n.level);var P=this.remuxer.remux(h,b,_,I,x,C,!0,this.id);p.push({remuxResult:P,chunkMeta:n}),n.transmuxing.executeEnd=A()},g.resetInitialTimestamp=function(p){var r=this.demuxer,n=this.remuxer;r&&n&&(r.resetTimeStamp(p),n.resetTimeStamp(p))},g.resetContiguity=function(){var p=this.demuxer,r=this.remuxer;p&&r&&(p.resetContiguity(),r.resetNextTimestamp())},g.resetInitSegment=function(p,r,n,h){var b=this.demuxer,_=this.remuxer;b&&_&&(b.resetInitSegment(r,n,h),_.resetInitSegment(p,r,n))},g.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},g.transmux=function(p,r,n,h,b){return r&&r.method==="SAMPLE-AES"?this.transmuxSampleAes(p,r,n,h,b):this.transmuxUnencrypted(p,n,h,b)},g.transmuxUnencrypted=function(p,r,n,h){var b=this.demuxer.demux(p,r,!1,!this.config.progressive),_=b.audioTrack,I=b.avcTrack,O=b.id3Track,C=b.textTrack;return{remuxResult:this.remuxer.remux(_,I,O,C,r,n,!1,this.id),chunkMeta:h}},g.transmuxSampleAes=function(p,r,n,h,b){var _=this;return this.demuxer.demuxSampleAes(p,r,n).then(function(I){return{remuxResult:_.remuxer.remux(I.audioTrack,I.avcTrack,I.id3Track,I.textTrack,n,h,!1,_.id),chunkMeta:b}})},g.configureTransmuxer=function(p,r){for(var n,h=this.config,b=this.observer,_=this.typeSupported,I=this.vendor,O=r.audioCodec,C=r.defaultInitPts,x=r.duration,P=r.initSegmentData,N=r.videoCodec,M=0,B=t.length;M<B;M++)if(t[M].demux.probe(p)){n=t[M];break}n||(c.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),n={demux:D.default,remux:f.default});var G=this.demuxer,K=this.remuxer,V=n.remux,H=n.demux;K&&K instanceof V||(this.remuxer=new V(b,h,_,I)),G&&G instanceof H||(this.demuxer=new H(b,h,_),this.probe=H.probe),this.resetInitSegment(P,O,N,x),this.resetInitialTimestamp(C)},g.needsProbing=function(p,r,n){return!this.demuxer||!this.remuxer||r||n},g.getDecrypter=function(){var p=this.decrypter;return p||(p=this.decrypter=new k.default(this.observer,this.config)),p},v}(),l=function(v){return{remuxResult:{},chunkMeta:v}};function u(v){return"then"in v&&v.then instanceof Function}var i=function(v,g,p,r,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=v,this.videoCodec=g,this.initSegmentData=p,this.duration=r,this.defaultInitPts=n},s=function(v,g,p,r,n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=v,this.contiguous=g,this.accurateTimeOffset=p,this.trackSwitch=r,this.timeOffset=n}},"./src/demux/tsdemuxer.ts":function(F,R,d){d.r(R),d.d(R,"discardEPB",function(){return u});var A=d("./src/demux/adts.ts"),y=d("./src/demux/mpegaudio.ts"),L=d("./src/demux/exp-golomb.ts"),k=d("./src/demux/id3.ts"),w=d("./src/demux/sample-aes.ts"),D=d("./src/events.ts"),o=d("./src/utils/mp4-tools.ts"),S=d("./src/utils/logger.ts"),m=d("./src/errors.ts"),f={video:1,audio:2,id3:3,text:4},T=function(){function i(v,g,p){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=v,this.config=g,this.typeSupported=p}i.probe=function(v){var g=i.syncOffset(v);return!(g<0||(g&&S.logger.warn("MPEG2-TS detected but first sync word found @ offset "+g+", junk ahead ?"),0))},i.syncOffset=function(v){for(var g=Math.min(1e3,v.length-564),p=0;p<g;){if(v[p]===71&&v[p+188]===71&&v[p+376]===71)return p;p++}return-1},i.createTrack=function(v,g){return{container:v==="video"||v==="audio"?"video/mp2t":void 0,type:v,id:f[v],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:v==="audio"?g:void 0}};var s=i.prototype;return s.resetInitSegment=function(v,g,p){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=i.createTrack("video",p),this._audioTrack=i.createTrack("audio",p),this._id3Track=i.createTrack("id3",p),this._txtTrack=i.createTrack("text",p),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=v,this.videoCodec=g,this._duration=p},s.resetTimeStamp=function(){},s.resetContiguity=function(){var v=this._audioTrack,g=this._avcTrack,p=this._id3Track;v&&(v.pesData=null),g&&(g.pesData=null),p&&(p.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},s.demux=function(v,g,p,r){var n;p===void 0&&(p=!1),r===void 0&&(r=!1),p||(this.sampleAes=null);var h=this._avcTrack,b=this._audioTrack,_=this._id3Track,I=h.pid,O=h.pesData,C=b.pid,x=_.pid,P=b.pesData,N=_.pesData,M=!1,B=this.pmtParsed,G=this._pmtId,K=v.length;if(this.remainderData&&(K=(v=Object(o.appendUint8Array)(this.remainderData,v)).length,this.remainderData=null),K<188&&!r)return this.remainderData=v,{audioTrack:b,avcTrack:h,id3Track:_,textTrack:this._txtTrack};var V=Math.max(0,i.syncOffset(v));(K-=(K+V)%188)<v.byteLength&&!r&&(this.remainderData=new Uint8Array(v.buffer,K,v.buffer.byteLength-K));for(var H=V;H<K;H+=188)if(v[H]===71){var W=!!(64&v[H+1]),Y=((31&v[H+1])<<8)+v[H+2],X=void 0;if((48&v[H+3])>>4>1){if((X=H+5+v[H+4])===H+188)continue}else X=H+4;switch(Y){case I:W&&(O&&(n=a(O))&&this.parseAVCPES(n,!1),O={data:[],size:0}),O&&(O.data.push(v.subarray(X,H+188)),O.size+=H+188-X);break;case C:W&&(P&&(n=a(P))&&(b.isAAC?this.parseAACPES(n):this.parseMPEGPES(n)),P={data:[],size:0}),P&&(P.data.push(v.subarray(X,H+188)),P.size+=H+188-X);break;case x:W&&(N&&(n=a(N))&&this.parseID3PES(n),N={data:[],size:0}),N&&(N.data.push(v.subarray(X,H+188)),N.size+=H+188-X);break;case 0:W&&(X+=v[X]+1),G=this._pmtId=c(v,X);break;case G:W&&(X+=v[X]+1);var tt=t(v,X,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,p);(I=tt.avc)>0&&(h.pid=I),(C=tt.audio)>0&&(b.pid=C,b.isAAC=tt.isAAC),(x=tt.id3)>0&&(_.pid=x),M&&!B&&(S.logger.log("reparse from beginning"),M=!1,H=V-188),B=this.pmtParsed=!0;break;case 17:case 8191:break;default:M=!0}}else this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});h.pesData=O,b.pesData=P,_.pesData=N;var et={audioTrack:b,avcTrack:h,id3Track:_,textTrack:this._txtTrack};return r&&this.extractRemainingSamples(et),et},s.flush=function(){var v,g=this.remainderData;return this.remainderData=null,v=g?this.demux(g,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(v),this.sampleAes?this.decrypt(v,this.sampleAes):v},s.extractRemainingSamples=function(v){var g,p=v.audioTrack,r=v.avcTrack,n=v.id3Track,h=r.pesData,b=p.pesData,_=n.pesData;h&&(g=a(h))?(this.parseAVCPES(g,!0),r.pesData=null):r.pesData=h,b&&(g=a(b))?(p.isAAC?this.parseAACPES(g):this.parseMPEGPES(g),p.pesData=null):(b!=null&&b.size&&S.logger.log("last AAC PES packet truncated,might overlap between fragments"),p.pesData=b),_&&(g=a(_))?(this.parseID3PES(g),n.pesData=null):n.pesData=_},s.demuxSampleAes=function(v,g,p){var r=this.demux(v,p,!0,!this.config.progressive),n=this.sampleAes=new w.default(this.observer,this.config,g);return this.decrypt(r,n)},s.decrypt=function(v,g){return new Promise(function(p){var r=v.audioTrack,n=v.avcTrack;r.samples&&r.isAAC?g.decryptAacSamples(r.samples,0,function(){n.samples?g.decryptAvcSamples(n.samples,0,0,function(){p(v)}):p(v)}):n.samples&&g.decryptAvcSamples(n.samples,0,0,function(){p(v)})})},s.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},s.parseAVCPES=function(v,g){var p,r=this,n=this._avcTrack,h=this.parseAVCNALu(v.data),b=this.avcSample,_=!1;v.data=null,b&&h.length&&!n.audFound&&(e(b,n),b=this.avcSample=E(!1,v.pts,v.dts,"")),h.forEach(function(I){switch(I.type){case 1:p=!0,b||(b=r.avcSample=E(!0,v.pts,v.dts,"")),b.frame=!0;var O=I.data;if(_&&O.length>4){var C=new L.default(O).readSliceType();C!==2&&C!==4&&C!==7&&C!==9||(b.key=!0)}break;case 5:p=!0,b||(b=r.avcSample=E(!0,v.pts,v.dts,"")),b.key=!0,b.frame=!0;break;case 6:p=!0;var x=new L.default(u(I.data));x.readUByte();for(var P=0,N=0,M=!1,B=0;!M&&x.bytesAvailable>1;){P=0;do P+=B=x.readUByte();while(B===255);N=0;do N+=B=x.readUByte();while(B===255);if(P===4&&x.bytesAvailable!==0){if(M=!0,x.readUByte()===181&&x.readUShort()===49&&x.readUInt()===1195456820&&x.readUByte()===3){for(var G=x.readUByte(),K=31&G,V=[G,x.readUByte()],H=0;H<K;H++)V.push(x.readUByte()),V.push(x.readUByte()),V.push(x.readUByte());l(r._txtTrack.samples,{type:3,pts:v.pts,bytes:V})}}else if(P===5&&x.bytesAvailable!==0){if(M=!0,N>16){for(var W=[],Y=0;Y<16;Y++)W.push(x.readUByte().toString(16)),Y!==3&&Y!==5&&Y!==7&&Y!==9||W.push("-");for(var X=N-16,tt=new Uint8Array(X),et=0;et<X;et++)tt[et]=x.readUByte();l(r._txtTrack.samples,{pts:v.pts,payloadType:P,uuid:W.join(""),userData:Object(k.utf8ArrayToStr)(tt),userDataBytes:tt})}}else if(N<x.bytesAvailable)for(var nt=0;nt<N;nt++)x.readUByte()}break;case 7:if(p=!0,_=!0,!n.sps){var J=new L.default(I.data).readSPS();n.width=J.width,n.height=J.height,n.pixelRatio=J.pixelRatio,n.sps=[I.data],n.duration=r._duration;for(var st=I.data.subarray(1,4),Z="avc1.",rt=0;rt<3;rt++){var ot=st[rt].toString(16);ot.length<2&&(ot="0"+ot),Z+=ot}n.codec=Z}break;case 8:p=!0,n.pps||(n.pps=[I.data]);break;case 9:p=!1,n.audFound=!0,b&&e(b,n),b=r.avcSample=E(!1,v.pts,v.dts,"");break;case 12:p=!1;break;default:p=!1,b&&(b.debug+="unknown NAL "+I.type+" ")}b&&p&&b.units.push(I)}),g&&b&&(e(b,n),this.avcSample=null)},s.getLastNalUnit=function(){var v,g,p=this.avcSample;if(!p||p.units.length===0){var r=this._avcTrack.samples;p=r[r.length-1]}if((v=p)!==null&&v!==void 0&&v.units){var n=p.units;g=n[n.length-1]}return g},s.parseAVCNALu=function(v){var g,p,r=v.byteLength,n=this._avcTrack,h=n.naluState||0,b=h,_=[],I=0,O=-1,C=0;for(h===-1&&(O=0,C=31&v[0],h=0,I=1);I<r;)if(g=v[I++],h)if(h!==1)if(g)if(g===1){if(O>=0){var x={data:v.subarray(O,I-h-1),type:C};_.push(x)}else{var P=this.getLastNalUnit();if(P&&(b&&I<=4-b&&P.state&&(P.data=P.data.subarray(0,P.data.byteLength-b)),(p=I-h-1)>0)){var N=new Uint8Array(P.data.byteLength+p);N.set(P.data,0),N.set(v.subarray(0,p),P.data.byteLength),P.data=N}}I<r?(O=I,C=31&v[I],h=0):h=-1}else h=0;else h=3;else h=g?0:2;else h=g?0:1;if(O>=0&&h>=0){var M={data:v.subarray(O,r),type:C,state:h};_.push(M)}if(_.length===0){var B=this.getLastNalUnit();if(B){var G=new Uint8Array(B.data.byteLength+v.byteLength);G.set(B.data,0),G.set(v,B.data.byteLength),B.data=G}}return n.naluState=h,_},s.parseAACPES=function(v){var g,p,r,n,h,b=0,_=this._audioTrack,I=this.aacOverFlow,O=v.data;if(I){this.aacOverFlow=null;var C=I.sample.unit.byteLength,x=Math.min(I.missing,C),P=C-x;I.sample.unit.set(O.subarray(0,x),P),_.samples.push(I.sample),b=I.missing}for(g=b,p=O.length;g<p-1&&!A.isHeader(O,g);g++);if(g===b||(g<p-1?(r="AAC PES did not start with ADTS header,offset:"+g,n=!1):(r="no ADTS header found in AAC PES",n=!0),S.logger.warn("parsing error:"+r),this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:n,reason:r}),!n)){if(A.initTrackConfig(_,this.observer,O,g,this.audioCodec),v.pts!==void 0)h=v.pts;else{if(!I)return void S.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var N=A.getFrameDuration(_.samplerate);h=I.sample.pts+N}for(var M=0;g<p;){if(A.isHeader(O,g)){if(g+5<p){var B=A.appendFrame(_,O,g,h,M);if(B){if(!B.missing){g+=B.length,M++;continue}this.aacOverFlow=B}}break}g++}}},s.parseMPEGPES=function(v){var g=v.data,p=g.length,r=0,n=0,h=v.pts;if(h!==void 0)for(;n<p;)if(y.isHeader(g,n)){var b=y.appendFrame(this._audioTrack,g,n,h,r);if(!b)break;n+=b.length,r++}else n++;else S.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},s.parseID3PES=function(v){v.pts!==void 0?this._id3Track.samples.push(v):S.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},i}();function E(i,s,v,g){return{key:i,frame:!1,pts:s,dts:v,units:[],debug:g,length:0}}function c(i,s){return(31&i[s+10])<<8|i[s+11]}function t(i,s,v,g){var p={audio:-1,avc:-1,id3:-1,isAAC:!0},r=s+3+((15&i[s+1])<<8|i[s+2])-4;for(s+=12+((15&i[s+10])<<8|i[s+11]);s<r;){var n=(31&i[s+1])<<8|i[s+2];switch(i[s]){case 207:if(!g){S.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:p.audio===-1&&(p.audio=n);break;case 21:p.id3===-1&&(p.id3=n);break;case 219:if(!g){S.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:p.avc===-1&&(p.avc=n);break;case 3:case 4:v?p.audio===-1&&(p.audio=n,p.isAAC=!1):S.logger.log("MPEG audio found, not supported in this browser");break;case 36:S.logger.warn("Unsupported HEVC stream type found")}s+=5+((15&i[s+3])<<8|i[s+4])}return p}function a(i){var s,v,g,p,r,n=0,h=i.data;if(!i||i.size===0)return null;for(;h[0].length<19&&h.length>1;){var b=new Uint8Array(h[0].length+h[1].length);b.set(h[0]),b.set(h[1],h[0].length),h[0]=b,h.splice(1,1)}if(((s=h[0])[0]<<16)+(s[1]<<8)+s[2]===1){if((v=(s[4]<<8)+s[5])&&v>i.size-6)return null;var _=s[7];192&_&&(p=536870912*(14&s[9])+4194304*(255&s[10])+16384*(254&s[11])+128*(255&s[12])+(254&s[13])/2,64&_?p-(r=536870912*(14&s[14])+4194304*(255&s[15])+16384*(254&s[16])+128*(255&s[17])+(254&s[18])/2)>54e5&&(S.logger.warn(Math.round((p-r)/9e4)+"s delta between PTS and DTS, align them"),p=r):r=p);var I=(g=s[8])+9;if(i.size<=I)return null;i.size-=I;for(var O=new Uint8Array(i.size),C=0,x=h.length;C<x;C++){var P=(s=h[C]).byteLength;if(I){if(I>P){I-=P;continue}s=s.subarray(I),P-=I,I=0}O.set(s,n),n+=P}return v&&(v-=g+3),{data:O,pts:p,dts:r,len:v}}return null}function e(i,s){if(i.units.length&&i.frame){if(i.pts===void 0){var v=s.samples,g=v.length;if(!g)return void s.dropped++;var p=v[g-1];i.pts=p.pts,i.dts=p.dts}s.samples.push(i)}i.debug.length&&S.logger.log(i.pts+"/"+i.dts+":"+i.debug)}function l(i,s){var v=i.length;if(v>0){if(s.pts>=i[v-1].pts)i.push(s);else for(var g=v-1;g>=0;g--)if(s.pts<i[g].pts){i.splice(g,0,s);break}}else i.push(s)}function u(i){for(var s=i.byteLength,v=[],g=1;g<s-2;)i[g]===0&&i[g+1]===0&&i[g+2]===3?(v.push(g+2),g+=2):g++;if(v.length===0)return i;var p=s-v.length,r=new Uint8Array(p),n=0;for(g=0;g<p;n++,g++)n===v[0]&&(n++,v.shift()),r[g]=i[n];return r}T.minProbeByteLength=188,R.default=T},"./src/errors.ts":function(F,R,d){var A,y,L,k;d.r(R),d.d(R,"ErrorTypes",function(){return A}),d.d(R,"ErrorDetails",function(){return L}),(y=A||(A={})).NETWORK_ERROR="networkError",y.MEDIA_ERROR="mediaError",y.KEY_SYSTEM_ERROR="keySystemError",y.MUX_ERROR="muxError",y.OTHER_ERROR="otherError",(k=L||(L={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",k.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",k.KEY_SYSTEM_NO_SESSION="keySystemNoSession",k.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",k.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",k.MANIFEST_LOAD_ERROR="manifestLoadError",k.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",k.MANIFEST_PARSING_ERROR="manifestParsingError",k.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",k.LEVEL_EMPTY_ERROR="levelEmptyError",k.LEVEL_LOAD_ERROR="levelLoadError",k.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",k.LEVEL_SWITCH_ERROR="levelSwitchError",k.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",k.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",k.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",k.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",k.FRAG_LOAD_ERROR="fragLoadError",k.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",k.FRAG_DECRYPT_ERROR="fragDecryptError",k.FRAG_PARSING_ERROR="fragParsingError",k.REMUX_ALLOC_ERROR="remuxAllocError",k.KEY_LOAD_ERROR="keyLoadError",k.KEY_LOAD_TIMEOUT="keyLoadTimeOut",k.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",k.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",k.BUFFER_APPEND_ERROR="bufferAppendError",k.BUFFER_APPENDING_ERROR="bufferAppendingError",k.BUFFER_STALLED_ERROR="bufferStalledError",k.BUFFER_FULL_ERROR="bufferFullError",k.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",k.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",k.INTERNAL_EXCEPTION="internalException",k.INTERNAL_ABORTED="aborted",k.UNKNOWN="unknown"},"./src/events.ts":function(F,R,d){var A,y;d.r(R),d.d(R,"Events",function(){return A}),(y=A||(A={})).MEDIA_ATTACHING="hlsMediaAttaching",y.MEDIA_ATTACHED="hlsMediaAttached",y.MEDIA_DETACHING="hlsMediaDetaching",y.MEDIA_DETACHED="hlsMediaDetached",y.BUFFER_RESET="hlsBufferReset",y.BUFFER_CODECS="hlsBufferCodecs",y.BUFFER_CREATED="hlsBufferCreated",y.BUFFER_APPENDING="hlsBufferAppending",y.BUFFER_APPENDED="hlsBufferAppended",y.BUFFER_EOS="hlsBufferEos",y.BUFFER_FLUSHING="hlsBufferFlushing",y.BUFFER_FLUSHED="hlsBufferFlushed",y.MANIFEST_LOADING="hlsManifestLoading",y.MANIFEST_LOADED="hlsManifestLoaded",y.MANIFEST_PARSED="hlsManifestParsed",y.LEVEL_SWITCHING="hlsLevelSwitching",y.LEVEL_SWITCHED="hlsLevelSwitched",y.LEVEL_LOADING="hlsLevelLoading",y.LEVEL_LOADED="hlsLevelLoaded",y.LEVEL_UPDATED="hlsLevelUpdated",y.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",y.LEVELS_UPDATED="hlsLevelsUpdated",y.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",y.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",y.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",y.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",y.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",y.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",y.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",y.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",y.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",y.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",y.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",y.CUES_PARSED="hlsCuesParsed",y.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",y.INIT_PTS_FOUND="hlsInitPtsFound",y.FRAG_LOADING="hlsFragLoading",y.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",y.FRAG_LOADED="hlsFragLoaded",y.FRAG_DECRYPTED="hlsFragDecrypted",y.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",y.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",y.FRAG_PARSING_METADATA="hlsFragParsingMetadata",y.FRAG_PARSED="hlsFragParsed",y.FRAG_BUFFERED="hlsFragBuffered",y.FRAG_CHANGED="hlsFragChanged",y.FPS_DROP="hlsFpsDrop",y.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",y.ERROR="hlsError",y.DESTROYING="hlsDestroying",y.KEY_LOADING="hlsKeyLoading",y.KEY_LOADED="hlsKeyLoaded",y.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",y.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return e});var A=d("./node_modules/url-toolkit/src/url-toolkit.js"),y=d("./src/loader/playlist-loader.ts"),L=d("./src/loader/key-loader.ts"),k=d("./src/controller/id3-track-controller.ts"),w=d("./src/controller/latency-controller.ts"),D=d("./src/controller/level-controller.ts"),o=d("./src/controller/fragment-tracker.ts"),S=d("./src/controller/stream-controller.ts"),m=d("./src/is-supported.ts"),f=d("./src/utils/logger.ts"),T=d("./src/config.ts"),E=d("./node_modules/eventemitter3/index.js"),c=d("./src/events.ts"),t=d("./src/errors.ts");function a(l,u){for(var i=0;i<u.length;i++){var s=u[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(l,s.key,s)}}var e=function(){function l(g){g===void 0&&(g={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new E.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var p=this.config=Object(T.mergeConfig)(l.DefaultConfig,g);this.userConfig=g,Object(f.enableLogs)(p.debug),this._autoLevelCapping=-1,p.progressive&&Object(T.enableStreamingMode)(p);var r=p.abrController,n=p.bufferController,h=p.capLevelController,b=p.fpsController,_=this.abrController=new r(this),I=this.bufferController=new n(this),O=this.capLevelController=new h(this),C=new b(this),x=new y.default(this),P=new L.default(this),N=new k.default(this),M=this.levelController=new D.default(this),B=new o.FragmentTracker(this),G=this.streamController=new S.default(this,B);O.setStreamController(G),C.setStreamController(G);var K=[M,G];this.networkControllers=K;var V=[x,P,_,I,O,C,N,B];this.audioTrackController=this.createController(p.audioTrackController,null,K),this.createController(p.audioStreamController,B,K),this.subtitleTrackController=this.createController(p.subtitleTrackController,null,K),this.createController(p.subtitleStreamController,B,K),this.createController(p.timelineController,null,V),this.emeController=this.createController(p.emeController,null,V),this.latencyController=this.createController(w.default,null,V),this.coreComponents=V}l.isSupported=function(){return Object(m.isSupported)()};var u,i,s,v=l.prototype;return v.createController=function(g,p,r){if(g){var n=p?new g(this,p):new g(this);return r&&r.push(n),n}return null},v.on=function(g,p,r){r===void 0&&(r=this),this._emitter.on(g,p,r)},v.once=function(g,p,r){r===void 0&&(r=this),this._emitter.once(g,p,r)},v.removeAllListeners=function(g){this._emitter.removeAllListeners(g)},v.off=function(g,p,r,n){r===void 0&&(r=this),this._emitter.off(g,p,r,n)},v.listeners=function(g){return this._emitter.listeners(g)},v.emit=function(g,p,r){return this._emitter.emit(g,p,r)},v.trigger=function(g,p){if(this.config.debug)return this.emit(g,g,p);try{return this.emit(g,g,p)}catch(r){f.logger.error("An internal error happened while handling event "+g+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(c.Events.ERROR,{type:t.ErrorTypes.OTHER_ERROR,details:t.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:g,error:r})}return!1},v.listenerCount=function(g){return this._emitter.listenerCount(g)},v.destroy=function(){f.logger.log("destroy"),this.trigger(c.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(g){return g.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(g){return g.destroy()}),this.coreComponents.length=0},v.attachMedia=function(g){f.logger.log("attachMedia"),this._media=g,this.trigger(c.Events.MEDIA_ATTACHING,{media:g})},v.detachMedia=function(){f.logger.log("detachMedia"),this.trigger(c.Events.MEDIA_DETACHING,void 0),this._media=null},v.loadSource=function(g){this.stopLoad();var p=this.media,r=this.url,n=this.url=A.buildAbsoluteURL(self.location.href,g,{alwaysNormalize:!0});f.logger.log("loadSource:"+n),p&&r&&r!==n&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(p)),this.trigger(c.Events.MANIFEST_LOADING,{url:g})},v.startLoad=function(g){g===void 0&&(g=-1),f.logger.log("startLoad("+g+")"),this.networkControllers.forEach(function(p){p.startLoad(g)})},v.stopLoad=function(){f.logger.log("stopLoad"),this.networkControllers.forEach(function(g){g.stopLoad()})},v.swapAudioCodec=function(){f.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},v.recoverMediaError=function(){f.logger.log("recoverMediaError");var g=this._media;this.detachMedia(),g&&this.attachMedia(g)},v.removeLevel=function(g,p){p===void 0&&(p=0),this.levelController.removeLevel(g,p)},u=l,s=[{key:"version",get:function(){return"1.0.10"}},{key:"Events",get:function(){return c.Events}},{key:"ErrorTypes",get:function(){return t.ErrorTypes}},{key:"ErrorDetails",get:function(){return t.ErrorDetails}},{key:"DefaultConfig",get:function(){return l.defaultConfig?l.defaultConfig:T.hlsDefaultConfig},set:function(g){l.defaultConfig=g}}],(i=[{key:"levels",get:function(){var g=this.levelController.levels;return g||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(g){f.logger.log("set currentLevel:"+g),this.loadLevel=g,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(g){f.logger.log("set nextLevel:"+g),this.levelController.manualLevel=g,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(g){f.logger.log("set loadLevel:"+g),this.levelController.manualLevel=g}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(g){this.levelController.nextLoadLevel=g}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(g){f.logger.log("set firstLevel:"+g),this.levelController.firstLevel=g}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(g){f.logger.log("set startLevel:"+g),g!==-1&&(g=Math.max(g,this.minAutoLevel)),this.levelController.startLevel=g}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(g){var p=!!g;p!==this.config.capLevelToPlayerSize&&(p?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=p)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(g){this._autoLevelCapping!==g&&(f.logger.log("set autoLevelCapping:"+g),this._autoLevelCapping=g)}},{key:"bandwidthEstimate",get:function(){var g=this.abrController.bwEstimator;return g?g.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var g=this.levels,p=this.config.minAutoBitrate;if(!g)return 0;for(var r=g.length,n=0;n<r;n++)if(g[n].maxBitrate>p)return n;return 0}},{key:"maxAutoLevel",get:function(){var g=this.levels,p=this.autoLevelCapping;return p===-1&&g&&g.length?g.length-1:p}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(g){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,g)}},{key:"audioTracks",get:function(){var g=this.audioTrackController;return g?g.audioTracks:[]}},{key:"audioTrack",get:function(){var g=this.audioTrackController;return g?g.audioTrack:-1},set:function(g){var p=this.audioTrackController;p&&(p.audioTrack=g)}},{key:"subtitleTracks",get:function(){var g=this.subtitleTrackController;return g?g.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var g=this.subtitleTrackController;return g?g.subtitleTrack:-1},set:function(g){var p=this.subtitleTrackController;p&&(p.subtitleTrack=g)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var g=this.subtitleTrackController;return!!g&&g.subtitleDisplay},set:function(g){var p=this.subtitleTrackController;p&&(p.subtitleDisplay=g)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(g){this.config.lowLatencyMode=g}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&a(u.prototype,i),s&&a(u,s),l}();e.defaultConfig=void 0},"./src/is-supported.ts":function(F,R,d){d.r(R),d.d(R,"isSupported",function(){return L}),d.d(R,"changeTypeSupported",function(){return k});var A=d("./src/utils/mediasource-helper.ts");function y(){return self.SourceBuffer||self.WebKitSourceBuffer}function L(){var w=Object(A.getMediaSource)();if(!w)return!1;var D=y(),o=w&&typeof w.isTypeSupported=="function"&&w.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),S=!D||D.prototype&&typeof D.prototype.appendBuffer=="function"&&typeof D.prototype.remove=="function";return!!o&&!!S}function k(){var w,D=y();return typeof(D==null||(w=D.prototype)===null||w===void 0?void 0:w.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return m}),d.d(R,"LoadError",function(){return T});var A=d("./src/polyfills/number.ts"),y=d("./src/errors.ts");function L(E){var c=typeof Map=="function"?new Map:void 0;return(L=function(t){if(t===null||(a=t,Function.toString.call(a).indexOf("[native code]")===-1))return t;var a;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(c!==void 0){if(c.has(t))return c.get(t);c.set(t,e)}function e(){return k(t,arguments,o(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),D(e,t)})(E)}function k(E,c,t){return(k=w()?Reflect.construct:function(a,e,l){var u=[null];u.push.apply(u,e);var i=new(Function.bind.apply(a,u));return l&&D(i,l.prototype),i}).apply(null,arguments)}function w(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D(E,c){return(D=Object.setPrototypeOf||function(t,a){return t.__proto__=a,t})(E,c)}function o(E){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)})(E)}var S=Math.pow(2,17),m=function(){function E(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var c=E.prototype;return c.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},c.abort=function(){this.loader&&this.loader.abort()},c.load=function(t,a){var e=this,l=t.url;if(!l)return Promise.reject(new T({type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(l?"part list":"url")));this.abort();var u=this.config,i=u.fLoader,s=u.loader;return new Promise(function(v,g){e.loader&&e.loader.destroy();var p=e.loader=t.loader=i?new i(u):new s(u),r=f(t),n={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:S};t.stats=p.stats,p.load(r,n,{onSuccess:function(h,b,_,I){e.resetLoader(t,p),v({frag:t,part:null,payload:h.data,networkDetails:I})},onError:function(h,b,_){e.resetLoader(t,p),g(new T({type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:h,networkDetails:_}))},onAbort:function(h,b,_){e.resetLoader(t,p),g(new T({type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:_}))},onTimeout:function(h,b,_){e.resetLoader(t,p),g(new T({type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:_}))},onProgress:function(h,b,_,I){a&&a({frag:t,part:null,payload:_,networkDetails:I})}})})},c.loadPart=function(t,a,e){var l=this;this.abort();var u=this.config,i=u.fLoader,s=u.loader;return new Promise(function(v,g){l.loader&&l.loader.destroy();var p=l.loader=t.loader=i?new i(u):new s(u),r=f(t,a),n={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:S};a.stats=p.stats,p.load(r,n,{onSuccess:function(h,b,_,I){l.resetLoader(t,p),l.updateStatsFromPart(t,a);var O={frag:t,part:a,payload:h.data,networkDetails:I};e(O),v(O)},onError:function(h,b,_){l.resetLoader(t,p),g(new T({type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:a,response:h,networkDetails:_}))},onAbort:function(h,b,_){t.stats.aborted=a.stats.aborted,l.resetLoader(t,p),g(new T({type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,part:a,networkDetails:_}))},onTimeout:function(h,b,_){l.resetLoader(t,p),g(new T({type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:a,networkDetails:_}))}})})},c.updateStatsFromPart=function(t,a){var e=t.stats,l=a.stats,u=l.total;if(e.loaded+=l.loaded,u){var i=Math.round(t.duration/a.duration),s=Math.min(Math.round(e.loaded/u),i),v=(i-s)*Math.round(e.loaded/s);e.total=e.loaded+v}else e.total=Math.max(e.loaded,e.total);var g=e.loading,p=l.loading;g.start?g.first+=p.first-p.start:(g.start=p.start,g.first=p.first),g.end=p.end},c.resetLoader=function(t,a){t.loader=null,this.loader===a&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),a.destroy()},E}();function f(E,c){c===void 0&&(c=null);var t=c||E,a={frag:E,part:c,responseType:"arraybuffer",url:t.url,rangeStart:0,rangeEnd:0},e=t.byteRangeStartOffset,l=t.byteRangeEndOffset;return Object(A.isFiniteNumber)(e)&&Object(A.isFiniteNumber)(l)&&(a.rangeStart=e,a.rangeEnd=l),a}var T=function(E){var c,t;function a(e){for(var l,u=arguments.length,i=new Array(u>1?u-1:0),s=1;s<u;s++)i[s-1]=arguments[s];return(l=E.call.apply(E,[this].concat(i))||this).data=void 0,l.data=e,l}return t=E,(c=a).prototype=Object.create(t.prototype),c.prototype.constructor=c,D(c,t),a}(L(Error))},"./src/loader/fragment.ts":function(F,R,d){d.r(R),d.d(R,"ElementaryStreamTypes",function(){return A}),d.d(R,"BaseSegment",function(){return E}),d.d(R,"Fragment",function(){return c}),d.d(R,"Part",function(){return t});var A,y,L=d("./src/polyfills/number.ts"),k=d("./node_modules/url-toolkit/src/url-toolkit.js"),w=d("./src/utils/logger.ts"),D=d("./src/loader/level-key.ts"),o=d("./src/loader/load-stats.ts");function S(a,e){a.prototype=Object.create(e.prototype),a.prototype.constructor=a,m(a,e)}function m(a,e){return(m=Object.setPrototypeOf||function(l,u){return l.__proto__=u,l})(a,e)}function f(a,e){for(var l=0;l<e.length;l++){var u=e[l];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(a,u.key,u)}}function T(a,e,l){return e&&f(a.prototype,e),l&&f(a,l),a}(y=A||(A={})).AUDIO="audio",y.VIDEO="video",y.AUDIOVIDEO="audiovideo";var E=function(){function a(e){var l;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((l={})[A.AUDIO]=null,l[A.VIDEO]=null,l[A.AUDIOVIDEO]=null,l),this.baseurl=e}return a.prototype.setByteRange=function(e,l){var u=e.split("@",2),i=[];u.length===1?i[0]=l?l.byteRangeEndOffset:0:i[0]=parseInt(u[1]),i[1]=parseInt(u[0])+i[0],this._byteRange=i},T(a,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(k.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),a}(),c=function(a){function e(u,i){var s;return(s=a.call(this,i)||this)._decryptdata=null,s.rawProgramDateTime=null,s.programDateTime=null,s.tagList=[],s.duration=0,s.sn=0,s.levelkey=void 0,s.type=void 0,s.loader=null,s.level=-1,s.cc=0,s.startPTS=void 0,s.endPTS=void 0,s.appendedPTS=void 0,s.startDTS=void 0,s.endDTS=void 0,s.start=0,s.deltaPTS=void 0,s.maxStartPTS=void 0,s.minEndPTS=void 0,s.stats=new o.LoadStats,s.urlId=0,s.data=void 0,s.bitrateTest=!1,s.title=null,s.initSegment=null,s.type=u,s}S(e,a);var l=e.prototype;return l.createInitializationVector=function(u){for(var i=new Uint8Array(16),s=12;s<16;s++)i[s]=u>>8*(15-s)&255;return i},l.setDecryptDataFromLevelKey=function(u,i){var s=u;return(u==null?void 0:u.method)==="AES-128"&&u.uri&&!u.iv&&((s=D.LevelKey.fromURI(u.uri)).method=u.method,s.iv=this.createInitializationVector(i),s.keyFormat="identity"),s},l.setElementaryStreamInfo=function(u,i,s,v,g,p){p===void 0&&(p=!1);var r=this.elementaryStreams,n=r[u];n?(n.startPTS=Math.min(n.startPTS,i),n.endPTS=Math.max(n.endPTS,s),n.startDTS=Math.min(n.startDTS,v),n.endDTS=Math.max(n.endDTS,g)):r[u]={startPTS:i,endPTS:s,startDTS:v,endDTS:g,partial:p}},l.clearElementaryStreamInfo=function(){var u=this.elementaryStreams;u[A.AUDIO]=null,u[A.VIDEO]=null,u[A.AUDIOVIDEO]=null},T(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var u=this.sn;typeof u!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&w.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),u=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,u)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(L.isFiniteNumber)(this.programDateTime))return null;var u=Object(L.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*u}},{key:"encrypted",get:function(){var u;return!((u=this.decryptdata)===null||u===void 0||!u.keyFormat||!this.decryptdata.uri)}}]),e}(E),t=function(a){function e(l,u,i,s,v){var g;(g=a.call(this,i)||this).fragOffset=0,g.duration=0,g.gap=!1,g.independent=!1,g.relurl=void 0,g.fragment=void 0,g.index=void 0,g.stats=new o.LoadStats,g.duration=l.decimalFloatingPoint("DURATION"),g.gap=l.bool("GAP"),g.independent=l.bool("INDEPENDENT"),g.relurl=l.enumeratedString("URI"),g.fragment=u,g.index=s;var p=l.enumeratedString("BYTERANGE");return p&&g.setByteRange(p,v),v&&(g.fragOffset=v.fragOffset+v.duration),g}return S(e,a),T(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var l=this.elementaryStreams;return!!(l.audio||l.video||l.audiovideo)}}]),e}(E)},"./src/loader/key-loader.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return k});var A=d("./src/events.ts"),y=d("./src/errors.ts"),L=d("./src/utils/logger.ts"),k=function(){function w(o){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=o,this._registerListeners()}var D=w.prototype;return D._registerListeners=function(){this.hls.on(A.Events.KEY_LOADING,this.onKeyLoading,this)},D._unregisterListeners=function(){this.hls.off(A.Events.KEY_LOADING,this.onKeyLoading)},D.destroy=function(){for(var o in this._unregisterListeners(),this.loaders){var S=this.loaders[o];S&&S.destroy()}this.loaders={}},D.onKeyLoading=function(o,S){var m=S.frag,f=m.type,T=this.loaders[f];if(m.decryptdata){var E=m.decryptdata.uri;if(E!==this.decrypturl||this.decryptkey===null){var c=this.hls.config;if(T&&(L.logger.warn("abort previous key loader for type:"+f),T.abort()),!E)return void L.logger.warn("key uri is falsy");var t=c.loader,a=m.loader=this.loaders[f]=new t(c);this.decrypturl=E,this.decryptkey=null;var e={url:E,frag:m,responseType:"arraybuffer"},l={timeout:c.fragLoadingTimeOut,maxRetry:0,retryDelay:c.fragLoadingRetryDelay,maxRetryDelay:c.fragLoadingMaxRetryTimeout,highWaterMark:0},u={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};a.load(e,l,u)}else this.decryptkey&&(m.decryptdata.key=this.decryptkey,this.hls.trigger(A.Events.KEY_LOADED,{frag:m}))}else L.logger.warn("Missing decryption data on fragment in onKeyLoading")},D.loadsuccess=function(o,S,m){var f=m.frag;f.decryptdata?(this.decryptkey=f.decryptdata.key=new Uint8Array(o.data),f.loader=null,delete this.loaders[f.type],this.hls.trigger(A.Events.KEY_LOADED,{frag:f})):L.logger.error("after key load, decryptdata unset")},D.loaderror=function(o,S){var m=S.frag,f=m.loader;f&&f.abort(),delete this.loaders[m.type],this.hls.trigger(A.Events.ERROR,{type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:m,response:o})},D.loadtimeout=function(o,S){var m=S.frag,f=m.loader;f&&f.abort(),delete this.loaders[m.type],this.hls.trigger(A.Events.ERROR,{type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:m})},w}()},"./src/loader/level-details.ts":function(F,R,d){d.r(R),d.d(R,"LevelDetails",function(){return L});var A=d("./src/polyfills/number.ts");function y(k,w){for(var D=0;D<w.length;D++){var o=w[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(k,o.key,o)}}var L=function(){function k(o){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=o}var w,D;return k.prototype.reloaded=function(o){if(!o)return this.advanced=!0,void(this.updated=!0);var S=this.lastPartSn-o.lastPartSn,m=this.lastPartIndex-o.lastPartIndex;this.updated=this.endSN!==o.endSN||!!m||!!S,this.advanced=this.endSN>o.endSN||S>0||S===0&&m>0,this.updated||this.advanced?this.misses=Math.floor(.6*o.misses):this.misses=o.misses+1,this.availabilityDelay=o.availabilityDelay},w=k,(D=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(A.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var o=this.driftEndTime-this.driftStartTime;return o>0?1e3*(this.driftEnd-this.driftStart)/o:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var o;return(o=this.fragments)!==null&&o!==void 0&&o.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var o;return(o=this.partList)!==null&&o!==void 0&&o.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&y(w.prototype,D),k}()},"./src/loader/level-key.ts":function(F,R,d){d.r(R),d.d(R,"LevelKey",function(){return L});var A=d("./node_modules/url-toolkit/src/url-toolkit.js");function y(k,w){for(var D=0;D<w.length;D++){var o=w[D];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(k,o.key,o)}}var L=function(){function k(o,S){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=S?Object(A.buildAbsoluteURL)(o,S,{alwaysNormalize:!0}):o}var w,D;return k.fromURL=function(o,S){return new k(o,S)},k.fromURI=function(o){return new k(o)},w=k,(D=[{key:"uri",get:function(){return this._uri}}])&&y(w.prototype,D),k}()},"./src/loader/load-stats.ts":function(F,R,d){d.r(R),d.d(R,"LoadStats",function(){return A});var A=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return t});var A=d("./src/polyfills/number.ts"),y=d("./node_modules/url-toolkit/src/url-toolkit.js"),L=d("./src/loader/fragment.ts"),k=d("./src/loader/level-details.ts"),w=d("./src/loader/level-key.ts"),D=d("./src/utils/attr-list.ts"),o=d("./src/utils/logger.ts"),S=d("./src/utils/codecs.ts"),m=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,f=/#EXT-X-MEDIA:(.*)/g,T=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),E=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),c=/\.(mp4|m4s|m4v|m4a)$/i,t=function(){function u(){}return u.findGroup=function(i,s){for(var v=0;v<i.length;v++){var g=i[v];if(g.id===s)return g}},u.convertAVC1ToAVCOTI=function(i){var s=i.split(".");if(s.length>2){var v=s.shift()+".";return v+=parseInt(s.shift()).toString(16),v+=("000"+parseInt(s.shift()).toString(16)).substr(-4)}return i},u.resolve=function(i,s){return y.buildAbsoluteURL(s,i,{alwaysNormalize:!0})},u.parseMasterPlaylist=function(i,s){var v,g=[],p={},r=!1;for(m.lastIndex=0;(v=m.exec(i))!=null;)if(v[1]){var n=new D.AttrList(v[1]),h={attrs:n,bitrate:n.decimalInteger("AVERAGE-BANDWIDTH")||n.decimalInteger("BANDWIDTH"),name:n.NAME,url:u.resolve(v[2],s)},b=n.decimalResolution("RESOLUTION");b&&(h.width=b.width,h.height=b.height),a((n.CODECS||"").split(/[ ,]+/).filter(function(I){return I}),h),h.videoCodec&&h.videoCodec.indexOf("avc1")!==-1&&(h.videoCodec=u.convertAVC1ToAVCOTI(h.videoCodec)),g.push(h)}else if(v[3]){var _=new D.AttrList(v[3]);_["DATA-ID"]&&(r=!0,p[_["DATA-ID"]]=_)}return{levels:g,sessionData:r?p:null}},u.parseMasterPlaylistMedia=function(i,s,v,g){var p;g===void 0&&(g=[]);var r=[],n=0;for(f.lastIndex=0;(p=f.exec(i))!==null;){var h=new D.AttrList(p[1]);if(h.TYPE===v){var b={attrs:h,bitrate:0,id:n++,groupId:h["GROUP-ID"],instreamId:h["INSTREAM-ID"],name:h.NAME||h.LANGUAGE||"",type:v,default:h.bool("DEFAULT"),autoselect:h.bool("AUTOSELECT"),forced:h.bool("FORCED"),lang:h.LANGUAGE,url:h.URI?u.resolve(h.URI,s):""};if(g.length){var _=u.findGroup(g,b.groupId)||g[0];e(b,_,"audioCodec"),e(b,_,"textCodec")}r.push(b)}}return r},u.parseLevelPlaylist=function(i,s,v,g,p){var r,n,h,b=new k.LevelDetails(s),_=b.fragments,I=null,O=0,C=0,x=0,P=0,N=null,M=new L.Fragment(g,s),B=-1,G=!1;for(T.lastIndex=0,b.m3u8=i;(r=T.exec(i))!==null;){G&&(G=!1,(M=new L.Fragment(g,s)).start=x,M.sn=O,M.cc=P,M.level=v,I&&(M.initSegment=I,M.rawProgramDateTime=I.rawProgramDateTime));var K=r[1];if(K){M.duration=parseFloat(K);var V=(" "+r[2]).slice(1);M.title=V||null,M.tagList.push(V?["INF",K,V]:["INF",K])}else if(r[3])Object(A.isFiniteNumber)(M.duration)&&(M.start=x,h&&(M.levelkey=h),M.sn=O,M.level=v,M.cc=P,M.urlId=p,_.push(M),M.relurl=(" "+r[3]).slice(1),l(M,N),N=M,x+=M.duration,O++,C=0,G=!0);else if(r[4]){var H=(" "+r[4]).slice(1);N?M.setByteRange(H,N):M.setByteRange(H)}else if(r[5])M.rawProgramDateTime=(" "+r[5]).slice(1),M.tagList.push(["PROGRAM-DATE-TIME",M.rawProgramDateTime]),B===-1&&(B=_.length);else{if(!(r=r[0].match(E))){o.logger.warn("No matches on slow regex match for level playlist!");continue}for(n=1;n<r.length&&r[n]===void 0;n++);var W=(" "+r[n]).slice(1),Y=(" "+r[n+1]).slice(1),X=r[n+2]?(" "+r[n+2]).slice(1):"";switch(W){case"PLAYLIST-TYPE":b.type=Y.toUpperCase();break;case"MEDIA-SEQUENCE":O=b.startSN=parseInt(Y);break;case"SKIP":var tt=new D.AttrList(Y),et=tt.decimalInteger("SKIPPED-SEGMENTS");if(Object(A.isFiniteNumber)(et)){b.skippedSegments=et;for(var nt=et;nt--;)_.unshift(null);O+=et}var J=tt.enumeratedString("RECENTLY-REMOVED-DATERANGES");J&&(b.recentlyRemovedDateranges=J.split("	"));break;case"TARGETDURATION":b.targetduration=parseFloat(Y);break;case"VERSION":b.version=parseInt(Y);break;case"EXTM3U":break;case"ENDLIST":b.live=!1;break;case"#":(Y||X)&&M.tagList.push(X?[Y,X]:[Y]);break;case"DIS":P++;case"GAP":M.tagList.push([W]);break;case"BITRATE":M.tagList.push([W,Y]);break;case"DISCONTINUITY-SEQ":P=parseInt(Y);break;case"KEY":var st,Z=new D.AttrList(Y),rt=Z.enumeratedString("METHOD"),ot=Z.URI,at=Z.hexadecimalInteger("IV"),gt=Z.enumeratedString("KEYFORMATVERSIONS"),Et=Z.enumeratedString("KEYID"),Tt=(st=Z.enumeratedString("KEYFORMAT"))!=null?st:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(Tt)>-1){o.logger.warn("Keyformat "+Tt+" is not supported from the manifest");continue}if(Tt!=="identity")continue;rt&&(h=w.LevelKey.fromURL(s,ot),ot&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(rt)>=0&&(h.method=rt,h.keyFormat=Tt,Et&&(h.keyID=Et),gt&&(h.keyFormatVersions=gt),h.iv=at));break;case"START":var At=new D.AttrList(Y).decimalFloatingPoint("TIME-OFFSET");Object(A.isFiniteNumber)(At)&&(b.startTimeOffset=At);break;case"MAP":var ft=new D.AttrList(Y);M.relurl=ft.URI,ft.BYTERANGE&&M.setByteRange(ft.BYTERANGE),M.level=v,M.sn="initSegment",h&&(M.levelkey=h),M.initSegment=null,I=M,G=!0;break;case"SERVER-CONTROL":var dt=new D.AttrList(Y);b.canBlockReload=dt.bool("CAN-BLOCK-RELOAD"),b.canSkipUntil=dt.optionalFloat("CAN-SKIP-UNTIL",0),b.canSkipDateRanges=b.canSkipUntil>0&&dt.bool("CAN-SKIP-DATERANGES"),b.partHoldBack=dt.optionalFloat("PART-HOLD-BACK",0),b.holdBack=dt.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Kt=new D.AttrList(Y);b.partTarget=Kt.decimalFloatingPoint("PART-TARGET");break;case"PART":var kt=b.partList;kt||(kt=b.partList=[]);var xt=C>0?kt[kt.length-1]:void 0,Vt=C++,Mt=new L.Part(new D.AttrList(Y),M,s,Vt,xt);kt.push(Mt),M.duration+=Mt.duration;break;case"PRELOAD-HINT":var It=new D.AttrList(Y);b.preloadHint=It;break;case"RENDITION-REPORT":var $t=new D.AttrList(Y);b.renditionReports=b.renditionReports||[],b.renditionReports.push($t);break;default:o.logger.warn("line parsed but not handled: "+r)}}}N&&!N.relurl?(_.pop(),x-=N.duration,b.partList&&(b.fragmentHint=N)):b.partList&&(l(M,N),M.cc=P,b.fragmentHint=M);var Ht=_.length,Rt=_[0],Qt=_[Ht-1];if((x+=b.skippedSegments*b.targetduration)>0&&Ht&&Qt){b.averagetargetduration=x/Ht;var Wt=Qt.sn;b.endSN=Wt!=="initSegment"?Wt:0,Rt&&(b.startCC=Rt.cc,Rt.initSegment||b.fragments.every(function(Nt){return Nt.relurl&&(Pt=Nt.relurl,c.test((Bt=(Dt=y.parseURL(Pt))===null||Dt===void 0?void 0:Dt.path)!=null?Bt:""));var Pt,Bt,Dt})&&(o.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(M=new L.Fragment(g,s)).relurl=Qt.relurl,M.level=v,M.sn="initSegment",Rt.initSegment=M,b.needSidxRanges=!0))}else b.endSN=0,b.startCC=0;return b.fragmentHint&&(x+=b.fragmentHint.duration),b.totalduration=x,b.endCC=P,B>0&&function(Nt,Pt){for(var Bt=Nt[Pt],Dt=Pt;Dt--;){var Ut=Nt[Dt];if(!Ut)return;Ut.programDateTime=Bt.programDateTime-1e3*Ut.duration,Bt=Ut}}(_,B),b},u}();function a(u,i){["video","audio","text"].forEach(function(s){var v=u.filter(function(p){return Object(S.isCodecType)(p,s)});if(v.length){var g=v.filter(function(p){return p.lastIndexOf("avc1",0)===0||p.lastIndexOf("mp4a",0)===0});i[s+"Codec"]=g.length>0?g[0]:v[0],u=u.filter(function(p){return v.indexOf(p)===-1})}}),i.unknownCodecs=u}function e(u,i,s){var v=i[s];v&&(u[s]=v)}function l(u,i){u.rawProgramDateTime?u.programDateTime=Date.parse(u.rawProgramDateTime):i!=null&&i.programDateTime&&(u.programDateTime=i.endProgramDateTime),Object(A.isFiniteNumber)(u.programDateTime)||(u.programDateTime=null,u.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(F,R,d){d.r(R);var A=d("./src/polyfills/number.ts"),y=d("./src/events.ts"),L=d("./src/errors.ts"),k=d("./src/utils/logger.ts"),w=d("./src/utils/mp4-tools.ts"),D=d("./src/loader/m3u8-parser.ts"),o=d("./src/types/loader.ts"),S=d("./src/utils/attr-list.ts");function m(T,E){var c=T.url;return c!==void 0&&c.indexOf("data:")!==0||(c=E.url),c}var f=function(){function T(c){this.hls=void 0,this.loaders=Object.create(null),this.hls=c,this.registerListeners()}var E=T.prototype;return E.registerListeners=function(){var c=this.hls;c.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.on(y.Events.LEVEL_LOADING,this.onLevelLoading,this),c.on(y.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),c.on(y.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},E.unregisterListeners=function(){var c=this.hls;c.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),c.off(y.Events.LEVEL_LOADING,this.onLevelLoading,this),c.off(y.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),c.off(y.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},E.createInternalLoader=function(c){var t=this.hls.config,a=t.pLoader,e=t.loader,l=new(a||e)(t);return c.loader=l,this.loaders[c.type]=l,l},E.getInternalLoader=function(c){return this.loaders[c.type]},E.resetInternalLoader=function(c){this.loaders[c]&&delete this.loaders[c]},E.destroyInternalLoaders=function(){for(var c in this.loaders){var t=this.loaders[c];t&&t.destroy(),this.resetInternalLoader(c)}},E.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},E.onManifestLoading=function(c,t){var a=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:o.PlaylistContextType.MANIFEST,url:a,deliveryDirectives:null})},E.onLevelLoading=function(c,t){var a=t.id,e=t.level,l=t.url,u=t.deliveryDirectives;this.load({id:a,groupId:null,level:e,responseType:"text",type:o.PlaylistContextType.LEVEL,url:l,deliveryDirectives:u})},E.onAudioTrackLoading=function(c,t){var a=t.id,e=t.groupId,l=t.url,u=t.deliveryDirectives;this.load({id:a,groupId:e,level:null,responseType:"text",type:o.PlaylistContextType.AUDIO_TRACK,url:l,deliveryDirectives:u})},E.onSubtitleTrackLoading=function(c,t){var a=t.id,e=t.groupId,l=t.url,u=t.deliveryDirectives;this.load({id:a,groupId:e,level:null,responseType:"text",type:o.PlaylistContextType.SUBTITLE_TRACK,url:l,deliveryDirectives:u})},E.load=function(c){var t,a,e,l,u,i,s=this.hls.config,v=this.getInternalLoader(c);if(v){var g=v.context;if(g&&g.url===c.url)return void k.logger.trace("[playlist-loader]: playlist request ongoing");k.logger.log("[playlist-loader]: aborting previous loader for type: "+c.type),v.abort()}switch(c.type){case o.PlaylistContextType.MANIFEST:a=s.manifestLoadingMaxRetry,e=s.manifestLoadingTimeOut,l=s.manifestLoadingRetryDelay,u=s.manifestLoadingMaxRetryTimeout;break;case o.PlaylistContextType.LEVEL:case o.PlaylistContextType.AUDIO_TRACK:case o.PlaylistContextType.SUBTITLE_TRACK:a=0,e=s.levelLoadingTimeOut;break;default:a=s.levelLoadingMaxRetry,e=s.levelLoadingTimeOut,l=s.levelLoadingRetryDelay,u=s.levelLoadingMaxRetryTimeout}if(v=this.createInternalLoader(c),(t=c.deliveryDirectives)!==null&&t!==void 0&&t.part&&(c.type===o.PlaylistContextType.LEVEL&&c.level!==null?i=this.hls.levels[c.level].details:c.type===o.PlaylistContextType.AUDIO_TRACK&&c.id!==null?i=this.hls.audioTracks[c.id].details:c.type===o.PlaylistContextType.SUBTITLE_TRACK&&c.id!==null&&(i=this.hls.subtitleTracks[c.id].details),i)){var p=i.partTarget,r=i.targetduration;p&&r&&(e=Math.min(1e3*Math.max(3*p,.8*r),e))}var n={timeout:e,maxRetry:a,retryDelay:l,maxRetryDelay:u,highWaterMark:0},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};v.load(c,n,h)},E.loadsuccess=function(c,t,a,e){if(e===void 0&&(e=null),a.isSidxRequest)return this.handleSidxRequest(c,a),void this.handlePlaylistLoaded(c,t,a,e);this.resetInternalLoader(a.type);var l=c.data;l.indexOf("#EXTM3U")===0?(t.parsing.start=performance.now(),l.indexOf("#EXTINF:")>0||l.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(c,t,a,e):this.handleMasterPlaylist(c,t,a,e)):this.handleManifestParsingError(c,a,"no EXTM3U delimiter",e)},E.loaderror=function(c,t,a){a===void 0&&(a=null),this.handleNetworkError(t,a,!1,c)},E.loadtimeout=function(c,t,a){a===void 0&&(a=null),this.handleNetworkError(t,a,!0)},E.handleMasterPlaylist=function(c,t,a,e){var l=this.hls,u=c.data,i=m(c,a),s=D.default.parseMasterPlaylist(u,i),v=s.levels,g=s.sessionData;if(v.length){var p=v.map(function(_){return{id:_.attrs.AUDIO,audioCodec:_.audioCodec}}),r=v.map(function(_){return{id:_.attrs.SUBTITLES,textCodec:_.textCodec}}),n=D.default.parseMasterPlaylistMedia(u,i,"AUDIO",p),h=D.default.parseMasterPlaylistMedia(u,i,"SUBTITLES",r),b=D.default.parseMasterPlaylistMedia(u,i,"CLOSED-CAPTIONS");n.length&&(n.some(function(_){return!_.url})||!v[0].audioCodec||v[0].attrs.AUDIO||(k.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),n.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new S.AttrList({}),bitrate:0,url:""}))),l.trigger(y.Events.MANIFEST_LOADED,{levels:v,audioTracks:n,subtitles:h,captions:b,url:i,stats:t,networkDetails:e,sessionData:g})}else this.handleManifestParsingError(c,a,"no level found in manifest",e)},E.handleTrackOrLevelPlaylist=function(c,t,a,e){var l=this.hls,u=a.id,i=a.level,s=a.type,v=m(c,a),g=Object(A.isFiniteNumber)(u)?u:0,p=Object(A.isFiniteNumber)(i)?i:g,r=function(I){switch(I.type){case o.PlaylistContextType.AUDIO_TRACK:return o.PlaylistLevelType.AUDIO;case o.PlaylistContextType.SUBTITLE_TRACK:return o.PlaylistLevelType.SUBTITLE;default:return o.PlaylistLevelType.MAIN}}(a),n=D.default.parseLevelPlaylist(c.data,v,p,r,g);if(n.fragments.length){if(s===o.PlaylistContextType.MANIFEST){var h={attrs:new S.AttrList({}),bitrate:0,details:n,name:"",url:v};l.trigger(y.Events.MANIFEST_LOADED,{levels:[h],audioTracks:[],url:v,stats:t,networkDetails:e,sessionData:null})}if(t.parsing.end=performance.now(),n.needSidxRanges){var b,_=(b=n.fragments[0].initSegment)===null||b===void 0?void 0:b.url;this.load({url:_,isSidxRequest:!0,type:s,level:i,levelDetails:n,id:u,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else a.levelDetails=n,this.handlePlaylistLoaded(c,t,a,e)}else l.trigger(y.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:v,reason:"no fragments found in level",level:typeof a.level=="number"?a.level:void 0})},E.handleSidxRequest=function(c,t){var a=Object(w.parseSegmentIndex)(new Uint8Array(c.data));if(a){var e=a.references,l=t.levelDetails;e.forEach(function(u,i){var s=u.info,v=l.fragments[i];v.byteRange.length===0&&v.setByteRange(String(1+s.end-s.start)+"@"+String(s.start)),v.initSegment&&v.initSegment.setByteRange(String(a.moovEndOffset)+"@0")})}},E.handleManifestParsingError=function(c,t,a,e){this.hls.trigger(y.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===o.PlaylistContextType.MANIFEST,url:c.url,reason:a,response:c,context:t,networkDetails:e})},E.handleNetworkError=function(c,t,a,e){a===void 0&&(a=!1),k.logger.warn("[playlist-loader]: A network "+(a?"timeout":"error")+" occurred while loading "+c.type+" level: "+c.level+" id: "+c.id+' group-id: "'+c.groupId+'"');var l=L.ErrorDetails.UNKNOWN,u=!1,i=this.getInternalLoader(c);switch(c.type){case o.PlaylistContextType.MANIFEST:l=a?L.ErrorDetails.MANIFEST_LOAD_TIMEOUT:L.ErrorDetails.MANIFEST_LOAD_ERROR,u=!0;break;case o.PlaylistContextType.LEVEL:l=a?L.ErrorDetails.LEVEL_LOAD_TIMEOUT:L.ErrorDetails.LEVEL_LOAD_ERROR,u=!1;break;case o.PlaylistContextType.AUDIO_TRACK:l=a?L.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:L.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case o.PlaylistContextType.SUBTITLE_TRACK:l=a?L.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:L.ErrorDetails.SUBTITLE_LOAD_ERROR,u=!1}i&&this.resetInternalLoader(c.type);var s={type:L.ErrorTypes.NETWORK_ERROR,details:l,fatal:u,url:c.url,loader:i,context:c,networkDetails:t};e&&(s.response=e),this.hls.trigger(y.Events.ERROR,s)},E.handlePlaylistLoaded=function(c,t,a,e){var l=a.type,u=a.level,i=a.id,s=a.groupId,v=a.loader,g=a.levelDetails,p=a.deliveryDirectives;if(g!=null&&g.targetduration){if(v)switch(g.live&&(v.getCacheAge&&(g.ageHeader=v.getCacheAge()||0),v.getCacheAge&&!isNaN(g.ageHeader)||(g.ageHeader=0)),l){case o.PlaylistContextType.MANIFEST:case o.PlaylistContextType.LEVEL:this.hls.trigger(y.Events.LEVEL_LOADED,{details:g,level:u||0,id:i||0,stats:t,networkDetails:e,deliveryDirectives:p});break;case o.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(y.Events.AUDIO_TRACK_LOADED,{details:g,id:i||0,groupId:s||"",stats:t,networkDetails:e,deliveryDirectives:p});break;case o.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(y.Events.SUBTITLE_TRACK_LOADED,{details:g,id:i||0,groupId:s||"",stats:t,networkDetails:e,deliveryDirectives:p})}}else this.handleManifestParsingError(c,a,"invalid target duration",e)},T}();R.default=f},"./src/polyfills/number.ts":function(F,R,d){d.r(R),d.d(R,"isFiniteNumber",function(){return A}),d.d(R,"MAX_SAFE_INTEGER",function(){return y});var A=Number.isFinite||function(L){return typeof L=="number"&&isFinite(L)},y=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(F,R,d){d.r(R);var A=function(){function y(){}return y.getSilentFrame=function(L,k){switch(L){case"mp4a.40.2":if(k===1)return new Uint8Array([0,200,0,128,35,128]);if(k===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(k===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(k===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(k===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(k===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(k===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(k===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(k===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},y}();R.default=A},"./src/remux/mp4-generator.ts":function(F,R,d){d.r(R);var A=Math.pow(2,32)-1,y=function(){function L(){}return L.init=function(){var k;for(k in L.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},L.types)L.types.hasOwnProperty(k)&&(L.types[k]=[k.charCodeAt(0),k.charCodeAt(1),k.charCodeAt(2),k.charCodeAt(3)]);var w=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),D=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);L.HDLR_TYPES={video:w,audio:D};var o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),S=new Uint8Array([0,0,0,0,0,0,0,0]);L.STTS=L.STSC=L.STCO=S,L.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),L.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),L.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),L.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var m=new Uint8Array([105,115,111,109]),f=new Uint8Array([97,118,99,49]),T=new Uint8Array([0,0,0,1]);L.FTYP=L.box(L.types.ftyp,m,T,m,f),L.DINF=L.box(L.types.dinf,L.box(L.types.dref,o))},L.box=function(k){for(var w=8,D=arguments.length,o=new Array(D>1?D-1:0),S=1;S<D;S++)o[S-1]=arguments[S];for(var m=o.length,f=m;m--;)w+=o[m].byteLength;var T=new Uint8Array(w);for(T[0]=w>>24&255,T[1]=w>>16&255,T[2]=w>>8&255,T[3]=255&w,T.set(k,4),m=0,w=8;m<f;m++)T.set(o[m],w),w+=o[m].byteLength;return T},L.hdlr=function(k){return L.box(L.types.hdlr,L.HDLR_TYPES[k])},L.mdat=function(k){return L.box(L.types.mdat,k)},L.mdhd=function(k,w){w*=k;var D=Math.floor(w/(A+1)),o=Math.floor(w%(A+1));return L.box(L.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,k>>24&255,k>>16&255,k>>8&255,255&k,D>>24,D>>16&255,D>>8&255,255&D,o>>24,o>>16&255,o>>8&255,255&o,85,196,0,0]))},L.mdia=function(k){return L.box(L.types.mdia,L.mdhd(k.timescale,k.duration),L.hdlr(k.type),L.minf(k))},L.mfhd=function(k){return L.box(L.types.mfhd,new Uint8Array([0,0,0,0,k>>24,k>>16&255,k>>8&255,255&k]))},L.minf=function(k){return k.type==="audio"?L.box(L.types.minf,L.box(L.types.smhd,L.SMHD),L.DINF,L.stbl(k)):L.box(L.types.minf,L.box(L.types.vmhd,L.VMHD),L.DINF,L.stbl(k))},L.moof=function(k,w,D){return L.box(L.types.moof,L.mfhd(k),L.traf(D,w))},L.moov=function(k){for(var w=k.length,D=[];w--;)D[w]=L.trak(k[w]);return L.box.apply(null,[L.types.moov,L.mvhd(k[0].timescale,k[0].duration)].concat(D).concat(L.mvex(k)))},L.mvex=function(k){for(var w=k.length,D=[];w--;)D[w]=L.trex(k[w]);return L.box.apply(null,[L.types.mvex].concat(D))},L.mvhd=function(k,w){w*=k;var D=Math.floor(w/(A+1)),o=Math.floor(w%(A+1)),S=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,k>>24&255,k>>16&255,k>>8&255,255&k,D>>24,D>>16&255,D>>8&255,255&D,o>>24,o>>16&255,o>>8&255,255&o,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return L.box(L.types.mvhd,S)},L.sdtp=function(k){var w,D,o=k.samples||[],S=new Uint8Array(4+o.length);for(w=0;w<o.length;w++)D=o[w].flags,S[w+4]=D.dependsOn<<4|D.isDependedOn<<2|D.hasRedundancy;return L.box(L.types.sdtp,S)},L.stbl=function(k){return L.box(L.types.stbl,L.stsd(k),L.box(L.types.stts,L.STTS),L.box(L.types.stsc,L.STSC),L.box(L.types.stsz,L.STSZ),L.box(L.types.stco,L.STCO))},L.avc1=function(k){var w,D,o,S=[],m=[];for(w=0;w<k.sps.length;w++)o=(D=k.sps[w]).byteLength,S.push(o>>>8&255),S.push(255&o),S=S.concat(Array.prototype.slice.call(D));for(w=0;w<k.pps.length;w++)o=(D=k.pps[w]).byteLength,m.push(o>>>8&255),m.push(255&o),m=m.concat(Array.prototype.slice.call(D));var f=L.box(L.types.avcC,new Uint8Array([1,S[3],S[4],S[5],255,224|k.sps.length].concat(S).concat([k.pps.length]).concat(m))),T=k.width,E=k.height,c=k.pixelRatio[0],t=k.pixelRatio[1];return L.box(L.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,T>>8&255,255&T,E>>8&255,255&E,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),f,L.box(L.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),L.box(L.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,t>>24,t>>16&255,t>>8&255,255&t])))},L.esds=function(k){var w=k.config.length;return new Uint8Array([0,0,0,0,3,23+w,0,1,0,4,15+w,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([w]).concat(k.config).concat([6,1,2]))},L.mp4a=function(k){var w=k.samplerate;return L.box(L.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,k.channelCount,0,16,0,0,0,0,w>>8&255,255&w,0,0]),L.box(L.types.esds,L.esds(k)))},L.mp3=function(k){var w=k.samplerate;return L.box(L.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,k.channelCount,0,16,0,0,0,0,w>>8&255,255&w,0,0]))},L.stsd=function(k){return k.type==="audio"?k.isAAC||k.codec!=="mp3"?L.box(L.types.stsd,L.STSD,L.mp4a(k)):L.box(L.types.stsd,L.STSD,L.mp3(k)):L.box(L.types.stsd,L.STSD,L.avc1(k))},L.tkhd=function(k){var w=k.id,D=k.duration*k.timescale,o=k.width,S=k.height,m=Math.floor(D/(A+1)),f=Math.floor(D%(A+1));return L.box(L.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,w>>24&255,w>>16&255,w>>8&255,255&w,0,0,0,0,m>>24,m>>16&255,m>>8&255,255&m,f>>24,f>>16&255,f>>8&255,255&f,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,S>>8&255,255&S,0,0]))},L.traf=function(k,w){var D=L.sdtp(k),o=k.id,S=Math.floor(w/(A+1)),m=Math.floor(w%(A+1));return L.box(L.types.traf,L.box(L.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),L.box(L.types.tfdt,new Uint8Array([1,0,0,0,S>>24,S>>16&255,S>>8&255,255&S,m>>24,m>>16&255,m>>8&255,255&m])),L.trun(k,D.length+16+20+8+16+8+8),D)},L.trak=function(k){return k.duration=k.duration||4294967295,L.box(L.types.trak,L.tkhd(k),L.mdia(k))},L.trex=function(k){var w=k.id;return L.box(L.types.trex,new Uint8Array([0,0,0,0,w>>24,w>>16&255,w>>8&255,255&w,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},L.trun=function(k,w){var D,o,S,m,f,T,E=k.samples||[],c=E.length,t=12+16*c,a=new Uint8Array(t);for(w+=8+t,a.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,w>>>24&255,w>>>16&255,w>>>8&255,255&w],0),D=0;D<c;D++)S=(o=E[D]).duration,m=o.size,f=o.flags,T=o.cts,a.set([S>>>24&255,S>>>16&255,S>>>8&255,255&S,m>>>24&255,m>>>16&255,m>>>8&255,255&m,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|f.isNonSync,61440&f.degradPrio,15&f.degradPrio,T>>>24&255,T>>>16&255,T>>>8&255,255&T],12+16*D);return L.box(L.types.trun,a)},L.initSegment=function(k){L.types||L.init();var w=L.moov(k),D=new Uint8Array(L.FTYP.byteLength+w.byteLength);return D.set(L.FTYP),D.set(w,L.FTYP.byteLength),D},L}();y.types=void 0,y.HDLR_TYPES=void 0,y.STTS=void 0,y.STSC=void 0,y.STCO=void 0,y.STSZ=void 0,y.VMHD=void 0,y.SMHD=void 0,y.STSD=void 0,y.FTYP=void 0,y.DINF=void 0,R.default=y},"./src/remux/mp4-remuxer.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return c}),d.d(R,"normalizePts",function(){return t});var A=d("./src/polyfills/number.ts"),y=d("./src/remux/aac-helper.ts"),L=d("./src/remux/mp4-generator.ts"),k=d("./src/events.ts"),w=d("./src/errors.ts"),D=d("./src/utils/logger.ts"),o=d("./src/types/loader.ts"),S=d("./src/utils/timescale-conversion.ts");function m(){return(m=Object.assign||function(l){for(var u=1;u<arguments.length;u++){var i=arguments[u];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(l[s]=i[s])}return l}).apply(this,arguments)}var f=null,T=null,E=!1,c=function(){function l(i,s,v,g){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=i,this.config=s,this.typeSupported=v,this.ISGenerated=!1,f===null){var p=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);f=p?parseInt(p[1]):0}if(T===null){var r=navigator.userAgent.match(/Safari\/(\d+)/i);T=r?parseInt(r[1]):0}E=!!f&&f<75||!!T&&T<600}var u=l.prototype;return u.destroy=function(){},u.resetTimeStamp=function(i){D.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=i},u.resetNextTimestamp=function(){D.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},u.resetInitSegment=function(){D.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},u.getVideoStartPts=function(i){var s=!1,v=i.reduce(function(g,p){var r=p.pts-g;return r<-4294967296?(s=!0,t(g,p.pts)):r>0?g:p.pts},i[0].pts);return s&&D.logger.debug("PTS rollover detected"),v},u.remux=function(i,s,v,g,p,r,n,h){var b,_,I,O,C,x,P=p,N=p,M=i.pid>-1,B=s.pid>-1,G=s.samples.length,K=i.samples.length>0,V=G>1;if((!M||K)&&(!B||V)||this.ISGenerated||n){this.ISGenerated||(I=this.generateIS(i,s,p));var H=this.isVideoContiguous,W=-1;if(V&&(W=function(nt){for(var J=0;J<nt.length;J++)if(nt[J].key)return J;return-1}(s.samples),!H&&this.config.forceKeyFrameOnDiscontinuity))if(x=!0,W>0){D.logger.warn("[mp4-remuxer]: Dropped "+W+" out of "+G+" video samples due to a missing keyframe");var Y=this.getVideoStartPts(s.samples);s.samples=s.samples.slice(W),s.dropped+=W,N+=(s.samples[0].pts-Y)/(s.timescale||9e4)}else W===-1&&(D.logger.warn("[mp4-remuxer]: No keyframe found out of "+G+" video samples"),x=!1);if(this.ISGenerated){if(K&&V){var X=this.getVideoStartPts(s.samples),tt=(t(i.samples[0].pts,X)-X)/s.inputTimeScale;P+=Math.max(0,tt),N+=Math.max(0,-tt)}if(K){if(i.samplerate||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),I=this.generateIS(i,s,p)),_=this.remuxAudio(i,P,this.isAudioContiguous,r,B||V||h===o.PlaylistLevelType.AUDIO?N:void 0),V){var et=_?_.endPTS-_.startPTS:0;s.inputTimeScale||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),I=this.generateIS(i,s,p)),b=this.remuxVideo(s,N,H,et)}}else V&&(b=this.remuxVideo(s,N,H,0));b&&(b.firstKeyFrame=W,b.independent=W!==-1)}}return this.ISGenerated&&(v.samples.length&&(C=this.remuxID3(v,p)),g.samples.length&&(O=this.remuxText(g,p))),{audio:_,video:b,initSegment:I,independent:x,text:O,id3:C}},u.generateIS=function(i,s,v){var g,p,r,n=i.samples,h=s.samples,b=this.typeSupported,_={},I=!Object(A.isFiniteNumber)(this._initPTS),O="audio/mp4";if(I&&(g=p=1/0),i.config&&n.length&&(i.timescale=i.samplerate,i.isAAC||(b.mpeg?(O="audio/mpeg",i.codec=""):b.mp3&&(i.codec="mp3")),_.audio={id:"audio",container:O,codec:i.codec,initSegment:!i.isAAC&&b.mpeg?new Uint8Array(0):L.default.initSegment([i]),metadata:{channelCount:i.channelCount}},I&&(r=i.inputTimeScale,g=p=n[0].pts-Math.round(r*v))),s.sps&&s.pps&&h.length&&(s.timescale=s.inputTimeScale,_.video={id:"main",container:"video/mp4",codec:s.codec,initSegment:L.default.initSegment([s]),metadata:{width:s.width,height:s.height}},I)){r=s.inputTimeScale;var C=this.getVideoStartPts(h),x=Math.round(r*v);p=Math.min(p,t(h[0].dts,C)-x),g=Math.min(g,C-x)}if(Object.keys(_).length)return this.ISGenerated=!0,I&&(this._initPTS=g,this._initDTS=p),{tracks:_,initPTS:g,timescale:r}},u.remuxVideo=function(i,s,v,g){var p,r,n,h=i.inputTimeScale,b=i.samples,_=[],I=b.length,O=this._initPTS,C=this.nextAvcDts,x=8,P=Number.POSITIVE_INFINITY,N=Number.NEGATIVE_INFINITY,M=0,B=!1;v&&C!==null||(C=s*h-(b[0].pts-t(b[0].dts,b[0].pts)));for(var G=0;G<I;G++){var K=b[G];K.pts=t(K.pts-O,C),K.dts=t(K.dts-O,C),K.dts>K.pts&&(M=Math.max(Math.min(M,K.pts-K.dts),-18e3)),K.dts<b[G>0?G-1:G].dts&&(B=!0)}B&&b.sort(function(Dt,Ut){var qe=Dt.dts-Ut.dts,Xe=Dt.pts-Ut.pts;return qe||Xe}),r=b[0].dts,n=b[b.length-1].dts;var V=Math.round((n-r)/(I-1));if(M<0){if(M<-2*V){D.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(S.toMsFromMpegTsClock)(-V,!0)+" ms");for(var H=M,W=0;W<I;W++)b[W].dts=H=Math.max(H,b[W].pts-V),b[W].pts=Math.max(H,b[W].pts)}else{D.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(S.toMsFromMpegTsClock)(M,!0)+" ms to overcome this issue");for(var Y=0;Y<I;Y++)b[Y].dts=b[Y].dts+M}r=b[0].dts}if(v){var X=r-C,tt=X>V;if(tt||X<-1){tt?D.logger.warn("AVC: "+Object(S.toMsFromMpegTsClock)(X,!0)+" ms ("+X+"dts) hole between fragments detected, filling it"):D.logger.warn("AVC: "+Object(S.toMsFromMpegTsClock)(-X,!0)+" ms ("+X+"dts) overlapping between fragments detected"),r=C;var et=b[0].pts-X;b[0].dts=r,b[0].pts=et,D.logger.log("Video: First PTS/DTS adjusted: "+Object(S.toMsFromMpegTsClock)(et,!0)+"/"+Object(S.toMsFromMpegTsClock)(r,!0)+", delta: "+Object(S.toMsFromMpegTsClock)(X,!0)+" ms")}}E&&(r=Math.max(0,r));for(var nt=0,J=0,st=0;st<I;st++){for(var Z=b[st],rt=Z.units,ot=rt.length,at=0,gt=0;gt<ot;gt++)at+=rt[gt].data.length;J+=at,nt+=ot,Z.length=at,Z.dts=Math.max(Z.dts,r),Z.pts=Math.max(Z.pts,Z.dts,0),P=Math.min(Z.pts,P),N=Math.max(Z.pts,N)}n=b[I-1].dts;var Et,Tt=J+4*nt+8;try{Et=new Uint8Array(Tt)}catch{return void this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:w.ErrorTypes.MUX_ERROR,details:w.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Tt,reason:"fail allocating video mdat "+Tt})}var At=new DataView(Et.buffer);At.setUint32(0,Tt),Et.set(L.default.types.mdat,4);for(var ft=0;ft<I;ft++){for(var dt=b[ft],Kt=dt.units,kt=0,xt=0,Vt=Kt.length;xt<Vt;xt++){var Mt=Kt[xt],It=Mt.data,$t=Mt.data.byteLength;At.setUint32(x,$t),x+=4,Et.set(It,x),x+=$t,kt+=4+$t}if(ft<I-1)p=b[ft+1].dts-dt.dts;else{var Ht=this.config,Rt=dt.dts-b[ft>0?ft-1:ft].dts;if(Ht.stretchShortVideoTrack&&this.nextAudioPts!==null){var Qt=Math.floor(Ht.maxBufferHole*h),Wt=(g?P+g*h:this.nextAudioPts)-dt.pts;Wt>Qt?((p=Wt-Rt)<0&&(p=Rt),D.logger.log("[mp4-remuxer]: It is approximately "+Wt/90+" ms to the next segment; using duration "+p/90+" ms for the last video frame.")):p=Rt}else p=Rt}var Nt=Math.round(dt.pts-dt.dts);_.push(new a(dt.key,p,kt,Nt))}if(_.length&&f&&f<70){var Pt=_[0].flags;Pt.dependsOn=2,Pt.isNonSync=0}console.assert(p!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=C=n+p,this.isVideoContiguous=!0;var Bt={data1:L.default.moof(i.sequenceNumber++,r,m({},i,{samples:_})),data2:Et,startPTS:P/h,endPTS:(N+p)/h,startDTS:r/h,endDTS:C/h,type:"video",hasAudio:!1,hasVideo:!0,nb:_.length,dropped:i.dropped};return i.samples=[],i.dropped=0,console.assert(Et.length,"MDAT length must not be zero"),Bt},u.remuxAudio=function(i,s,v,g,p){var r=i.inputTimeScale,n=r/(i.samplerate?i.samplerate:r),h=i.isAAC?1024:1152,b=h*n,_=this._initPTS,I=!i.isAAC&&this.typeSupported.mpeg,O=[],C=i.samples,x=I?0:8,P=this.nextAudioPts||-1,N=s*r;if(this.isAudioContiguous=v=v||C.length&&P>0&&(g&&Math.abs(N-P)<9e3||Math.abs(t(C[0].pts-_,N)-P)<20*b),C.forEach(function(It){It.pts=t(It.pts-_,N)}),!v||P<0){if(!(C=C.filter(function(It){return It.pts>=0})).length)return;P=p===0?0:g?Math.max(0,N):C[0].pts}if(i.isAAC)for(var M=p!==void 0,B=this.config.maxAudioFramesDrift,G=0,K=P;G<C.length;G++){var V=C[G],H=V.pts,W=H-K,Y=Math.abs(1e3*W/r);if(W<=-B*b&&M)G===0&&(D.logger.warn("Audio frame @ "+(H/r).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*W/r)+" ms."),this.nextAudioPts=P=K=H);else if(W>=B*b&&Y<1e4&&M){var X=Math.round(W/b);(K=H-X*b)<0&&(X--,K+=b),G===0&&(this.nextAudioPts=P=K),D.logger.warn("[mp4-remuxer]: Injecting "+X+" audio frame @ "+(K/r).toFixed(3)+"s due to "+Math.round(1e3*W/r)+" ms gap.");for(var tt=0;tt<X;tt++){var et=Math.max(K,0),nt=y.default.getSilentFrame(i.manifestCodec||i.codec,i.channelCount);nt||(D.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),nt=V.unit.subarray()),C.splice(G,0,{unit:nt,pts:et}),K+=b,G++}}V.pts=K,K+=b}for(var J,st=null,Z=null,rt=0,ot=C.length;ot--;)rt+=C[ot].unit.byteLength;for(var at=0,gt=C.length;at<gt;at++){var Et=C[at],Tt=Et.unit,At=Et.pts;if(Z!==null)O[at-1].duration=Math.round((At-Z)/n);else{if(v&&i.isAAC&&(At=P),st=At,!(rt>0))return;rt+=x;try{J=new Uint8Array(rt)}catch{return void this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:w.ErrorTypes.MUX_ERROR,details:w.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:rt,reason:"fail allocating audio mdat "+rt})}I||(new DataView(J.buffer).setUint32(0,rt),J.set(L.default.types.mdat,4))}J.set(Tt,x);var ft=Tt.byteLength;x+=ft,O.push(new a(!0,h,ft,0)),Z=At}var dt=O.length;if(dt){var Kt=O[O.length-1];this.nextAudioPts=P=Z+n*Kt.duration;var kt=I?new Uint8Array(0):L.default.moof(i.sequenceNumber++,st/n,m({},i,{samples:O}));i.samples=[];var xt=st/r,Vt=P/r,Mt={data1:kt,data2:J,startPTS:xt,endPTS:Vt,startDTS:xt,endDTS:Vt,type:"audio",hasAudio:!0,hasVideo:!1,nb:dt};return this.isAudioContiguous=!0,console.assert(J.length,"MDAT length must not be zero"),Mt}},u.remuxEmptyAudio=function(i,s,v,g){var p=i.inputTimeScale,r=p/(i.samplerate?i.samplerate:p),n=this.nextAudioPts,h=(n!==null?n:g.startDTS*p)+this._initDTS,b=g.endDTS*p+this._initDTS,_=1024*r,I=Math.ceil((b-h)/_),O=y.default.getSilentFrame(i.manifestCodec||i.codec,i.channelCount);if(D.logger.warn("[mp4-remuxer]: remux empty Audio"),O){for(var C=[],x=0;x<I;x++){var P=h+x*_;C.push({unit:O,pts:P,dts:P})}return i.samples=C,this.remuxAudio(i,s,v,!1)}D.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},u.remuxID3=function(i,s){var v=i.samples.length;if(v){for(var g=i.inputTimeScale,p=this._initPTS,r=this._initDTS,n=0;n<v;n++){var h=i.samples[n];h.pts=t(h.pts-p,s*g)/g,h.dts=t(h.dts-r,s*g)/g}var b=i.samples;return i.samples=[],{samples:b}}},u.remuxText=function(i,s){var v=i.samples.length;if(v){for(var g=i.inputTimeScale,p=this._initPTS,r=0;r<v;r++){var n=i.samples[r];n.pts=t(n.pts-p,s*g)/g}i.samples.sort(function(b,_){return b.pts-_.pts});var h=i.samples;return i.samples=[],{samples:h}}},l}();function t(l,u){var i;if(u===null)return l;for(i=u<l?-8589934592:8589934592;Math.abs(l-u)>4294967296;)l+=i;return l}var a=function(l,u,i,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=u,this.size=i,this.cts=s,this.flags=new e(l)},e=function(l){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=l?2:1,this.isNonSync=l?0:1}},"./src/remux/passthrough-remuxer.ts":function(F,R,d){d.r(R);var A=d("./src/polyfills/number.ts"),y=d("./src/utils/mp4-tools.ts"),L=d("./src/loader/fragment.ts"),k=d("./src/utils/logger.ts"),w=function(){function S(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var m=S.prototype;return m.destroy=function(){},m.resetTimeStamp=function(f){this.initPTS=f,this.lastEndDTS=null},m.resetNextTimestamp=function(){this.lastEndDTS=null},m.resetInitSegment=function(f,T,E){this.audioCodec=T,this.videoCodec=E,this.generateInitSegment(f),this.emitInitSegment=!0},m.generateInitSegment=function(f){var T=this.audioCodec,E=this.videoCodec;if(!f||!f.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var c=this.initData=Object(y.parseInitSegment)(f);T||(T=o(c.audio,L.ElementaryStreamTypes.AUDIO)),E||(E=o(c.video,L.ElementaryStreamTypes.VIDEO));var t={};c.audio&&c.video?t.audiovideo={container:"video/mp4",codec:T+","+E,initSegment:f,id:"main"}:c.audio?t.audio={container:"audio/mp4",codec:T,initSegment:f,id:"audio"}:c.video?t.video={container:"video/mp4",codec:E,initSegment:f,id:"main"}:k.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=t},m.remux=function(f,T,E,c,t){var a=this.initPTS,e=this.lastEndDTS,l={audio:void 0,video:void 0,text:c,id3:E,initSegment:void 0};Object(A.isFiniteNumber)(e)||(e=this.lastEndDTS=t||0);var u=T.samples;if(!u||!u.length)return l;var i={initPTS:void 0,timescale:1},s=this.initData;if(s&&s.length||(this.generateInitSegment(u),s=this.initData),!s||!s.length)return k.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),l;this.emitInitSegment&&(i.tracks=this.initTracks,this.emitInitSegment=!1),Object(A.isFiniteNumber)(a)||(this.initPTS=i.initPTS=a=D(s,u,e));var v=Object(y.getDuration)(u,s),g=e,p=v+g;Object(y.offsetStartDTS)(s,u,a),v>0?this.lastEndDTS=p:(k.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var r=!!s.audio,n=!!s.video,h="";r&&(h+="audio"),n&&(h+="video");var b={data1:u,startPTS:g,startDTS:g,endPTS:p,endDTS:p,type:h,hasAudio:r,hasVideo:n,nb:1,dropped:0};return l.audio=b.type==="audio"?b:void 0,l.video=b.type!=="audio"?b:void 0,l.text=c,l.id3=E,l.initSegment=i,l},S}(),D=function(S,m,f){return Object(y.getStartDTS)(S,m)-f};function o(S,m){var f=S==null?void 0:S.codec;return f&&f.length>4?f:f==="hvc1"?"hvc1.1.c.L120.90":f==="av01"?"av01.0.04M.08":f==="avc1"||m===L.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}R.default=w},"./src/task-loop.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return A});var A=function(){function y(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var L=y.prototype;return L.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},L.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},L.onHandlerDestroyed=function(){},L.hasInterval=function(){return!!this._tickInterval},L.hasNextTick=function(){return!!this._tickTimer},L.setInterval=function(k){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,k),!0)},L.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},L.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},L.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},L.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},L.doTick=function(){},y}()},"./src/types/level.ts":function(F,R,d){function A(o,S){for(var m=0;m<S.length;m++){var f=S[m];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(o,f.key,f)}}var y,L;function k(o,S){var m=o.canSkipUntil,f=o.canSkipDateRanges,T=o.endSN;return m&&(S!==void 0?S-T:0)<m?f?y.v2:y.Yes:y.No}d.r(R),d.d(R,"HlsSkip",function(){return y}),d.d(R,"getSkipValue",function(){return k}),d.d(R,"HlsUrlParameters",function(){return w}),d.d(R,"Level",function(){return D}),(L=y||(y={})).No="",L.Yes="YES",L.v2="v2";var w=function(){function o(S,m,f){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=S,this.part=m,this.skip=f}return o.prototype.addDirectives=function(S){var m=new self.URL(S);return this.msn!==void 0&&m.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&m.searchParams.set("_HLS_part",this.part.toString()),this.skip&&m.searchParams.set("_HLS_skip",this.skip),m.toString()},o}(),D=function(){function o(f){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[f.url],this.attrs=f.attrs,this.bitrate=f.bitrate,f.details&&(this.details=f.details),this.id=f.id||0,this.name=f.name,this.width=f.width||0,this.height=f.height||0,this.audioCodec=f.audioCodec,this.videoCodec=f.videoCodec,this.unknownCodecs=f.unknownCodecs,this.codecSet=[f.videoCodec,f.audioCodec].filter(function(T){return T}).join(",").replace(/\.[^.,]+/g,"")}var S,m;return S=o,(m=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(f){var T=f%this.url.length;this._urlId!==T&&(this.details=void 0,this._urlId=T)}}])&&A(S.prototype,m),o}()},"./src/types/loader.ts":function(F,R,d){var A,y,L,k;d.r(R),d.d(R,"PlaylistContextType",function(){return A}),d.d(R,"PlaylistLevelType",function(){return L}),(y=A||(A={})).MANIFEST="manifest",y.LEVEL="level",y.AUDIO_TRACK="audioTrack",y.SUBTITLE_TRACK="subtitleTrack",(k=L||(L={})).MAIN="main",k.AUDIO="audio",k.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(F,R,d){d.r(R),d.d(R,"ChunkMetadata",function(){return A});var A=function(y,L,k,w,D,o){w===void 0&&(w=0),D===void 0&&(D=-1),o===void 0&&(o=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=y,this.sn=L,this.id=k,this.size=w,this.part=D,this.partial=o}},"./src/utils/attr-list.ts":function(F,R,d){d.r(R),d.d(R,"AttrList",function(){return L});var A=/^(\d+)x(\d+)$/,y=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,L=function(){function k(D){for(var o in typeof D=="string"&&(D=k.parseAttrList(D)),D)D.hasOwnProperty(o)&&(this[o]=D[o])}var w=k.prototype;return w.decimalInteger=function(D){var o=parseInt(this[D],10);return o>Number.MAX_SAFE_INTEGER?1/0:o},w.hexadecimalInteger=function(D){if(this[D]){var o=(this[D]||"0x").slice(2);o=(1&o.length?"0":"")+o;for(var S=new Uint8Array(o.length/2),m=0;m<o.length/2;m++)S[m]=parseInt(o.slice(2*m,2*m+2),16);return S}return null},w.hexadecimalIntegerAsNumber=function(D){var o=parseInt(this[D],16);return o>Number.MAX_SAFE_INTEGER?1/0:o},w.decimalFloatingPoint=function(D){return parseFloat(this[D])},w.optionalFloat=function(D,o){var S=this[D];return S?parseFloat(S):o},w.enumeratedString=function(D){return this[D]},w.bool=function(D){return this[D]==="YES"},w.decimalResolution=function(D){var o=A.exec(this[D]);if(o!==null)return{width:parseInt(o[1],10),height:parseInt(o[2],10)}},k.parseAttrList=function(D){var o,S={};for(y.lastIndex=0;(o=y.exec(D))!==null;){var m=o[2];m.indexOf('"')===0&&m.lastIndexOf('"')===m.length-1&&(m=m.slice(1,-1)),S[o[1]]=m}return S},k}()},"./src/utils/binary-search.ts":function(F,R,d){d.r(R),R.default={search:function(A,y){for(var L=0,k=A.length-1,w=null,D=null;L<=k;){var o=y(D=A[w=(L+k)/2|0]);if(o>0)L=w+1;else{if(!(o<0))return D;k=w-1}}return null}}},"./src/utils/buffer-helper.ts":function(F,R,d){d.r(R),d.d(R,"BufferHelper",function(){return L});var A=d("./src/utils/logger.ts"),y={length:0,start:function(){return 0},end:function(){return 0}},L=function(){function k(){}return k.isBuffered=function(w,D){try{if(w){for(var o=k.getBuffered(w),S=0;S<o.length;S++)if(D>=o.start(S)&&D<=o.end(S))return!0}}catch{}return!1},k.bufferInfo=function(w,D,o){try{if(w){var S,m=k.getBuffered(w),f=[];for(S=0;S<m.length;S++)f.push({start:m.start(S),end:m.end(S)});return this.bufferedInfo(f,D,o)}}catch{}return{len:0,start:D,end:D,nextStart:void 0}},k.bufferedInfo=function(w,D,o){D=Math.max(0,D),w.sort(function(i,s){var v=i.start-s.start;return v||s.end-i.end});var S=[];if(o)for(var m=0;m<w.length;m++){var f=S.length;if(f){var T=S[f-1].end;w[m].start-T<o?w[m].end>T&&(S[f-1].end=w[m].end):S.push(w[m])}else S.push(w[m])}else S=w;for(var E,c=0,t=D,a=D,e=0;e<S.length;e++){var l=S[e].start,u=S[e].end;if(D+o>=l&&D<u)t=l,c=(a=u)-D;else if(D+o<l){E=l;break}}return{len:c,start:t||0,end:a||0,nextStart:E}},k.getBuffered=function(w){try{return w.buffered}catch(D){return A.logger.log("failed to get media.buffered",D),y}},k}()},"./src/utils/cea-608-parser.ts":function(F,R,d){d.r(R),d.d(R,"Row",function(){return l}),d.d(R,"CaptionScreen",function(){return u});var A,y,L=d("./src/utils/logger.ts"),k={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},w=function(p){var r=p;return k.hasOwnProperty(p)&&(r=k[p]),String.fromCharCode(r)},D=15,o=100,S={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},m={17:2,18:4,21:6,22:8,23:10,19:13,20:15},f={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},T={25:2,26:4,29:6,30:8,31:10,27:13,28:15},E=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(y=A||(A={}))[y.ERROR=0]="ERROR",y[y.TEXT=1]="TEXT",y[y.WARNING=2]="WARNING",y[y.INFO=2]="INFO",y[y.DEBUG=3]="DEBUG",y[y.DATA=3]="DATA";var c=function(){function p(){this.time=null,this.verboseLevel=A.ERROR}return p.prototype.log=function(r,n){this.verboseLevel>=r&&L.logger.log(this.time+" ["+r+"] "+n)},p}(),t=function(p){for(var r=[],n=0;n<p.length;n++)r.push(p[n].toString(16));return r},a=function(){function p(n,h,b,_,I){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=n||"white",this.underline=h||!1,this.italics=b||!1,this.background=_||"black",this.flash=I||!1}var r=p.prototype;return r.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},r.setStyles=function(n){for(var h=["foreground","underline","italics","background","flash"],b=0;b<h.length;b++){var _=h[b];n.hasOwnProperty(_)&&(this[_]=n[_])}},r.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},r.equals=function(n){return this.foreground===n.foreground&&this.underline===n.underline&&this.italics===n.italics&&this.background===n.background&&this.flash===n.flash},r.copy=function(n){this.foreground=n.foreground,this.underline=n.underline,this.italics=n.italics,this.background=n.background,this.flash=n.flash},r.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},p}(),e=function(){function p(n,h,b,_,I,O){this.uchar=void 0,this.penState=void 0,this.uchar=n||" ",this.penState=new a(h,b,_,I,O)}var r=p.prototype;return r.reset=function(){this.uchar=" ",this.penState.reset()},r.setChar=function(n,h){this.uchar=n,this.penState.copy(h)},r.setPenState=function(n){this.penState.copy(n)},r.equals=function(n){return this.uchar===n.uchar&&this.penState.equals(n.penState)},r.copy=function(n){this.uchar=n.uchar,this.penState.copy(n.penState)},r.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},p}(),l=function(){function p(n){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var h=0;h<o;h++)this.chars.push(new e);this.logger=n,this.pos=0,this.currPenState=new a}var r=p.prototype;return r.equals=function(n){for(var h=!0,b=0;b<o;b++)if(!this.chars[b].equals(n.chars[b])){h=!1;break}return h},r.copy=function(n){for(var h=0;h<o;h++)this.chars[h].copy(n.chars[h])},r.isEmpty=function(){for(var n=!0,h=0;h<o;h++)if(!this.chars[h].isEmpty()){n=!1;break}return n},r.setCursor=function(n){this.pos!==n&&(this.pos=n),this.pos<0?(this.logger.log(A.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>o&&(this.logger.log(A.DEBUG,"Too large cursor position "+this.pos),this.pos=o)},r.moveCursor=function(n){var h=this.pos+n;if(n>1)for(var b=this.pos+1;b<h+1;b++)this.chars[b].setPenState(this.currPenState);this.setCursor(h)},r.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},r.insertChar=function(n){n>=144&&this.backSpace();var h=w(n);this.pos>=o?this.logger.log(A.ERROR,"Cannot insert "+n.toString(16)+" ("+h+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(h,this.currPenState),this.moveCursor(1))},r.clearFromPos=function(n){var h;for(h=n;h<o;h++)this.chars[h].reset()},r.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},r.clearToEndOfRow=function(){this.clearFromPos(this.pos)},r.getTextString=function(){for(var n=[],h=!0,b=0;b<o;b++){var _=this.chars[b].uchar;_!==" "&&(h=!1),n.push(_)}return h?"":n.join("")},r.setPenStyles=function(n){this.currPenState.setStyles(n),this.chars[this.pos].setPenState(this.currPenState)},p}(),u=function(){function p(n){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var h=0;h<D;h++)this.rows.push(new l(n));this.logger=n,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var r=p.prototype;return r.reset=function(){for(var n=0;n<D;n++)this.rows[n].clear();this.currRow=14},r.equals=function(n){for(var h=!0,b=0;b<D;b++)if(!this.rows[b].equals(n.rows[b])){h=!1;break}return h},r.copy=function(n){for(var h=0;h<D;h++)this.rows[h].copy(n.rows[h])},r.isEmpty=function(){for(var n=!0,h=0;h<D;h++)if(!this.rows[h].isEmpty()){n=!1;break}return n},r.backSpace=function(){this.rows[this.currRow].backSpace()},r.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},r.insertChar=function(n){this.rows[this.currRow].insertChar(n)},r.setPen=function(n){this.rows[this.currRow].setPenStyles(n)},r.moveCursor=function(n){this.rows[this.currRow].moveCursor(n)},r.setCursor=function(n){this.logger.log(A.INFO,"setCursor: "+n),this.rows[this.currRow].setCursor(n)},r.setPAC=function(n){this.logger.log(A.INFO,"pacData = "+JSON.stringify(n));var h=n.row-1;if(this.nrRollUpRows&&h<this.nrRollUpRows-1&&(h=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==h){for(var b=0;b<D;b++)this.rows[b].clear();var _=this.currRow+1-this.nrRollUpRows,I=this.lastOutputScreen;if(I){var O=I.rows[_].cueStartTime,C=this.logger.time;if(O&&C!==null&&O<C)for(var x=0;x<this.nrRollUpRows;x++)this.rows[h-this.nrRollUpRows+x+1].copy(I.rows[_+x])}}this.currRow=h;var P=this.rows[this.currRow];if(n.indent!==null){var N=n.indent,M=Math.max(N-1,0);P.setCursor(n.indent),n.color=P.chars[M].penState.foreground}var B={foreground:n.color,underline:n.underline,italics:n.italics,background:"black",flash:!1};this.setPen(B)},r.setBkgData=function(n){this.logger.log(A.INFO,"bkgData = "+JSON.stringify(n)),this.backSpace(),this.setPen(n),this.insertChar(32)},r.setRollUpRows=function(n){this.nrRollUpRows=n},r.rollUp=function(){if(this.nrRollUpRows!==null){this.logger.log(A.TEXT,this.getDisplayText());var n=this.currRow+1-this.nrRollUpRows,h=this.rows.splice(n,1)[0];h.clear(),this.rows.splice(this.currRow,0,h),this.logger.log(A.INFO,"Rolling up")}else this.logger.log(A.DEBUG,"roll_up but nrRollUpRows not set yet")},r.getDisplayText=function(n){n=n||!1;for(var h=[],b="",_=-1,I=0;I<D;I++){var O=this.rows[I].getTextString();O&&(_=I+1,n?h.push("Row "+_+": '"+O+"'"):h.push(O.trim()))}return h.length>0&&(b=n?"["+h.join(" | ")+"]":h.join(`
`)),b},r.getTextAndFormat=function(){return this.rows},p}(),i=function(){function p(n,h,b){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=n,this.outputFilter=h,this.mode=null,this.verbose=0,this.displayedMemory=new u(b),this.nonDisplayedMemory=new u(b),this.lastOutputScreen=new u(b),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=b}var r=p.prototype;return r.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},r.getHandler=function(){return this.outputFilter},r.setHandler=function(n){this.outputFilter=n},r.setPAC=function(n){this.writeScreen.setPAC(n)},r.setBkgData=function(n){this.writeScreen.setBkgData(n)},r.setMode=function(n){n!==this.mode&&(this.mode=n,this.logger.log(A.INFO,"MODE="+n),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=n)},r.insertChars=function(n){for(var h=0;h<n.length;h++)this.writeScreen.insertChar(n[h]);var b=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(A.INFO,b+": "+this.writeScreen.getDisplayText(!0)),this.mode!=="MODE_PAINT-ON"&&this.mode!=="MODE_ROLL-UP"||(this.logger.log(A.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},r.ccRCL=function(){this.logger.log(A.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},r.ccBS=function(){this.logger.log(A.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},r.ccAOF=function(){},r.ccAON=function(){},r.ccDER=function(){this.logger.log(A.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},r.ccRU=function(n){this.logger.log(A.INFO,"RU("+n+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(n)},r.ccFON=function(){this.logger.log(A.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},r.ccRDC=function(){this.logger.log(A.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},r.ccTR=function(){this.logger.log(A.INFO,"TR"),this.setMode("MODE_TEXT")},r.ccRTD=function(){this.logger.log(A.INFO,"RTD"),this.setMode("MODE_TEXT")},r.ccEDM=function(){this.logger.log(A.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},r.ccCR=function(){this.logger.log(A.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},r.ccENM=function(){this.logger.log(A.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},r.ccEOC=function(){if(this.logger.log(A.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var n=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=n,this.writeScreen=this.nonDisplayedMemory,this.logger.log(A.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},r.ccTO=function(n){this.logger.log(A.INFO,"TO("+n+") - Tab Offset"),this.writeScreen.moveCursor(n)},r.ccMIDROW=function(n){var h={flash:!1};if(h.underline=n%2==1,h.italics=n>=46,h.italics)h.foreground="white";else{var b=Math.floor(n/2)-16;h.foreground=["white","green","blue","cyan","red","yellow","magenta"][b]}this.logger.log(A.INFO,"MIDROW: "+JSON.stringify(h)),this.writeScreen.setPen(h)},r.outputDataUpdate=function(n){n===void 0&&(n=!1);var h=this.logger.time;h!==null&&this.outputFilter&&(this.cueStartTime!==null||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,h,this.lastOutputScreen),n&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:h):this.cueStartTime=h,this.lastOutputScreen.copy(this.displayedMemory))},r.cueSplitAtTime=function(n){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,n,this.displayedMemory),this.cueStartTime=n))},p}(),s=function(){function p(n,h,b){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var _=new c;this.channels=[null,new i(n,h,_),new i(n+1,b,_)],this.cmdHistory={a:null,b:null},this.logger=_}var r=p.prototype;return r.getHandler=function(n){return this.channels[n].getHandler()},r.setHandler=function(n,h){this.channels[n].setHandler(h)},r.addData=function(n,h){var b,_,I,O=!1;this.logger.time=n;for(var C=0;C<h.length;C+=2)if(_=127&h[C],I=127&h[C+1],_!==0||I!==0){if(this.logger.log(A.DATA,"["+t([h[C],h[C+1]])+"] -> ("+t([_,I])+")"),(b=this.parseCmd(_,I))||(b=this.parseMidrow(_,I)),b||(b=this.parsePAC(_,I)),b||(b=this.parseBackgroundAttributes(_,I)),!b&&(O=this.parseChars(_,I))){var x=this.currentChannel;x&&x>0?this.channels[x].insertChars(O):this.logger.log(A.WARNING,"No channel found yet. TEXT-MODE?")}b||O||this.logger.log(A.WARNING,"Couldn't parse cleaned data "+t([_,I])+" orig: "+t([h[C],h[C+1]]))}},r.parseCmd=function(n,h){var b=this.cmdHistory;if(!((n===20||n===28||n===21||n===29)&&h>=32&&h<=47||(n===23||n===31)&&h>=33&&h<=35))return!1;if(g(n,h,b))return v(null,null,b),this.logger.log(A.DEBUG,"Repeated command ("+t([n,h])+") is dropped"),!0;var _=n===20||n===21||n===23?1:2,I=this.channels[_];return n===20||n===21||n===28||n===29?h===32?I.ccRCL():h===33?I.ccBS():h===34?I.ccAOF():h===35?I.ccAON():h===36?I.ccDER():h===37?I.ccRU(2):h===38?I.ccRU(3):h===39?I.ccRU(4):h===40?I.ccFON():h===41?I.ccRDC():h===42?I.ccTR():h===43?I.ccRTD():h===44?I.ccEDM():h===45?I.ccCR():h===46?I.ccENM():h===47&&I.ccEOC():I.ccTO(h-32),v(n,h,b),this.currentChannel=_,!0},r.parseMidrow=function(n,h){var b=0;if((n===17||n===25)&&h>=32&&h<=47){if((b=n===17?1:2)!==this.currentChannel)return this.logger.log(A.ERROR,"Mismatch channel in midrow parsing"),!1;var _=this.channels[b];return!!_&&(_.ccMIDROW(h),this.logger.log(A.DEBUG,"MIDROW ("+t([n,h])+")"),!0)}return!1},r.parsePAC=function(n,h){var b,_=this.cmdHistory;if(!((n>=17&&n<=23||n>=25&&n<=31)&&h>=64&&h<=127||(n===16||n===24)&&h>=64&&h<=95))return!1;if(g(n,h,_))return v(null,null,_),!0;var I=n<=23?1:2;b=h>=64&&h<=95?I===1?S[n]:f[n]:I===1?m[n]:T[n];var O=this.channels[I];return!!O&&(O.setPAC(this.interpretPAC(b,h)),v(n,h,_),this.currentChannel=I,!0)},r.interpretPAC=function(n,h){var b,_={color:null,italics:!1,indent:null,underline:!1,row:n};return b=h>95?h-96:h-64,_.underline=(1&b)==1,b<=13?_.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(b/2)]:b<=15?(_.italics=!0,_.color="white"):_.indent=4*Math.floor((b-16)/2),_},r.parseChars=function(n,h){var b,_,I=null,O=null;if(n>=25?(b=2,O=n-8):(b=1,O=n),O>=17&&O<=19?(_=O===17?h+80:O===18?h+112:h+144,this.logger.log(A.INFO,"Special char '"+w(_)+"' in channel "+b),I=[_]):n>=32&&n<=127&&(I=h===0?[n]:[n,h]),I){var C=t(I);this.logger.log(A.DEBUG,"Char codes =  "+C.join(",")),v(n,h,this.cmdHistory)}return I},r.parseBackgroundAttributes=function(n,h){var b;if(!((n===16||n===24)&&h>=32&&h<=47||(n===23||n===31)&&h>=45&&h<=47))return!1;var _={};n===16||n===24?(b=Math.floor((h-32)/2),_.background=E[b],h%2==1&&(_.background=_.background+"_semi")):h===45?_.background="transparent":(_.foreground="black",h===47&&(_.underline=!0));var I=n<=23?1:2;return this.channels[I].setBkgData(_),v(n,h,this.cmdHistory),!0},r.reset=function(){for(var n=0;n<Object.keys(this.channels).length;n++){var h=this.channels[n];h&&h.reset()}this.cmdHistory={a:null,b:null}},r.cueSplitAtTime=function(n){for(var h=0;h<this.channels.length;h++){var b=this.channels[h];b&&b.cueSplitAtTime(n)}},p}();function v(p,r,n){n.a=p,n.b=r}function g(p,r,n){return n.a===p&&n.b===r}R.default=s},"./src/utils/codecs.ts":function(F,R,d){d.r(R),d.d(R,"isCodecType",function(){return y}),d.d(R,"isCodecSupportedInMp4",function(){return L});var A={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function y(k,w){var D=A[w];return!!D&&D[k.slice(0,4)]===!0}function L(k,w){return MediaSource.isTypeSupported((w||"video")+'/mp4;codecs="'+k+'"')}},"./src/utils/cues.ts":function(F,R,d){d.r(R);var A=d("./src/utils/vttparser.ts"),y=d("./src/utils/webvtt-parser.ts"),L=d("./src/utils/texttrack-utils.ts"),k=/\s/,w={newCue:function(D,o,S,m){for(var f,T,E,c,t,a=[],e=self.VTTCue||self.TextTrackCue,l=0;l<m.rows.length;l++)if(E=!0,c=0,t="",!(f=m.rows[l]).isEmpty()){for(var u=0;u<f.chars.length;u++)k.test(f.chars[u].uchar)&&E?c++:(t+=f.chars[u].uchar,E=!1);f.cueStartTime=o,o===S&&(S+=1e-4),c>=16?c--:c++;var i=Object(A.fixLineBreaks)(t.trim()),s=Object(y.generateCueId)(o,S,i);D&&D.cues&&D.cues.getCueById(s)||((T=new e(o,S,i)).id=s,T.line=l+1,T.align="left",T.position=10+Math.min(80,10*Math.floor(8*c/32)),a.push(T))}return D&&a.length&&(a.sort(function(v,g){return v.line==="auto"||g.line==="auto"?0:v.line>8&&g.line>8?g.line-v.line:v.line-g.line}),a.forEach(function(v){return Object(L.addCueToTrack)(D,v)})),a}};R.default=w},"./src/utils/discontinuities.ts":function(F,R,d){d.r(R),d.d(R,"findFirstFragWithCC",function(){return k}),d.d(R,"shouldAlignOnDiscontinuities",function(){return w}),d.d(R,"findDiscontinuousReferenceFrag",function(){return D}),d.d(R,"adjustSlidingStart",function(){return S}),d.d(R,"alignStream",function(){return m}),d.d(R,"alignPDT",function(){return f});var A=d("./src/polyfills/number.ts"),y=d("./src/utils/logger.ts"),L=d("./src/controller/level-helper.ts");function k(T,E){for(var c=null,t=0,a=T.length;t<a;t++){var e=T[t];if(e&&e.cc===E){c=e;break}}return c}function w(T,E,c){return!(!E.details||!(c.endCC>c.startCC||T&&T.cc<c.startCC))}function D(T,E){var c=T.fragments,t=E.fragments;if(t.length&&c.length){var a=k(c,t[0].cc);if(a&&(!a||a.startPTS))return a;y.logger.log("No frag in previous level to align on")}else y.logger.log("No fragments to align")}function o(T,E){if(T){var c=T.start+E;T.start=T.startPTS=c,T.endPTS=c+T.duration}}function S(T,E){for(var c=E.fragments,t=0,a=c.length;t<a;t++)o(c[t],T);E.fragmentHint&&o(E.fragmentHint,T),E.alignedSliding=!0}function m(T,E,c){E&&(function(t,a,e){if(w(t,e,a)){var l=D(e.details,a);l&&Object(A.isFiniteNumber)(l.start)&&(y.logger.log("Adjusting PTS using last level due to CC increase within current level "+a.url),S(l.start,a))}}(T,c,E),!c.alignedSliding&&E.details&&f(c,E.details),c.alignedSliding||!E.details||c.skippedSegments||Object(L.adjustSliding)(E.details,c))}function f(T,E){if(E.fragments.length&&T.hasProgramDateTime&&E.hasProgramDateTime){var c=E.fragments[0].programDateTime,t=T.fragments[0].programDateTime,a=(t-c)/1e3+E.fragments[0].start;a&&Object(A.isFiniteNumber)(a)&&(y.logger.log("Adjusting PTS using programDateTime delta "+(t-c)+"ms, sliding:"+a.toFixed(3)+" "+T.url+" "),S(a,T))}}},"./src/utils/ewma-bandwidth-estimator.ts":function(F,R,d){d.r(R);var A=d("./src/utils/ewma.ts"),y=function(){function L(w,D,o){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=o,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new A.default(w),this.fast_=new A.default(D)}var k=L.prototype;return k.update=function(w,D){var o=this.slow_,S=this.fast_;this.slow_.halfLife!==w&&(this.slow_=new A.default(w,o.getEstimate(),o.getTotalWeight())),this.fast_.halfLife!==D&&(this.fast_=new A.default(D,S.getEstimate(),S.getTotalWeight()))},k.sample=function(w,D){var o=(w=Math.max(w,this.minDelayMs_))/1e3,S=8*D/o;this.fast_.sample(o,S),this.slow_.sample(o,S)},k.canEstimate=function(){var w=this.fast_;return w&&w.getTotalWeight()>=this.minWeight_},k.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},k.destroy=function(){},L}();R.default=y},"./src/utils/ewma.ts":function(F,R,d){d.r(R);var A=function(){function y(k,w,D){w===void 0&&(w=0),D===void 0&&(D=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=k,this.alpha_=k?Math.exp(Math.log(.5)/k):0,this.estimate_=w,this.totalWeight_=D}var L=y.prototype;return L.sample=function(k,w){var D=Math.pow(this.alpha_,k);this.estimate_=w*(1-D)+D*this.estimate_,this.totalWeight_+=k},L.getTotalWeight=function(){return this.totalWeight_},L.getEstimate=function(){if(this.alpha_){var k=1-Math.pow(this.alpha_,this.totalWeight_);if(k)return this.estimate_/k}return this.estimate_},y}();R.default=A},"./src/utils/fetch-loader.ts":function(F,R,d){d.r(R),d.d(R,"fetchSupported",function(){return m});var A=d("./src/polyfills/number.ts"),y=d("./src/loader/load-stats.ts"),L=d("./src/demux/chunk-cache.ts");function k(c){var t=typeof Map=="function"?new Map:void 0;return(k=function(a){if(a===null||(e=a,Function.toString.call(e).indexOf("[native code]")===-1))return a;var e;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(t!==void 0){if(t.has(a))return t.get(a);t.set(a,l)}function l(){return w(a,arguments,S(this).constructor)}return l.prototype=Object.create(a.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),o(l,a)})(c)}function w(c,t,a){return(w=D()?Reflect.construct:function(e,l,u){var i=[null];i.push.apply(i,l);var s=new(Function.bind.apply(e,i));return u&&o(s,u.prototype),s}).apply(null,arguments)}function D(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function o(c,t){return(o=Object.setPrototypeOf||function(a,e){return a.__proto__=e,a})(c,t)}function S(c){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(c)}function m(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var f=function(){function c(a){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=a.fetchSetup||T,this.controller=new self.AbortController,this.stats=new y.LoadStats}var t=c.prototype;return t.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function(){var a=this.response;a&&a.ok||(this.stats.aborted=!0,this.controller.abort())},t.abort=function(){var a;this.abortInternal(),(a=this.callbacks)!==null&&a!==void 0&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function(a,e,l){var u=this,i=this.stats;if(i.loading.start)throw new Error("Loader can only be used once.");i.loading.start=self.performance.now();var s=function(r,n){var h={method:"GET",mode:"cors",credentials:"same-origin",signal:n};return r.rangeEnd&&(h.headers=new self.Headers({Range:"bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)})),h}(a,this.controller.signal),v=l.onProgress,g=a.responseType==="arraybuffer",p=g?"byteLength":"length";this.context=a,this.config=e,this.callbacks=l,this.request=this.fetchSetup(a,s),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){u.abortInternal(),l.onTimeout(i,a,u.response)},e.timeout),self.fetch(this.request).then(function(r){if(u.response=u.loader=r,!r.ok){var n=r.status,h=r.statusText;throw new E(h||"fetch, bad network response",n,r)}return i.loading.first=Math.max(self.performance.now(),i.loading.start),i.total=parseInt(r.headers.get("Content-Length")||"0"),v&&Object(A.isFiniteNumber)(e.highWaterMark)?u.loadProgressively(r,i,a,e.highWaterMark,v):g?r.arrayBuffer():r.text()}).then(function(r){var n=u.response;self.clearTimeout(u.requestTimeout),i.loading.end=Math.max(self.performance.now(),i.loading.first),i.loaded=i.total=r[p];var h={url:n.url,data:r};v&&!Object(A.isFiniteNumber)(e.highWaterMark)&&v(i,a,r,n),l.onSuccess(h,i,a,n)}).catch(function(r){if(self.clearTimeout(u.requestTimeout),!i.aborted){var n=r.code||0;l.onError({code:n,text:r.message},a,r.details)}})},t.getCacheAge=function(){var a=null;if(this.response){var e=this.response.headers.get("age");a=e?parseFloat(e):null}return a},t.loadProgressively=function(a,e,l,u,i){u===void 0&&(u=0);var s=new L.default,v=a.body.getReader();return function g(){return v.read().then(function(p){if(p.done)return s.dataLength&&i(e,l,s.flush(),a),Promise.resolve(new ArrayBuffer(0));var r=p.value,n=r.length;return e.loaded+=n,n<u||s.dataLength?(s.push(r),s.dataLength>=u&&i(e,l,s.flush(),a)):i(e,l,r,a),g()}).catch(function(){return Promise.reject()})}()},c}();function T(c,t){return new self.Request(c.url,t)}var E=function(c){var t,a;function e(l,u,i){var s;return(s=c.call(this,l)||this).code=void 0,s.details=void 0,s.code=u,s.details=i,s}return a=c,(t=e).prototype=Object.create(a.prototype),t.prototype.constructor=t,o(t,a),e}(k(Error));R.default=f},"./src/utils/imsc1-ttml-parser.ts":function(F,R,d){d.r(R),d.d(R,"IMSC1_CODEC",function(){return S}),d.d(R,"parseIMSC1",function(){return E});var A=d("./src/utils/mp4-tools.ts"),y=d("./src/utils/vttparser.ts"),L=d("./src/utils/vttcue.ts"),k=d("./src/demux/id3.ts"),w=d("./src/utils/timescale-conversion.ts"),D=d("./src/utils/webvtt-parser.ts");function o(){return(o=Object.assign||function(i){for(var s=1;s<arguments.length;s++){var v=arguments[s];for(var g in v)Object.prototype.hasOwnProperty.call(v,g)&&(i[g]=v[g])}return i}).apply(this,arguments)}var S="stpp.ttml.im1t",m=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,f=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,T={left:"start",center:"center",right:"end",start:"start",end:"end"};function E(i,s,v,g,p){var r=Object(A.findBox)(new Uint8Array(i),["mdat"]);if(r.length!==0){var n=r[0],h=Object(k.utf8ArrayToStr)(new Uint8Array(i,n.start,n.end-n.start)),b=Object(w.toTimescaleFromScale)(s,1,v);try{g(function(_,I){var O=new DOMParser().parseFromString(_,"text/xml").getElementsByTagName("tt")[0];if(!O)throw new Error("Invalid ttml");var C={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},x=Object.keys(C).reduce(function(G,K){return G[K]=O.getAttribute("ttp:"+K)||C[K],G},{}),P=O.getAttribute("xml:space")!=="preserve",N=t(c(O,"styling","style")),M=t(c(O,"layout","region")),B=c(O,"body","[begin]");return[].map.call(B,function(G){var K=a(G,P);if(!K||!G.hasAttribute("begin"))return null;var V=u(G.getAttribute("begin"),x),H=u(G.getAttribute("dur"),x),W=u(G.getAttribute("end"),x);if(V===null)throw l(G);if(W===null){if(H===null)throw l(G);W=V+H}var Y=new L.default(V-I,W-I,K);Y.id=Object(D.generateCueId)(Y.startTime,Y.endTime,Y.text);var X=M[G.getAttribute("region")],tt=N[G.getAttribute("style")];Y.position=10,Y.size=80;var et=function(st,Z){var rt="http://www.w3.org/ns/ttml#styling";return["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce(function(ot,at){var gt=e(Z,rt,at)||e(st,rt,at);return gt&&(ot[at]=gt),ot},{})}(X,tt),nt=et.textAlign;if(nt){var J=T[nt];J&&(Y.lineAlign=J),Y.align=nt}return o(Y,et),Y}).filter(function(G){return G!==null})}(h,b))}catch(_){p(_)}}else p(new Error("Could not parse IMSC1 mdat"))}function c(i,s,v){var g=i.getElementsByTagName(s)[0];return g?[].slice.call(g.querySelectorAll(v)):[]}function t(i){return i.reduce(function(s,v){var g=v.getAttribute("xml:id");return g&&(s[g]=v),s},{})}function a(i,s){return[].slice.call(i.childNodes).reduce(function(v,g,p){var r;return g.nodeName==="br"&&p?v+`
`:(r=g.childNodes)!==null&&r!==void 0&&r.length?a(g,s):s?v+g.textContent.trim().replace(/\s+/g," "):v+g.textContent},"")}function e(i,s,v){return i.hasAttributeNS(s,v)?i.getAttributeNS(s,v):null}function l(i){return new Error("Could not parse ttml timestamp "+i)}function u(i,s){if(!i)return null;var v=Object(y.parseTimeStamp)(i);return v===null&&(m.test(i)?v=function(g,p){var r=m.exec(g),n=(0|r[4])+(0|r[5])/p.subFrameRate;return 3600*(0|r[1])+60*(0|r[2])+(0|r[3])+n/p.frameRate}(i,s):f.test(i)&&(v=function(g,p){var r=f.exec(g),n=Number(r[1]);switch(r[2]){case"h":return 3600*n;case"m":return 60*n;case"ms":return 1e3*n;case"f":return n/p.frameRate;case"t":return n/p.tickRate}return n}(i,s))),v}},"./src/utils/logger.ts":function(F,R,d){d.r(R),d.d(R,"enableLogs",function(){return w}),d.d(R,"logger",function(){return D});var A=function(){},y={trace:A,debug:A,log:A,warn:A,info:A,error:A},L=y;function k(o){var S=self.console[o];return S?S.bind(self.console,"["+o+"] >"):A}function w(o){if(self.console&&o===!0||typeof o=="object"){(function(S){for(var m=arguments.length,f=new Array(m>1?m-1:0),T=1;T<m;T++)f[T-1]=arguments[T];f.forEach(function(E){L[E]=S[E]?S[E].bind(S):k(E)})})(o,"debug","log","info","warn","error");try{L.log()}catch{L=y}}else L=y}var D=y},"./src/utils/mediakeys-helper.ts":function(F,R,d){var A,y;d.r(R),d.d(R,"KeySystems",function(){return A}),d.d(R,"requestMediaKeySystemAccess",function(){return L}),(y=A||(A={})).WIDEVINE="com.widevine.alpha",y.PLAYREADY="com.microsoft.playready";var L=typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(F,R,d){function A(){return self.MediaSource||self.WebKitMediaSource}d.r(R),d.d(R,"getMediaSource",function(){return A})},"./src/utils/mp4-tools.ts":function(F,R,d){d.r(R),d.d(R,"bin2str",function(){return w}),d.d(R,"readUint16",function(){return D}),d.d(R,"readUint32",function(){return o}),d.d(R,"writeUint32",function(){return S}),d.d(R,"findBox",function(){return m}),d.d(R,"parseSegmentIndex",function(){return f}),d.d(R,"parseInitSegment",function(){return T}),d.d(R,"getStartDTS",function(){return E}),d.d(R,"getDuration",function(){return c}),d.d(R,"computeRawDurationFromSamples",function(){return t}),d.d(R,"offsetStartDTS",function(){return a}),d.d(R,"segmentValidRange",function(){return e}),d.d(R,"appendUint8Array",function(){return l});var A=d("./src/utils/typed-array.ts"),y=d("./src/loader/fragment.ts"),L=Math.pow(2,32)-1,k=[].push;function w(u){return String.fromCharCode.apply(null,u)}function D(u,i){"data"in u&&(i+=u.start,u=u.data);var s=u[i]<<8|u[i+1];return s<0?65536+s:s}function o(u,i){"data"in u&&(i+=u.start,u=u.data);var s=u[i]<<24|u[i+1]<<16|u[i+2]<<8|u[i+3];return s<0?4294967296+s:s}function S(u,i,s){"data"in u&&(i+=u.start,u=u.data),u[i]=s>>24,u[i+1]=s>>16&255,u[i+2]=s>>8&255,u[i+3]=255&s}function m(u,i){var s,v,g,p=[];if(!i.length)return p;"data"in u?(s=u.data,v=u.start,g=u.end):(v=0,g=(s=u).byteLength);for(var r=v;r<g;){var n=o(s,r),h=n>1?r+n:g;if(w(s.subarray(r+4,r+8))===i[0])if(i.length===1)p.push({data:s,start:r+8,end:h});else{var b=m({data:s,start:r+8,end:h},i.slice(1));b.length&&k.apply(p,b)}r=h}return p}function f(u){var i=m(u,["moov"])[0],s=i?i.end:null,v=m(u,["sidx"]);if(!v||!v[0])return null;var g=[],p=v[0],r=p.data[0],n=r===0?8:16,h=o(p,n);n+=4,n+=r===0?8:16,n+=2;var b=p.end+0,_=D(p,n);n+=2;for(var I=0;I<_;I++){var O=n,C=o(p,O);O+=4;var x=2147483647&C;if((2147483648&C)>>>31==1)return console.warn("SIDX has hierarchical references (not supported)"),null;var P=o(p,O);O+=4,g.push({referenceSize:x,subsegmentDuration:P,info:{duration:P/h,start:b,end:b+x-1}}),b+=x,n=O+=4}return{earliestPresentationTime:0,timescale:h,version:r,referencesCount:_,references:g,moovEndOffset:s}}function T(u){for(var i=[],s=m(u,["moov","trak"]),v=0;v<s.length;v++){var g=s[v],p=m(g,["tkhd"])[0];if(p){var r=p.data[p.start],n=r===0?12:20,h=o(p,n),b=m(g,["mdia","mdhd"])[0];if(b){var _=o(b,n=(r=b.data[b.start])===0?12:20),I=m(g,["mdia","hdlr"])[0];if(I){var O=w(I.data.subarray(I.start+8,I.start+12)),C={soun:y.ElementaryStreamTypes.AUDIO,vide:y.ElementaryStreamTypes.VIDEO}[O];if(C){var x=m(g,["mdia","minf","stbl","stsd"])[0],P=void 0;x&&(P=w(x.data.subarray(x.start+12,x.start+16))),i[h]={timescale:_,type:C},i[C]={timescale:_,id:h,codec:P}}}}}}return m(u,["moov","mvex","trex"]).forEach(function(N){var M=o(N,4),B=i[M];B&&(B.default={duration:o(N,12),flags:o(N,20)})}),i}function E(u,i){return m(i,["moof","traf"]).reduce(function(s,v){var g=m(v,["tfdt"])[0],p=g.data[g.start],r=m(v,["tfhd"]).reduce(function(n,h){var b=o(h,4),_=u[b];if(_){var I=o(g,4);p===1&&(I*=Math.pow(2,32),I+=o(g,8));var O=I/(_.timescale||9e4);if(isFinite(O)&&(n===null||O<n))return O}return n},null);return r!==null&&isFinite(r)&&(s===null||r<s)?r:s},null)||0}function c(u,i){for(var s=0,v=0,g=0,p=m(u,["moof","traf"]),r=0;r<p.length;r++){var n=p[r],h=m(n,["tfhd"])[0],b=i[o(h,4)];if(b){var _=b.default,I=o(h,0)|(_==null?void 0:_.flags),O=_==null?void 0:_.duration;8&I&&(O=o(h,2&I?12:8));for(var C=b.timescale||9e4,x=m(n,["trun"]),P=0;P<x.length;P++)s=O?O*o(x[P],4):t(x[P]),b.type===y.ElementaryStreamTypes.VIDEO?v+=s/C:b.type===y.ElementaryStreamTypes.AUDIO&&(g+=s/C)}}if(v===0&&g===0){var N=f(u);if(N!=null&&N.references)return N.references.reduce(function(M,B){return M+B.info.duration||0},0)}return v||g}function t(u){var i=o(u,0),s=8;1&i&&(s+=4),4&i&&(s+=4);for(var v=0,g=o(u,4),p=0;p<g;p++)256&i&&(v+=o(u,s),s+=4),512&i&&(s+=4),1024&i&&(s+=4),2048&i&&(s+=4);return v}function a(u,i,s){m(i,["moof","traf"]).forEach(function(v){m(v,["tfhd"]).forEach(function(g){var p=o(g,4),r=u[p];if(r){var n=r.timescale||9e4;m(v,["tfdt"]).forEach(function(h){var b=h.data[h.start],_=o(h,4);if(b===0)S(h,4,_-s*n);else{_*=Math.pow(2,32),_+=o(h,8),_-=s*n,_=Math.max(_,0);var I=Math.floor(_/(L+1)),O=Math.floor(_%(L+1));S(h,4,I),S(h,8,O)}})}})})}function e(u){var i={valid:null,remainder:null},s=m(u,["moof"]);if(!s)return i;if(s.length<2)return i.remainder=u,i;var v=s[s.length-1];return i.valid=Object(A.sliceUint8)(u,0,v.start-8),i.remainder=Object(A.sliceUint8)(u,v.start-8),i}function l(u,i){var s=new Uint8Array(u.length+i.length);return s.set(u),s.set(i,u.length),s}},"./src/utils/output-filter.ts":function(F,R,d){d.r(R),d.d(R,"default",function(){return A});var A=function(){function y(k,w){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=k,this.trackName=w}var L=y.prototype;return L.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},L.newCue=function(k,w,D){(this.startTime===null||this.startTime>k)&&(this.startTime=k),this.endTime=w,this.screen=D,this.timelineController.createCaptionsTrack(this.trackName)},L.reset=function(){this.cueRanges=[]},y}()},"./src/utils/texttrack-utils.ts":function(F,R,d){d.r(R),d.d(R,"sendAddTrackEvent",function(){return y}),d.d(R,"addCueToTrack",function(){return L}),d.d(R,"clearCurrentCues",function(){return k}),d.d(R,"removeCuesInRange",function(){return w}),d.d(R,"getCuesInRange",function(){return D});var A=d("./src/utils/logger.ts");function y(o,S){var m;try{m=new Event("addtrack")}catch{(m=document.createEvent("Event")).initEvent("addtrack",!1,!1)}m.track=o,S.dispatchEvent(m)}function L(o,S){var m=o.mode;if(m==="disabled"&&(o.mode="hidden"),o.cues&&!o.cues.getCueById(S.id))try{if(o.addCue(S),!o.cues.getCueById(S.id))throw new Error("addCue is failed for: "+S)}catch(T){A.logger.debug("[texttrack-utils]: "+T);var f=new self.TextTrackCue(S.startTime,S.endTime,S.text);f.id=S.id,o.addCue(f)}m==="disabled"&&(o.mode=m)}function k(o){var S=o.mode;if(S==="disabled"&&(o.mode="hidden"),o.cues)for(var m=o.cues.length;m--;)o.removeCue(o.cues[m]);S==="disabled"&&(o.mode=S)}function w(o,S,m){var f=o.mode;if(f==="disabled"&&(o.mode="hidden"),o.cues&&o.cues.length>0)for(var T=D(o.cues,S,m),E=0;E<T.length;E++)o.removeCue(T[E]);f==="disabled"&&(o.mode=f)}function D(o,S,m){var f=[],T=function(a,e){if(e<a[0].startTime)return 0;var l=a.length-1;if(e>a[l].endTime)return-1;for(var u=0,i=l;u<=i;){var s=Math.floor((i+u)/2);if(e<a[s].startTime)i=s-1;else{if(!(e>a[s].startTime&&u<l))return s;u=s+1}}return a[u].startTime-e<e-a[i].startTime?u:i}(o,S);if(T>-1)for(var E=T,c=o.length;E<c;E++){var t=o[E];if(t.startTime>=S&&t.endTime<=m)f.push(t);else if(t.startTime>m)return f}return f}},"./src/utils/time-ranges.ts":function(F,R,d){d.r(R),R.default={toString:function(A){for(var y="",L=A.length,k=0;k<L;k++)y+="["+A.start(k).toFixed(3)+","+A.end(k).toFixed(3)+"]";return y}}},"./src/utils/timescale-conversion.ts":function(F,R,d){function A(w,D,o,S){o===void 0&&(o=1),S===void 0&&(S=!1);var m=w*D*o;return S?Math.round(m):m}function y(w,D,o,S){return o===void 0&&(o=1),S===void 0&&(S=!1),A(w,D,1/o,S)}function L(w,D){return D===void 0&&(D=!1),A(w,1e3,1/9e4,D)}function k(w,D){return D===void 0&&(D=1),A(w,9e4,1/D)}d.r(R),d.d(R,"toTimescaleFromBase",function(){return A}),d.d(R,"toTimescaleFromScale",function(){return y}),d.d(R,"toMsFromMpegTsClock",function(){return L}),d.d(R,"toMpegTsClockFromTimescale",function(){return k})},"./src/utils/typed-array.ts":function(F,R,d){function A(y,L,k){return Uint8Array.prototype.slice?y.slice(L,k):new Uint8Array(Array.prototype.slice.call(y,L,k))}d.r(R),d.d(R,"sliceUint8",function(){return A})},"./src/utils/vttcue.ts":function(F,R,d){d.r(R),R.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var A=["","lr","rl"],y=["start","middle","end","left","right"];function L(o,S){if(typeof S!="string"||!Array.isArray(o))return!1;var m=S.toLowerCase();return!!~o.indexOf(m)&&m}function k(o){return L(y,o)}function w(o){for(var S=arguments.length,m=new Array(S>1?S-1:0),f=1;f<S;f++)m[f-1]=arguments[f];for(var T=1;T<arguments.length;T++){var E=arguments[T];for(var c in E)o[c]=E[c]}return o}function D(o,S,m){var f=this,T={enumerable:!0};f.hasBeenReset=!1;var E="",c=!1,t=o,a=S,e=m,l=null,u="",i=!0,s="auto",v="start",g=50,p="middle",r=50,n="middle";Object.defineProperty(f,"id",w({},T,{get:function(){return E},set:function(h){E=""+h}})),Object.defineProperty(f,"pauseOnExit",w({},T,{get:function(){return c},set:function(h){c=!!h}})),Object.defineProperty(f,"startTime",w({},T,{get:function(){return t},set:function(h){if(typeof h!="number")throw new TypeError("Start time must be set to a number.");t=h,this.hasBeenReset=!0}})),Object.defineProperty(f,"endTime",w({},T,{get:function(){return a},set:function(h){if(typeof h!="number")throw new TypeError("End time must be set to a number.");a=h,this.hasBeenReset=!0}})),Object.defineProperty(f,"text",w({},T,{get:function(){return e},set:function(h){e=""+h,this.hasBeenReset=!0}})),Object.defineProperty(f,"region",w({},T,{get:function(){return l},set:function(h){l=h,this.hasBeenReset=!0}})),Object.defineProperty(f,"vertical",w({},T,{get:function(){return u},set:function(h){var b=function(_){return L(A,_)}(h);if(b===!1)throw new SyntaxError("An invalid or illegal string was specified.");u=b,this.hasBeenReset=!0}})),Object.defineProperty(f,"snapToLines",w({},T,{get:function(){return i},set:function(h){i=!!h,this.hasBeenReset=!0}})),Object.defineProperty(f,"line",w({},T,{get:function(){return s},set:function(h){if(typeof h!="number"&&h!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");s=h,this.hasBeenReset=!0}})),Object.defineProperty(f,"lineAlign",w({},T,{get:function(){return v},set:function(h){var b=k(h);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");v=b,this.hasBeenReset=!0}})),Object.defineProperty(f,"position",w({},T,{get:function(){return g},set:function(h){if(h<0||h>100)throw new Error("Position must be between 0 and 100.");g=h,this.hasBeenReset=!0}})),Object.defineProperty(f,"positionAlign",w({},T,{get:function(){return p},set:function(h){var b=k(h);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");p=b,this.hasBeenReset=!0}})),Object.defineProperty(f,"size",w({},T,{get:function(){return r},set:function(h){if(h<0||h>100)throw new Error("Size must be between 0 and 100.");r=h,this.hasBeenReset=!0}})),Object.defineProperty(f,"align",w({},T,{get:function(){return n},set:function(h){var b=k(h);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");n=b,this.hasBeenReset=!0}})),f.displayState=void 0}return D.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},D}()},"./src/utils/vttparser.ts":function(F,R,d){d.r(R),d.d(R,"parseTimeStamp",function(){return L}),d.d(R,"fixLineBreaks",function(){return m}),d.d(R,"VTTParser",function(){return f});var A=d("./src/utils/vttcue.ts"),y=function(){function T(){}return T.prototype.decode=function(E,c){if(!E)return"";if(typeof E!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(E))},T}();function L(T){function E(t,a,e,l){return 3600*(0|t)+60*(0|a)+(0|e)+parseFloat(l||0)}var c=T.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return c?parseFloat(c[2])>59?E(c[2],c[3],0,c[4]):E(c[1],c[2],c[3],c[4]):null}var k=function(){function T(){this.values=Object.create(null)}var E=T.prototype;return E.set=function(c,t){this.get(c)||t===""||(this.values[c]=t)},E.get=function(c,t,a){return a?this.has(c)?this.values[c]:t[a]:this.has(c)?this.values[c]:t},E.has=function(c){return c in this.values},E.alt=function(c,t,a){for(var e=0;e<a.length;++e)if(t===a[e]){this.set(c,t);break}},E.integer=function(c,t){/^-?\d+$/.test(t)&&this.set(c,parseInt(t,10))},E.percent=function(c,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var a=parseFloat(t);if(a>=0&&a<=100)return this.set(c,a),!0}return!1},T}();function w(T,E,c,t){var a=t?T.split(t):[T];for(var e in a)if(typeof a[e]=="string"){var l=a[e].split(c);l.length===2&&E(l[0],l[1])}}var D=new A.default(0,0,""),o=D.align==="middle"?"middle":"center";function S(T,E,c){var t=T;function a(){var l=L(T);if(l===null)throw new Error("Malformed timestamp: "+t);return T=T.replace(/^[^\sa-zA-Z-]+/,""),l}function e(){T=T.replace(/^\s+/,"")}if(e(),E.startTime=a(),e(),T.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);T=T.substr(3),e(),E.endTime=a(),e(),function(l,u){var i=new k;w(l,function(g,p){var r;switch(g){case"region":for(var n=c.length-1;n>=0;n--)if(c[n].id===p){i.set(g,c[n].region);break}break;case"vertical":i.alt(g,p,["rl","lr"]);break;case"line":r=p.split(","),i.integer(g,r[0]),i.percent(g,r[0])&&i.set("snapToLines",!1),i.alt(g,r[0],["auto"]),r.length===2&&i.alt("lineAlign",r[1],["start",o,"end"]);break;case"position":r=p.split(","),i.percent(g,r[0]),r.length===2&&i.alt("positionAlign",r[1],["start",o,"end","line-left","line-right","auto"]);break;case"size":i.percent(g,p);break;case"align":i.alt(g,p,["start",o,"end","left","right"])}},/:/,/\s/),u.region=i.get("region",null),u.vertical=i.get("vertical","");var s=i.get("line","auto");s==="auto"&&D.line===-1&&(s=-1),u.line=s,u.lineAlign=i.get("lineAlign","start"),u.snapToLines=i.get("snapToLines",!0),u.size=i.get("size",100),u.align=i.get("align",o);var v=i.get("position","auto");v==="auto"&&D.position===50&&(v=u.align==="start"||u.align==="left"?0:u.align==="end"||u.align==="right"?100:50),u.position=v}(T,E)}function m(T){return T.replace(/<br(?: \/)?>/gi,`
`)}var f=function(){function T(){this.state="INITIAL",this.buffer="",this.decoder=new y,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var E=T.prototype;return E.parse=function(c){var t=this;function a(){var s=t.buffer,v=0;for(s=m(s);v<s.length&&s[v]!=="\r"&&s[v]!==`
`;)++v;var g=s.substr(0,v);return s[v]==="\r"&&++v,s[v]===`
`&&++v,t.buffer=s.substr(v),g}c&&(t.buffer+=t.decoder.decode(c,{stream:!0}));try{var e="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;var l=(e=a()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!l||!l[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var u=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(u?u=!1:e=a(),t.state){case"HEADER":/:/.test(e)?w(e,function(s,v){},/:/):e||(t.state="ID");continue;case"NOTE":e||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(e)){t.state="NOTE";break}if(!e)continue;if(t.cue=new A.default(0,0,""),t.state="CUE",e.indexOf("-->")===-1){t.cue.id=e;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{S(e,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var i=e.indexOf("-->")!==-1;if(!e||i&&(u=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=e;continue;case"BADCUE":e||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},E.flush=function(){var c=this;try{if((c.cue||c.state==="HEADER")&&(c.buffer+=`

`,c.parse()),c.state==="INITIAL"||c.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){c.onparsingerror&&c.onparsingerror(t)}return c.onflush&&c.onflush(),this},T}()},"./src/utils/webvtt-parser.ts":function(F,R,d){d.r(R),d.d(R,"generateCueId",function(){return m}),d.d(R,"parseWebVTT",function(){return f});var A=d("./src/polyfills/number.ts"),y=d("./src/utils/vttparser.ts"),L=d("./src/demux/id3.ts"),k=d("./src/utils/timescale-conversion.ts"),w=d("./src/remux/mp4-remuxer.ts"),D=/\r\n|\n\r|\n|\r/g,o=function(T,E,c){return c===void 0&&(c=0),T.substr(c,E.length)===E},S=function(T){for(var E=5381,c=T.length;c;)E=33*E^T.charCodeAt(--c);return(E>>>0).toString()};function m(T,E,c){return S(T.toString())+S(E.toString())+S(c)}function f(T,E,c,t,a,e,l,u){var i,s=new y.VTTParser,v=Object(L.utf8ArrayToStr)(new Uint8Array(T)).trim().replace(D,`
`).split(`
`),g=[],p=Object(k.toMpegTsClockFromTimescale)(E,c),r="00:00.000",n=0,h=0,b=!0,_=!1;s.oncue=function(I){var O=t[a],C=t.ccOffset,x=(n-p)/9e4;if(O!=null&&O.new&&(h!==void 0?C=t.ccOffset=O.start:function(B,G,K){var V=B[G],H=B[V.prevCC];if(!H||!H.new&&V.new)return B.ccOffset=B.presentationOffset=V.start,void(V.new=!1);for(;(W=H)!==null&&W!==void 0&&W.new;){var W;B.ccOffset+=V.start-H.start,V.new=!1,H=B[(V=H).prevCC]}B.presentationOffset=K}(t,a,x)),x&&(C=x-t.presentationOffset),_){var P=I.endTime-I.startTime,N=Object(w.normalizePts)(9e4*(I.startTime+C-h),9e4*e)/9e4;I.startTime=N,I.endTime=N+P}var M=I.text.trim();I.text=decodeURIComponent(encodeURIComponent(M)),I.id||(I.id=m(I.startTime,I.endTime,M)),I.endTime>0&&g.push(I)},s.onparsingerror=function(I){i=I},s.onflush=function(){i?u(i):l(g)},v.forEach(function(I){if(b){if(o(I,"X-TIMESTAMP-MAP=")){b=!1,_=!0,I.substr(16).split(",").forEach(function(O){o(O,"LOCAL:")?r=O.substr(6):o(O,"MPEGTS:")&&(n=parseInt(O.substr(7)))});try{h=function(O){var C=parseInt(O.substr(-3)),x=parseInt(O.substr(-6,2)),P=parseInt(O.substr(-9,2)),N=O.length>9?parseInt(O.substr(0,O.indexOf(":"))):0;if(!(Object(A.isFiniteNumber)(C)&&Object(A.isFiniteNumber)(x)&&Object(A.isFiniteNumber)(P)&&Object(A.isFiniteNumber)(N)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+O);return C+=1e3*x,(C+=6e4*P)+36e5*N}(r)/1e3}catch(O){_=!1,i=O}return}I===""&&(b=!1)}s.parse(I+`
`)}),s.flush()}},"./src/utils/xhr-loader.ts":function(F,R,d){d.r(R);var A=d("./src/utils/logger.ts"),y=d("./src/loader/load-stats.ts"),L=/^age:\s*[\d.]+\s*$/m,k=function(){function w(o){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=o?o.xhrSetup:null,this.stats=new y.LoadStats,this.retryDelay=0}var D=w.prototype;return D.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},D.abortInternal=function(){var o=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),o&&(o.onreadystatechange=null,o.onprogress=null,o.readyState!==4&&(this.stats.aborted=!0,o.abort()))},D.abort=function(){var o;this.abortInternal(),(o=this.callbacks)!==null&&o!==void 0&&o.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},D.load=function(o,S,m){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=o,this.config=S,this.callbacks=m,this.retryDelay=S.retryDelay,this.loadInternal()},D.loadInternal=function(){var o=this.config,S=this.context;if(o){var m=this.loader=new self.XMLHttpRequest,f=this.stats;f.loading.first=0,f.loaded=0;var T=this.xhrSetup;try{if(T)try{T(m,S.url)}catch{m.open("GET",S.url,!0),T(m,S.url)}m.readyState||m.open("GET",S.url,!0)}catch(E){return void this.callbacks.onError({code:m.status,text:E.message},S,m)}S.rangeEnd&&m.setRequestHeader("Range","bytes="+S.rangeStart+"-"+(S.rangeEnd-1)),m.onreadystatechange=this.readystatechange.bind(this),m.onprogress=this.loadprogress.bind(this),m.responseType=S.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),o.timeout),m.send()}},D.readystatechange=function(){var o=this.context,S=this.loader,m=this.stats;if(o&&S){var f=S.readyState,T=this.config;if(!m.aborted&&f>=2)if(self.clearTimeout(this.requestTimeout),m.loading.first===0&&(m.loading.first=Math.max(self.performance.now(),m.loading.start)),f===4){S.onreadystatechange=null,S.onprogress=null;var E=S.status;if(E>=200&&E<300){var c,t;if(m.loading.end=Math.max(self.performance.now(),m.loading.first),t=o.responseType==="arraybuffer"?(c=S.response).byteLength:(c=S.responseText).length,m.loaded=m.total=t,!this.callbacks)return;var a=this.callbacks.onProgress;if(a&&a(m,o,c,S),!this.callbacks)return;var e={url:S.responseURL,data:c};this.callbacks.onSuccess(e,m,o,S)}else m.retry>=T.maxRetry||E>=400&&E<499?(A.logger.error(E+" while loading "+o.url),this.callbacks.onError({code:E,text:S.statusText},o,S)):(A.logger.warn(E+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,T.maxRetryDelay),m.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),T.timeout)}},D.loadtimeout=function(){A.logger.warn("timeout while loading "+this.context.url);var o=this.callbacks;o&&(this.abortInternal(),o.onTimeout(this.stats,this.context,this.loader))},D.loadprogress=function(o){var S=this.stats;S.loaded=o.loaded,o.lengthComputable&&(S.total=o.total)},D.getCacheAge=function(){var o=null;if(this.loader&&L.test(this.loader.getAllResponseHeaders())){var S=this.loader.getResponseHeader("age");o=S?parseFloat(S):null}return o},w}();R.default=k}}).default);var ue=xi(Ve.exports);const Pi={name:"d-icon"},Lt=Object.assign(Pi,{props:{icon:String,size:[Number,String]},setup:function(F){const R=F,d=vt(()=>({fontSize:/^\d+$/.test(R.size)?R.size+"px":R.size}));return(A,y)=>(q(),z("i",{class:ht(["d-icon iconfont",F.icon]),style:wt(j(d))},null,6))}});Lt.__scopeId="data-v-0c690e66";Ct("data-v-4cb76d59");const Fi={class:"d-player-top"},Mi={class:"top-title"},Ni={class:"top-title"};Ot();const Bi={props:{title:{default:""}},setup(F){Date.prototype.format=function(A){let y={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var L in y)new RegExp("("+L+")").test(A)&&(A=A.replace(RegExp.$1,RegExp.$1.length==1?y[L]:("00"+y[L]).substr((""+y[L]).length)));return A};let R=it("00:00:00");R.value=new Date().format("hh:mm:ss");let d=null;return d=setInterval(()=>{R.value=new Date().format("hh:mm:ss")},1e3),ye(()=>{clearInterval(d)}),(A,y)=>(q(),z("div",Fi,[U("p",Mi,$(F.title||""),1),U("p",Ni,$(j(R)),1)]))},__scopeId:"data-v-4cb76d59"};Ct("data-v-ac2469ec");const Ui={class:"d-status"},Gi={class:"d-flex-center"},ji={class:"d-flex-center"},Ki=_t("5X\u901F\u64AD\u653E\u4E2D ");Ot();var He=yt({props:["state"],setup:F=>(R,d)=>ut((q(),z("div",Ui,[ut(U("li",Gi,[Q(Lt,{size:"18",class:"d-status-icon",icon:"icon-volume-"+(F.state.volume==0?"mute":F.state.volume>.5?"up":"down")},null,8,["icon"]),_t(" "+$(~~(100*F.state.volume))+"% ",1)],512),[[ct,F.state.handleType=="volume"]]),ut(U("li",ji,[Q(Lt,{size:"12",icon:"icon-play"}),Q(Lt,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),Ki],512),[[ct,F.state.handleType=="playbackRate"||F.state.isMultiplesPlay]])],512)),[[ct,F.state.handleType||F.state.isMultiplesPlay]])});He.__scopeId="data-v-ac2469ec",Ct("data-v-385f7870");const Vi=["checked","true-value","false-value"],Hi=U("span",{class:"d-switch_action"},null,-1);Ot();var ie=yt({props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(F,{emit:R}){const d=F;Te(k=>({"014e5dc0":F.width,e4e32852:F.activeColor}));const A=it(null),y=vt(()=>d.modelValue===d.trueValue),L=()=>{pe(()=>{const k=A.value.checked;R("update:modelValue",k),R("change",k)})};return(k,w)=>(q(),z("div",{class:ht(["d-switch",{"is-checked":j(y)}])},[U("input",{class:"d-switch__input",ref:A,type:"checkbox",checked:j(y),onChange:L,"true-value":F.trueValue,"false-value":F.falseValue},null,40,Vi),Hi],2))}});ie.__scopeId="data-v-385f7870",Ct("data-v-b2384226");const Wi={key:0},Yi=U("i",{class:"rotating iconfont icon-loading f50"},null,-1),qi=[U("i",{class:"rotating iconfont icon-loading f50"},null,-1),U("p",null,"\u6B63\u5728\u7F13\u51B2...",-1)],Xi=[U("i",{class:"iconfont icon-replay f24 mr5"},null,-1),_t("\u91CD\u65B0\u64AD\u653E ")],zi=[U("i",{class:"iconfont icon-replay f24 mr5"},null,-1),_t("\u8BF7\u6C42\u9519\u8BEF ")];Ot();var We=yt({props:{loadType:String,text:{type:String,default:""}},setup(F){const R=F,{proxy:d}=Be(),A=["loadstart","waiting","ended","error","stalled"],y=()=>{d.$parent.play()},L=vt(()=>{let k="background: rgba(0, 0, 0, .1);z-index:1";return R.loadType=="loadstart"&&(k="background: rgba(0, 0, 0, 1);;z-index:3"),k});return(k,w)=>ut((q(),z("div",{class:"d-loading",style:wt(j(L))},[U("div",null,[F.loadType=="loadstart"?(q(),z("span",Wi,[Yi,U("p",null,$(F.text),1)])):lt("",!0),ut(U("span",null,qi,512),[[ct,F.loadType=="waiting"]]),ut(U("span",null,[U("p",{onClick:y,class:"d-flex-x d-pointer"},Xi)],512),[[ct,F.loadType=="ended"]]),ut(U("span",null,[U("p",{onClick:y,class:"d-flex-x d-pointer"},zi)],512),[[ct,F.loadType=="error"||F.loadType=="stalled"]])])],4)),[[ct,A.includes(F.loadType)]])}});We.__scopeId="data-v-b2384226";const jt=function(F,R,d,A=!1){F&&R&&d&&F.addEventListener(R,d,A)},mt=function(F,R,d,A=!1){F&&R&&d&&F.removeEventListener(R,d,A)};Ct("data-v-5a794390");const $i=["onMousedown"];Ot();var Xt=yt(ve(ge({},{name:"DSlider"}),{props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup:function(F,{emit:R}){const d=F;Te(t=>({"5242b67b":F.size}));const A=it(null),y=it(null),L=Ft({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),k=vt(()=>{let t=d.modelValue<0?0:d.modelValue>1?1:d.modelValue;return d.vertical?`height:${100*t}%`:`width:${100*t}%`}),w=vt(()=>{let t=d.preload<0?0:d.preload>1?1:d.preload;return d.vertical?`height:${100*t}%`:`width:${100*t}%`}),D=vt(()=>{let t=L.hoverPosition<0?0:L.hoverPosition>1?1:L.hoverPosition;return d.vertical?`bottom:${100*t}%`:`left:${100*t}%`}),o=t=>{t.preventDefault()},S=t=>{d.disabled||(t.preventDefault(),L.dragging=!0,f(t),jt(window,"mousemove",E),jt(window,"touchmove",E),jt(window,"mouseup",c),jt(window,"touchend",c))},m=t=>{if(!d.hover)return;let a=T(t);if(R("onMousemove",t,a),L.hoverPosition=a,d.vertical)return;let e=A.value,l=y.value.clientWidth/2,u=t.clientX-e.getBoundingClientRect().left;u<l?L.hoverTipsLeft=l-u+"px":e.clientWidth-u<l?L.hoverTipsLeft=e.clientWidth-u-l+"px":L.hoverTipsLeft="50%"},f=t=>{let a=T(t);R("update:modelValue",a),R("change",t,a)},T=t=>{let a=A.value,e=0;if(d.vertical){let l=a.clientHeight;e=(a.getBoundingClientRect().bottom-t.clientY)/l}else e=(t.clientX-a.getBoundingClientRect().left)/a.clientWidth;return e<0?0:e>1?1:e},E=t=>{f(t)},c=t=>{L.dragging&&(mt(window,"mousemove",E),mt(window,"touchmove",E),mt(window,"mouseup",c),mt(window,"touchend",c),mt(window,"contextmenu",c),setTimeout(()=>{L.dragging=!1},0))};return(t,a)=>(q(),z("div",{ref:A,class:ht(["d-slider",{"is-vertical":d.vertical}]),onMousedown:Yt(S,["stop"]),onContextmenu:o},[U("div",{class:"d-slider__runway",onMousemove:m},[ut(U("div",{class:"d-slider__cursor",style:wt(j(D))},[ut(U("div",{class:"d-slider__tips",ref:y,style:wt({left:j(L).hoverTipsLeft})},$(d.hoverText),5),[[ct,d.hoverText]])],4),[[ct,d.hover]]),U("div",{class:"d-slider__preload",style:wt(j(w))},null,4),U("div",{class:"d-slider__bar",style:wt(j(k))},null,4)],32)],42,$i))}}));Xt.__scopeId="data-v-5a794390";Ct("data-v-570fa0d1");const Qi={key:0,class:"d-player-dialog"},Zi={class:"d-player-dialog-body"},Ji={class:"d-player-dialog-title"},tn={class:"d-player-hotkey-panel"},en={class:"d-player-filter-panel"},rn={class:"d-player-filter-panel-item"},nn=U("span",null,"\u9971\u548C\u5EA6",-1),an={class:"d-player-filter-panel-item"},sn=U("span",null,"\u4EAE\u5EA6",-1),on={class:"d-player-filter-panel-item"},ln=U("span",null,"\u5BF9\u6BD4\u5EA6",-1),un={key:0,class:"d-player-contextmenu"},cn=["dplayerKeyCode"],dn=U("input",{class:"d-player-copyText"},null,-1);Ot();var Ye=yt({setup(F){const R=Ft({show:!1,dialogType:"",dialogTitle:"",version:"1.3.1-beta.6",mouseX:0,mouseY:0}),d=[{label:"\u89C6\u9891\u8272\u5F69\u8C03\u6574",key:"filter"},{label:"\u5FEB\u6377\u952E\u8BF4\u660E",key:"hotkey"},{label:"\u590D\u5236\u89C6\u9891\u7F51\u5740",key:"copy"},{label:"\u7248\u672C\uFF1A1.3.1-beta.6",key:"version"}],A=[{key:"Space",label:"\u64AD\u653E/\u6682\u505C"},{key:"\u2192",label:"\u5355\u6B21\u5FEB\u8FDB10s\uFF0C\u957F\u63095\u500D\u901F\u64AD\u653E"},{key:"\u2190",label:"\u5FEB\u90005s"},{key:"\u2191",label:"\u97F3\u91CF\u589E\u52A010%"},{key:"\u2193",label:"\u97F3\u91CF\u589E\u52A0\u964D\u4F4E10%"},{key:"Esc",label:"\u9000\u51FA\u5168\u5C4F/\u9000\u51FA\u7F51\u9875\u5168\u5C4F"},{key:"F",label:"\u5168\u5C4F/\u9000\u51FA\u5168\u5C4F"}],y=Ft({saturate:.392,brightness:.392,contrast:.392}),L=vt(()=>({left:R.mouseX+"px",top:R.mouseY+"px"}));Gt(y,S=>{let m=document.querySelector("#dPlayerVideo"),f=(2.55*S.saturate).toFixed(2),T=(2.55*S.brightness).toFixed(2),E=(2.55*S.contrast).toFixed(2);m.style.filter=`saturate(${f}) brightness(${T}) contrast(${E})`});const k=()=>{y.saturate=.392,y.brightness=.392,y.contrast=.392},w=S=>{S.key=="Escape"&&o(0)},D=S=>{S.preventDefault(),jt(window,"keydown",w),jt(window,"click",o);let m=document.querySelector("#refPlayerWrap"),f=m.clientWidth;m.clientHeight,R.mouseX=S.clientX-m.getBoundingClientRect().left,f-R.mouseX<130&&(R.mouseX=R.mouseX+(f-R.mouseX-130)),R.mouseY=S.clientY-m.getBoundingClientRect().top,R.show=!0},o=S=>{let m=S.path[0].tagName=="LI",f=S.path[0].attributes.dplayerKeyCode&&S.path[0].attributes.dplayerKeyCode.value,T=d.map(E=>E.key);if(m&&T.includes(f))if(R.dialogTitle=S.path[0].innerText,R.dialogType=f,f=="copy"){let E=document.querySelector(".d-player-copyText");E.value=window.location.href,E.select(),document.execCommand("copy"),R.dialogType=""}else f=="version"&&(R.dialogType="");R.show=!1,mt(window,"keydown",w),mt(window,"click",o)};return zt(()=>{let S=document.querySelector("#refPlayerWrap");mt(window,"keydown",w),mt(window,"click",o),mt(S,"contextmenu",D),jt(S,"contextmenu",D)}),ye(()=>{let S=document.querySelector("#refPlayerWrap");mt(window,"keydown",w),mt(window,"click",o),mt(S,"contextmenu",D)}),(S,m)=>(q(),z("div",null,[Q(te,{name:"d-fade-in"},{default:bt(()=>[j(R).dialogType?(q(),z("div",Qi,[U("div",Zi,[U("h5",Ji,[_t($(j(R).dialogTitle)+" ",1),U("i",{onClick:m[0]||(m[0]=f=>j(R).dialogType=!1),class:"icon icon-close"},"X")]),ut(U("ul",tn,[(q(),z(pt,null,St(A,f=>U("li",{class:"d-player-hotkey-panel-item",key:f.key},[U("span",null,$(f.key),1),U("span",null,$(f.label),1)])),64))],512),[[ct,j(R).dialogType=="hotkey"]]),ut(U("ul",en,[U("li",rn,[nn,Q(Xt,{class:"filter-panel-slider",size:"5px",modelValue:j(y).saturate,"onUpdate:modelValue":m[1]||(m[1]=f=>j(y).saturate=f)},null,8,["modelValue"]),U("span",null,$(Math.round(255*j(y).saturate)),1)]),U("li",an,[sn,Q(Xt,{class:"filter-panel-slider",size:"5px",modelValue:j(y).brightness,"onUpdate:modelValue":m[2]||(m[2]=f=>j(y).brightness=f)},null,8,["modelValue"]),U("span",null,$(Math.round(255*j(y).brightness)),1)]),U("li",on,[ln,Q(Xt,{class:"filter-panel-slider",size:"5px",modelValue:j(y).contrast,"onUpdate:modelValue":m[3]||(m[3]=f=>j(y).contrast=f)},null,8,["modelValue"]),U("span",null,$(Math.round(255*j(y).contrast)),1)]),U("span",{onClick:k,title:"\u91CD\u7F6E","aria-label":"\u91CD\u7F6E",class:"d-player-filter-reset"},"\u91CD\u7F6E")],512),[[ct,j(R).dialogType=="filter"]])])])):lt("",!0)]),_:1}),j(R).show?(q(),z("div",un,[U("ul",{class:"d-player-contextmenu-body",style:wt(j(L))},[(q(),z(pt,null,St(d,f=>U("li",{dplayerKeyCode:f.key,key:f.key},$(f.label),9,cn)),64))],4),dn])):lt("",!0)]))}});Ye.__scopeId="data-v-570fa0d1";const ce=F=>{let R=~~(F/3600),d=~~(F%3600/60),A=~~(F%60);return R=R<10?"0"+R:R,d=d<10?"0"+d:d,A=A<10?"0"+A:A,`${R}:${d}:${A}`},Jt="ontouchstart"in window,Pe=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],hn={width:{type:String,default:"800px"},height:{type:String,default:"450px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75","0.5"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"auto"}};Ct("data-v-01791e9e");const fn={class:"d-player-video",id:"dPlayerVideo"},gn=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],vn={class:"d-player-lightoff"},pn={key:1,class:"d-player-state"},mn={class:"d-play-btn"},yn=["onKeyup","onKeydown"],En={class:"d-control-progress"},Tn={class:"d-tool-bar"},Sn={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},bn=U("span",{style:{margin:"0 3px"}},"/",-1),_n={class:"total-time"},Ln={class:"d-tool-bar"},An={key:0,class:"d-tool-item quality-btn"},kn={class:"d-tool-item-main"},Dn={class:"speed-main",style:{"text-align":"center"}},In=["onClick"],Rn={key:1,class:"d-tool-item speedRate-btn"},wn={class:"d-tool-item-main"},Cn={class:"speed-main"},On=["onClick"],xn={key:2,class:"d-tool-item volume-btn"},Pn={class:"d-tool-item-main volume-box",style:{width:"52px"}},Fn={class:"volume-text-size"},Mn={key:3,class:"d-tool-item setting-btn"},Nn={class:"d-tool-item-main"},Bn={class:"speed-main"},Un=_t(" \u955C\u50CF\u753B\u9762 "),Gn=_t(" \u5FAA\u73AF\u64AD\u653E "),jn=_t(" \u5173\u706F\u6A21\u5F0F "),Kn=U("div",{class:"d-tool-item-main"},"\u753B\u4E2D\u753B",-1),Vn=U("div",{class:"d-tool-item-main"},"\u7F51\u9875\u5168\u5C4F",-1),Hn=U("div",{class:"d-tool-item-main"},"\u5168\u5C4F",-1);Ot();var ee=yt(ve(ge({},{name:"vue3VideoPlay",inheritAttrs:!1}),{props:hn,emits:[...Pe,"mirrorChange","loopChange","lightOffChange"],setup:function(F,{expose:R,emit:d}){const A=F;Te(C=>({"51d4439c":j(T),"77e758a6":C.width,b8a1afc0:C.height}));const y=new ue({fragLoadingTimeOut:2e3}),L=it(null),k=it(null),w=it(null),D=it(null),o=Ft(ve(ge({dVideo:null},A),{muted:A.muted,playBtnState:A.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0})),S=(...C)=>x=>C.reverse().reduce((P,N)=>N(P),x),m=Pe.reduce((C,x)=>{var P;return C[`on${P=x,P.charAt(0).toUpperCase()+P.slice(1)}`]=N=>{o.loadStateType=x,d(x,N)},C},{});m.onCanplay=S(m.onCanplay,()=>{o.playBtnState!="play"&&o.dVideo.play(),o.autoPlay&&(o.dVideo.play(),o.playBtnState="pause")}),m.onEnded=S(m.onEnded,()=>{o.playBtnState="replay"}),m.onDurationchange=C=>{d("durationchange",C),A.currentTime!=0&&(o.dVideo.currentTime=A.currentTime),m.onTimeupdate(C)},m.onProgress=C=>{console.log("\u7F13\u51B2\u4E2D..."),d("progress",C);let x=C.target.duration,P=C.target.buffered,N=C.target.buffered.length&&C.target.buffered.end(P-1);o.preloadBar=N/x},m.onTimeupdate=C=>{d("timeupdate",C);let x=C.duration||C.target.duration||0,P=C.currentTime||C.target.currentTime;o.playProgress=P/x,o.currentTime=ce(P),o.totalTime=ce(x)},m.onError=S(m.onError,()=>{o.playBtnState="replay"});let f=hr();for(let C in f)m[C]=f[C];const T=(E=o.color,`${parseInt("0x"+E.slice(1,3))},${parseInt("0x"+E.slice(3,5))},${parseInt("0x"+E.slice(5,7))}`);var E;const c=xe(500,()=>{o.handleType=""}),t=C=>{C.preventDefault(),C.code=="ArrowUp"?o.volume=o.volume+.1>1?1:o.volume+.1:o.volume=o.volume-.1<0?0:o.volume-.1,o.muted=!1,o.handleType="volume",c()},a=C=>{A.speed&&(o.dVideo.currentTime=o.dVideo.currentTime<10?.1:o.dVideo.currentTime-10,m.onTimeupdate(o.dVideo),u())},e=C=>{C.preventDefault();let x=C.type;if(C.key=="ArrowRight"){if(u(),x=="keyup"){if(clearTimeout(o.longPressTimeout),!A.speed&&!o.longPressTimeout)return;o.isMultiplesPlay?(o.dVideo.playbackRate=o.speedActive,o.isMultiplesPlay=!1):(o.dVideo.currentTime=o.dVideo.currentTime+10,m.onTimeupdate(o.dVideo))}else if(x=="keydown"){if(!A.speed)return;o.isMultiplesPlay&&clearTimeout(o.longPressTimeout),o.longPressTimeout=setTimeout(()=>{o.isMultiplesPlay=!0,o.dVideo.playbackRate=5,o.handleType="playbackRate",c()},500)}}},l=()=>{Jt||D.value.focus()},u=()=>{o.loadStateType="play",o.dVideo.play().catch(()=>{setTimeout(()=>{o.playBtnState="replay",o.loadStateType="error"},500)}),o.playBtnState="pause"},i=()=>{o.dVideo.pause(),o.playBtnState="play"},s=C=>{C&&C.preventDefault(),o.playBtnState=="play"||o.playBtnState=="replay"?u():o.playBtnState=="pause"&&i()},v=()=>{o.muted=!o.muted,o.volume==0&&(o.volume=.05)},g=(C,x)=>{let P=o.dVideo.duration||o.dVideo.target.duration;o.dVideo.currentTime=P*x,o.playBtnState=="play"&&(o.dVideo.play(),o.playBtnState="pause")},p=(C,x)=>{o.progressCursorTime=ce(o.dVideo.duration*x)},r=xe(2500,()=>{o.isVideoHovering=!1}),n=C=>{o.isVideoHovering=!0,r()},h=C=>{d("mirrorChange",C,o.dVideo)},b=C=>{d("loopChange",C,o.dVideo)},_=C=>{d("lightOffChange",C,o.dVideo)},I=()=>{var C;C=o.dVideo,document.pictureInPictureElement?document.exitPictureInPicture().catch(x=>{console.log(x,"Video failed to leave Picture-in-Picture mode.")}):C.requestPictureInPicture().catch(x=>{console.log(x,"Video failed to enter Picture-in-Picture mode.")})},O=()=>{o.fullScreen=(C=>{let x=document,P=x.webkitIsFullScreen||x.fullscreen;return P?(document.exitFullscreen||x.webkitExitFullScreen).call(x):(C.requestFullscreen||C.webkitRequestFullScreen).call(C),!P})(L.value)};return Gt(()=>A.src,()=>{pe(()=>{o.dVideo.canPlayType(A.type)||o.dVideo.canPlayType("application/vnd.apple.mpegurl")?o.muted=A.autoPlay:ue.isSupported()&&(y.detachMedia(),y.attachMedia(o.dVideo),y.on(ue.Events.MEDIA_ATTACHED,()=>{y.loadSource(A.src),y.on("hlsManifestParsed",(C,x)=>{console.log(x),o.currentLevel=x.level,o.qualityLevels=x.levels||[]})}),y.on("hlsLevelSwitching",(C,x)=>{console.log(x),console.log("LEVEL_SWITCHING")}),y.on("hlsLevelSwitched",(C,x)=>{o.currentLevel=x.level,console.log("LEVEL_SWITCHED")}))})},{immediate:!0}),zt(()=>{o.dVideo=k,l()}),R({play:u,pause:i,togglePlay:s}),(C,x)=>(q(),z("div",{ref:L,id:"refPlayerWrap",class:ht(["d-player-wrap",{"web-full-screen":j(o).webFullScreen,"is-lightoff":j(o).lightOff,"d-player-wrap-hover":j(o).playBtnState=="play"||j(o).isVideoHovering}]),onMousemove:n},[U("div",fn,[U("video",Ue({ref:k,class:["d-player-video-main",{"video-mirror":j(o).mirror}],id:"dPlayerVideoMain",controls:!(!j(Jt)||!j(o).speed),"webkit-playsinline":A.playsinline,playsinline:A.playsinline},j(m),{volume:j(o).volume,muted:j(o).muted,loop:j(o).loop,preload:C.preload,width:"100%",height:"100%",src:A.src,poster:A.poster}),"\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301Video\u6807\u7B7E\u3002",16,gn)]),Q(te,{name:"d-fade-in"},{default:bt(()=>[ut(U("div",vn,null,512),[[ct,j(o).lightOff]])]),_:1}),j(o).fullScreen?(q(),qt(Bi,{key:0,title:A.title},null,8,["title"])):lt("",!0),j(Jt)?lt("",!0):(q(),z("div",pn,[Q(te,{name:"d-scale-out"},{default:bt(()=>[ut(U("div",mn,[Q(Lt,{icon:"icon-play",size:40})],512),[[ct,j(o).playBtnState=="play"]])]),_:1}),Q(He,{state:j(o)},null,8,["state"])])),j(Jt)?lt("",!0):(q(),z("input",{key:2,type:"input",readonly:"readonly",ref:D,onDblclick:O,onKeyup:[Zt(O,["f"]),x[0]||(x[0]=Zt(P=>j(o).webFullScreen=!1,["esc"])),e],onClick:s,onKeydown:[Zt(s,["space"]),Zt(a,["arrow-left"]),Zt(t,["arrow-up","arrow-down"]),e],class:"d-player-input",maxlength:"0"},null,40,yn)),Q(We,{loadType:j(o).loadStateType},null,8,["loadType"]),Q(Ye),!j(Jt)&&j(o).control?(q(),z("div",{key:3,class:"d-player-control",ref:w},[U("div",En,[Q(Xt,{class:"d-progress-bar",onOnMousemove:p,onChange:g,disabled:!j(o).speed,hoverText:j(o).progressCursorTime,modelValue:j(o).playProgress,"onUpdate:modelValue":x[1]||(x[1]=P=>j(o).playProgress=P),preload:j(o).preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),U("div",{class:"d-control-tool",onClick:l},[U("div",Tn,[U("div",{class:"d-tool-item",onClick:s},[Q(Lt,{size:"24",icon:`icon-${j(o).playBtnState}`},null,8,["icon"])]),A.controlBtns.includes("audioTrack")?(q(),z("div",Sn,[U("span",null,$(j(o).currentTime),1),bn,U("span",_n,$(j(o).totalTime),1)])):lt("",!0)]),U("div",Ln,[j(o).qualityLevels.length&&A.controlBtns.includes("quality")?(q(),z("div",An,[_t($(j(o).qualityLevels.length&&(j(o).qualityLevels[j(o).currentLevel]||{}).height)+"P ",1),U("div",kn,[U("ul",Dn,[(q(!0),z(pt,null,St(j(o).qualityLevels,(P,N)=>(q(),z("li",{class:ht({"speed-active":j(o).currentLevel==N}),onClick:M=>((B,G)=>{y.currentLevel=G,o.currentLevel=G})(0,N),key:P},$(P.height)+"P",11,In))),128))])])])):lt("",!0),A.controlBtns.includes("speedRate")?(q(),z("div",Rn,[_t($(j(o).speedActive=="1.0"?"\u500D\u901F":j(o).speedActive+"x")+" ",1),U("div",wn,[U("ul",Cn,[(q(!0),z(pt,null,St(j(o).speedRate,P=>(q(),z("li",{class:ht({"speed-active":j(o).speedActive==P}),onClick:N=>(M=>{o.speedActive=M,o.dVideo.playbackRate=M})(P),key:P},$(P)+"x",11,On))),128))])])])):lt("",!0),A.controlBtns.includes("volume")?(q(),z("div",xn,[U("div",Pn,[U("div",{class:ht(["volume-main",{"is-muted":j(o).muted}])},[U("span",Fn,$(j(o).muted?0:~~(100*j(o).volume))+"%",1),Q(Xt,{onChange:x[2]||(x[2]=P=>j(o).muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:j(o).volume,"onUpdate:modelValue":x[3]||(x[3]=P=>j(o).volume=P)},null,8,["modelValue"])],2)]),U("span",{onClick:v,style:{display:"flex"}},[Q(Lt,{size:"20",icon:"icon-volume-"+(j(o).volume==0||j(o).muted?"mute":j(o).volume>.5?"up":"down")},null,8,["icon"])])])):lt("",!0),A.controlBtns.includes("setting")?(q(),z("div",Mn,[Q(Lt,{size:"20",class:"rotateHover",icon:"icon-settings"}),U("div",Nn,[U("ul",Bn,[U("li",null,[Un,Q(ie,{onChange:h,modelValue:j(o).mirror,"onUpdate:modelValue":x[4]||(x[4]=P=>j(o).mirror=P)},null,8,["modelValue"])]),U("li",null,[Gn,Q(ie,{onChange:b,modelValue:j(o).loop,"onUpdate:modelValue":x[5]||(x[5]=P=>j(o).loop=P)},null,8,["modelValue"])]),U("li",null,[jn,Q(ie,{onChange:_,modelValue:j(o).lightOff,"onUpdate:modelValue":x[6]||(x[6]=P=>j(o).lightOff=P)},null,8,["modelValue"])])])])])):lt("",!0),A.controlBtns.includes("pip")?(q(),z("div",{key:4,class:"d-tool-item pip-btn",onClick:I},[Q(Lt,{size:"20",icon:"icon-pip"}),Kn])):lt("",!0),A.controlBtns.includes("pageFullScreen")?(q(),z("div",{key:5,class:"d-tool-item pip-btn",onClick:x[7]||(x[7]=P=>j(o).webFullScreen=!j(o).webFullScreen)},[Q(Lt,{size:"20",icon:"icon-web-screen"}),Vn])):lt("",!0),A.controlBtns.includes("fullScreen")?(q(),z("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:O},[Hn,Q(Lt,{size:"20",icon:"icon-screen"})])):lt("",!0)])])],512)):lt("",!0)],34))}}));function Wn(F){F.component(ee.name,ee)}ee.__scopeId="data-v-01791e9e",ee.install=Wn;const Yn={class:"video"},qn=yt({__name:"Video",setup(F,{expose:R}){const d=it(!1);it(!0),it(null),it(""),zt(()=>{});const A=Ft({width:"100%",height:"100%",color:"#409eff",title:"231",src:"blob:https://www.youtube.com/2e085925-25e7-4ad6-ba1b-af94d0a4262b",muted:!1,webFullScreen:!1,speedRate:["0.75","1.0","1.25","1.5","2.0"],autoPlay:!0,loop:!1,mirror:!1,ligthOff:!1,volume:.3,control:!0,controlBtns:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]});return R({openVedio:()=>{d.value=!0,A.title="",A.src="https://www.youtube.com/watch?v=3I8pcGM6PaU"}}),(L,k)=>(q(),z("div",Yn,[Q(j(ee),Ue(A,{playsinline:!0}),null,16)]))}}),Xn="/image/new_more.png",zn=F=>(Ct("data-v-b587932b"),F=F(),Ot(),F),$n=["src"],Qn={class:"card-content"},Zn={class:"card-title"},Jn={class:"card-text"},ta={class:"card-link flex al-c"},ea=zn(()=>U("img",{class:"new_more",src:Xn,alt:""},null,-1)),ra=yt({__name:"Card",props:{cardInfo:null},setup(F){const{t:R}=Ge();return(d,A)=>{const y=fr("router-link");return q(),z("div",null,[U("img",{src:F.cardInfo.figure,class:"image"},null,8,$n),U("div",Qn,[U("div",Zn,$(F.cardInfo.title),1),U("div",Jn,$(F.cardInfo.overview),1),U("div",ta,[Q(y,{to:{path:"/news",query:{id:F.cardInfo.id}}},{default:bt(()=>[_t($(j(R)("continueRreading")),1)]),_:1},8,["to"]),ea])])])}}});const ia=Ee(ra,[["__scopeId","data-v-b587932b"]]);var ne=(F=>(F[F.next=0]="next",F[F.prev=1]="prev",F))(ne||{});const de=["/image/logo_antminer.png","/image/logo_whatsminer.png","/image/logo_jianan.png","/image/logo_innosilicon.png","/image/logo_iPolloStore.png","/image/logo_smic.png","/image/logo-bitdeer.png","/image/logo-whalefin.png","/image/logo_crust.png","/image/logo_astar.png","/image/logo_f2pool.png","/image/logo_btc.png","/image/logo_168node.png","/image/logo_poolin.png","/image/logo-antpool.png"],na=[{imgSrc:"/image/icon_1.png",text:"iconText1"},{imgSrc:"/image/icon_2.png",text:"iconText2"},{imgSrc:"/image/icon_3.png",text:"iconText3"},{imgSrc:"/image/icon_4.png",text:"iconText4"}],aa=[{title:"9",content:"tips1"},{title:"10000",content:"tips2"},{title:"39",content:"tips3"},{title:"100%",content:"tips4"}],oe=F=>(Ct("data-v-4a576808"),F=F(),Ot(),F),sa={class:"bannerImg-box"},oa={class:"bannerImg-box"},la=["src"],ua={class:"bannerText"},ca={class:"100% bottom-line introduce"},da={class:"center text-H1"},ha={class:"fw500 mainText"},fa={class:"mainText"},ga={class:"100% bottom-line about"},va={class:"center flex"},pa={class:"about-left"},ma={class:"aboutBtn"},ya=oe(()=>U("img",{class:"btn_arrow",src:ii,alt:""},null,-1)),Ea={class:"about-tips flex"},Ta={class:"about-tips-content"},Sa={class:"about-content"},ba={class:"100% bottom-line tips"},_a={class:"center flex"},La={class:"tips-title"},Aa={class:"100% selfIntroduction pr"},ka={class:"selfIntroduction-top"},Da={class:"center flex selfIntroduction-center"},Ia={class:"selfIntroduction-center-left selfIntroduction-center-item"},Ra={class:"selfIntroduction-center-text"},wa={class:"selfIntroduction-center-right selfIntroduction-center-item"},Ca={class:"selfIntroduction-center-text"},Oa={class:"selfIntroduction-center-text"},xa={class:"center flex ourProducts"},Pa={class:"ourProducts-text"},Fa=oe(()=>U("div",{class:"line"},null,-1)),Ma=oe(()=>U("aside",{class:"selfIntroduction-bottom"},null,-1)),Na={class:"product-picture-box pa"},Ba={class:"100% video-box pr"},Ua={class:"center flex al-c video-box-top"},Ga={class:"whatWeDo"},ja={class:"ContactUs flex al-c"},Ka=oe(()=>U("img",{class:"btn_arrow_yellow",src:ni,alt:""},null,-1)),Va={class:"video"},Ha={class:"center flex tipsbox2"},Wa=["src"],Ya={class:"100% in-partnership"},qa={class:"center"},Xa={class:"logoList mt73 flex"},za=["src"],$a={class:"logoList flex"},Qa=["src"],Za={class:"logoList flex"},Ja=["src"],ts={class:"100% newsAndevents"},es={class:"center"},rs={class:"cardBox"},is={class:"newspage"},ns=yt({__name:"index",setup(F){const{t:R}=Ge(),d=it(null),A=it(null),y={mainImg:"/image/miner1.png",thumbnailTop:"/image/miner2.png",thumbnailBottomLetf:"/image/miner4.png",thumbnailBottomRight:"/image/miner3.png",Introduction:R("productName")},L=Ft({bannerList:[{url:"/image/img_MinerHostingServices.png",title:""}],bannerH:"",newsAndEventsList:[],pageNum:1,newsNum:1}),k=()=>{if(d.value){const f=d.value[0].offsetHeight;L.bannerH=`${f}px`}},w=f=>f==ne.next?A.value.next():A.value.prev(),D=async()=>{await gr()},o=async()=>{const f=await vr(3,L.pageNum);L.newsAndEventsList=f.data.results,L.newsNum=f.data.count},S=()=>{L.pageNum>1&&(L.pageNum--,o())},m=()=>{const f=Math.ceil(L.newsNum/3);L.pageNum<f&&(L.pageNum++,o())};return zt(()=>{window.addEventListener("resize",()=>{if(d.value[0]&&d.value[0].offsetHeight){const f=d.value[0].offsetHeight;L.bannerH=`${f}px`}},!1),D(),o()}),(f,T)=>{const E=ti,c=Jr;return q(),z(pt,null,[Q(c,{ref_key:"banner",ref:A,height:L.bannerH,"indicator-position":"none",arrow:"never",autoplay:!1},{default:bt(()=>[(q(!0),z(pt,null,St(L.bannerList,(t,a)=>(q(),qt(E,{key:a},{default:bt(()=>[U("div",sa,[U("img",{class:"banner-arrow banner-arrow-left",src:ei,alt:"",onClick:T[0]||(T[0]=e=>w(j(ne).prev))}),U("div",oa,[U("img",{ref_for:!0,ref_key:"bannerImg",ref:d,class:"bannerImg",src:t.url,onLoad:k},null,40,la),U("span",ua,$(t.title),1)]),U("img",{class:"banner-arrow banner-arrow-right",src:ri,alt:"",onClick:T[1]||(T[1]=e=>w(j(ne).next))})])]),_:2},1024))),128))]),_:1},8,["height"]),U("main",ca,[U("div",da,[U("span",ha,$(j(R)("Valarhash")),1),U("span",fa,$(j(R)("inHashwetrust")),1)])]),U("article",ga,[U("aside",va,[U("div",pa,[U("button",ma,[_t($(j(R)("moreAboutus"))+" ",1),ya]),U("div",Ea,[U("span",Ta,$(j(R)("ourHistoryinNumbers")),1)])]),U("div",Sa,$(j(R)("moreAboutusContent")),1)])]),U("article",ba,[U("aside",_a,[(q(!0),z(pt,null,St(j(aa),(t,a)=>(q(),qt(Re,{key:a,content:j(R)(t.content)},{default:bt(()=>[U("span",La,$(t.title),1)]),_:2},1032,["content"]))),128))])]),U("article",Aa,[U("aside",ka,[U("div",Da,[U("div",Ia,[Q(re,{textColor:"#fff",hometitle:j(R)("who"),content:j(R)("weAre")},null,8,["hometitle","content"]),U("div",null,[U("span",Ra,$(j(R)("selfIntroductionContent1")),1)])]),U("div",wa,[U("div",null,[U("span",Ca,$(j(R)("selfIntroductionContent2")),1)]),U("div",null,[U("span",Oa,$(j(R)("selfIntroductionContent3")),1)])])]),U("div",xa,[U("span",Pa,$(j(R)("ourProducts")),1),Fa])]),Ma,U("div",Na,[Q(Di,{productpictureInfo:y})])]),U("article",Ba,[U("aside",Ua,[U("div",Ga,[Q(re,{hometitle:j(R)("what"),content:j(R)("wedo")},null,8,["hometitle","content"]),U("div",ja,[U("span",null,$(j(R)("contactUs")),1),Ka])]),U("div",Va,[Q(qn)])]),U("aside",Ha,[(q(!0),z(pt,null,St(j(na),(t,a)=>(q(),qt(Re,{key:a,content:j(R)(t.text)},{default:bt(()=>[U("img",{class:"whatWeDoList-icon",src:t.imgSrc,alt:""},null,8,Wa)]),_:2},1032,["content"]))),128))])]),U("article",Ya,[U("aside",qa,[Q(re,{hometitle:j(R)("InPartnership"),content:j(R)("with")},null,8,["hometitle","content"]),U("div",Xa,[(q(!0),z(pt,null,St(j(de).slice(0,5),(t,a)=>(q(),z("img",{key:a,src:t,alt:""},null,8,za))),128))]),U("div",$a,[(q(!0),z(pt,null,St(j(de).slice(5,10),(t,a)=>(q(),z("img",{key:a,src:t,alt:""},null,8,Qa))),128))]),U("div",Za,[(q(!0),z(pt,null,St(j(de).slice(10,15),(t,a)=>(q(),z("img",{key:a,src:t,alt:""},null,8,Ja))),128))])])]),U("article",ts,[U("aside",es,[Q(re,{hometitle:j(R)("news"),content:j(R)("events")},null,8,["hometitle","content"]),U("div",rs,[(q(!0),z(pt,null,St(L.newsAndEventsList,(t,a)=>(q(),z("div",{key:a,class:"card-item"},[Q(ia,{cardInfo:t},null,8,["cardInfo"])]))),128))]),U("div",is,[U("div",{class:"newspage-icon",onClick:S},"<"),U("div",null,$(L.pageNum)+"/"+$(Math.ceil(L.newsNum/3)),1),U("div",{class:"newspage-icon",onClick:m},">")])])])],64)}}});const ls=Ee(ns,[["__scopeId","data-v-4a576808"]]);export{ls as default};
